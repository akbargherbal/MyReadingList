<html><head><meta content="light dark" name="color-scheme"/><link href="../style/icons/default/16x16.png" rel="icon"/><link href="../style/themes/github-dark.css" id="_theme" rel="stylesheet" type="text/css"/><link href="../style/vendor/prism-okaidia.min.css" id="_prism" rel="stylesheet" type="text/css"/><link defer="" href="../style/style.css" rel="stylesheet"/><style>
.pre-container {
    position: relative;
}

.copy-btn {
    position: absolute;
    top: 5px;
    right: 5px;
    padding: 3px 8px;
    font-size: 12px;
    background-color: #800000; /* Maroon */
    color: white;
    border: 1px solid #5c0000; /* Darker maroon */
    border-radius: 3px;
    cursor: pointer;
    transition: background-color 0.2s ease;
}

.copy-btn:hover {
    background-color: #a00000; /* Lighter maroon on hover */
}

.copy-btn.copied {
    background-color: #006400; /* Dark Green */
    border-color: #004d00;
    color: white;
}

.copy-btn.failed {
    background-color: #dc3545; /* Red */
    border-color: #c82333;
    color: white;
}
</style></head><body class="_theme-github _color-light"><div class="markdown-body" id="_html" style="visibility: visible;"><div class="akbar_container"><h1 id="chapter-13-interacting-with-pages-actions" tabindex="-1"><a class="anchor" href="#chapter-13-interacting-with-pages-actions" name="chapter-13-interacting-with-pages-actions" tabindex="-1"><span class="octicon octicon-link"></span></a>Chapter 13: Interacting with Pages: Actions</h1>
<h3 id="131-clicking-click" tabindex="-1"><a class="anchor" href="#131-clicking-click" name="131-clicking-click" tabindex="-1"><span class="octicon octicon-link"></span></a>13.1 Clicking: <code>.click()</code></h3>
<p>The <code>.click()</code> method is arguably one of the most frequently used actions in browser automation. It simulates a user clicking on an element, which can be a button, a link, a checkbox, or any other interactive part of a web page. Mastering its usage is fundamental to creating effective end-to-end tests that mimic real user journeys.</p>
<p><strong>The Core Idea: Simulating User Interaction</strong></p>
<p>At its heart, <code>page.locator(...).click()</code> tells Playwright: "Find this element, and then perform a mouse click on it." This simple instruction, however, is backed by sophisticated mechanisms within Playwright designed to ensure reliability.</p>
<p><strong>Why <code>.click()</code> is More Than Just a Simple Click</strong></p>
<p>If you were to implement a click naively, you might try to find an element and immediately trigger a click event. This approach is fraught with peril in dynamic web applications:</p>
<ul>
<li>The element might not exist in the DOM yet.</li>
<li>The element might be present but not yet visible (e.g., hidden by CSS, or animating into view).</li>
<li>The element might be visible but disabled.</li>
<li>The element might be visible and enabled, but obscured by another element (like a modal dialog or a notification).</li>
</ul>
<p>Attempting to click in any of these states would likely lead to a failed interaction or a flaky test. Playwright's <code>.click()</code> method intelligently handles these scenarios through its <strong>actionability checks</strong>.</p>
<p><strong>Playwright's Actionability Checks for <code>.click()</code></strong></p>
<p>Before Playwright executes a <code>.click()</code>, it automatically performs a series of checks and waits for the target element to be "actionable." This means the element must be:</p>
<ol>
<li><strong>Attached</strong> to the Document Object Model (DOM).</li>
<li><strong>Visible</strong>: It must not have <code>display: none</code>, <code>visibility: hidden</code>, or be otherwise hidden by CSS. Its bounding box must also have a non-zero area.</li>
<li><strong>Stable</strong>: It must not be animating or have its position changing rapidly. Playwright waits for the element to stop moving.</li>
<li><strong>Enabled</strong>: If it's an element that can be disabled (like a button or input), it must not have the <code>disabled</code> attribute.</li>
<li><strong>Receives Events</strong>: It must be the element that would receive the click at its click point (e.g., not obscured by another element).</li>
<li><strong>Editable</strong> (for certain elements, though less critical for a generic click on a button/link).</li>
</ol>
<p>Playwright will wait for these conditions to be met for a default timeout period (configurable, typically 30 seconds). If the element does not become actionable within this time, Playwright will raise a <code>TimeoutError</code>, usually with a very descriptive message explaining which check failed. This auto-waiting mechanism is a cornerstone of Playwright's reliability, significantly reducing the need for manual <code>time.sleep()</code> calls or custom wait conditions in your tests.</p>
<p><strong>Basic Usage</strong></p>
<p>The typical pattern involves first locating an element and then calling <code>.click()</code> on the resulting <code>Locator</code> object.</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># Assuming 'page' is your Playwright Page fixture</span>

<span class="token comment"># Locate a button by its text and click it</span>
page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"text=Submit"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Locate an element by its CSS selector (e.g., an ID) and click it</span>
page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#submit-button"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Locate an element by its role (ARIA role) and click it</span>
page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"button"</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"Save Changes"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>Let's examine this code in detail:</p>
<ol>
<li>
<p><strong><code>page.locator("text=Submit").click()</code></strong>:</p>
<ul>
<li><code>page.locator("text=Submit")</code>: This part uses Playwright's text locator to find an element on the page that contains the exact text "Submit". This is often a good choice for buttons or links where the visible text is a reliable identifier.</li>
<li><code>.click()</code>: Once the element is found and deemed actionable by Playwright's internal checks, this method simulates a click on it.</li>
</ul>
</li>
<li>
<p><strong><code>page.locator("#submit-button").click()</code></strong>:</p>
<ul>
<li><code>page.locator("#submit-button")</code>: This uses a CSS selector. <code>"#submit-button"</code> targets an element with the <code>id</code> attribute equal to <code>submit-button</code>. IDs are intended to be unique on a page, making them very reliable locators.</li>
<li><code>.click()</code>: Again, performs the click after actionability checks.</li>
</ul>
</li>
<li>
<p><strong><code>page.locator("button", name="Save Changes").click()</code></strong>:</p>
<ul>
<li><code>page.locator("button", name="Save Changes")</code>: This uses Playwright's role locator. It looks for an element with the ARIA role of <code>button</code> that also has an accessible name of "Save Changes". This is often the most robust way to locate elements as it aligns with how users and assistive technologies perceive the page. (Refer back to Chapter 11 for more on locators).</li>
<li><code>.click()</code>: Executes the click.</li>
</ul>
</li>
</ol>
<p>This pattern—locate then act—is fundamental. The choice of locator (text, CSS, role, <code>data-testid</code>, etc.) depends on the element and your strategy for creating maintainable tests, as discussed in Chapter 11.</p>
<p><strong>Practical Example: Clicking a Button to Reveal Content</strong></p>
<p>Let's consider a simple Django application scenario. We have a page with a button. When this button is clicked, some hidden text becomes visible.</p>
<p><strong>1. Django Setup (Conceptual)</strong></p>
<p>Imagine you have a Django template (<code>myapp/templates/myapp/interactive_page.html</code>):</p>
<pre class="language-html" tabindex="0"><code class="language-html"><span class="token comment">&lt;!-- THIS_CODE_SNIPPET --&gt;</span>
{% comment %} myapp/templates/myapp/interactive_page.html {% endcomment %}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Interactive Page<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>reveal-button<span class="token punctuation">"</span></span> <span class="token attr-name">data-testid</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>reveal-btn<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Show Secret<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>secret-message<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span> <span class="token attr-name">data-testid</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>secret-msg<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    This is the secret message!
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token comment">// THIS_CODE_SNIPPET</span>
<span class="token comment">// Basic JavaScript to toggle visibility</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'reveal-button'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'secret-message'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'block'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>And a simple view (<code>myapp/views.py</code>):</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># myapp/views.py</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render

<span class="token keyword">def</span> <span class="token function">interactive_page_view</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'myapp/interactive_page.html'</span><span class="token punctuation">)</span>
</code></pre>
<p>And a URL configuration (<code>myapp/urls.py</code>):</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># myapp/urls.py</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path
<span class="token keyword">from</span> <span class="token punctuation">.</span> <span class="token keyword">import</span> views

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    path<span class="token punctuation">(</span><span class="token string">'interactive/'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>interactive_page_view<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'interactive_page'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre>
<p><strong>2. The Pytest Playwright Test</strong></p>
<p>Now, let's write a test for this functionality.</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># tests/e2e/test_interactive_page.py</span>
<span class="token keyword">import</span> pytest
<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> Page<span class="token punctuation">,</span> expect
<span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> reverse

<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>mark<span class="token punctuation">.</span>django_db</span> <span class="token comment"># Not strictly needed if no DB interaction for this simple page</span>
<span class="token keyword">def</span> <span class="token function">test_reveal_message_on_click</span><span class="token punctuation">(</span>page<span class="token punctuation">:</span> Page<span class="token punctuation">,</span> live_server<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Arrange: Navigate to the page</span>
    interactive_page_url <span class="token operator">=</span> live_server<span class="token punctuation">.</span>url <span class="token operator">+</span> reverse<span class="token punctuation">(</span><span class="token string">'interactive_page'</span><span class="token punctuation">)</span>
    page<span class="token punctuation">.</span>goto<span class="token punctuation">(</span>interactive_page_url<span class="token punctuation">)</span>

    <span class="token comment"># Locate the button and the initially hidden message</span>
    reveal_button <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"[data-testid='reveal-btn']"</span><span class="token punctuation">)</span>
    secret_message <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"[data-testid='secret-msg']"</span><span class="token punctuation">)</span>

    <span class="token comment"># Assert initial state: message should be hidden</span>
    expect<span class="token punctuation">(</span>secret_message<span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_hidden<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># Act: Click the button</span>
    reveal_button<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># Assert final state: message should now be visible</span>
    expect<span class="token punctuation">(</span>secret_message<span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_visible<span class="token punctuation">(</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>secret_message<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_text<span class="token punctuation">(</span><span class="token string">"This is the secret message!"</span><span class="token punctuation">)</span>
</code></pre>
<p>Let's break down this test code:</p>
<ol>
<li>
<p><strong><code>import pytest</code> / <code>from playwright.sync_api import Page, expect</code> / <code>from django.urls import reverse</code></strong>:</p>
<ul>
<li>Standard imports for <code>pytest</code>, Playwright's <code>Page</code> object and <code>expect</code> assertion library, and Django's <code>reverse</code> for URL generation.</li>
</ul>
</li>
<li>
<p><strong><code>@pytest.mark.django_db</code></strong>:</p>
<ul>
<li>This marker ensures the Django test database is set up. While our current example doesn't directly interact with the database on the backend for this specific click action, it's good practice for E2E tests that run against a Django application, as many pages will. If the page truly has zero database dependency, it might be omitted, but <code>live_server</code> often implies a full Django context.</li>
</ul>
</li>
<li>
<p><strong><code>def test_reveal_message_on_click(page: Page, live_server):</code></strong>:</p>
<ul>
<li>Defines our test function.</li>
<li><code>page: Page</code>: This injects the Playwright <code>Page</code> fixture, our primary interface to the browser.</li>
<li><code>live_server</code>: This injects the <code>pytest-django</code> <code>live_server</code> fixture, which starts a real Django development server running your application with the test database. This is crucial for Playwright to access your application. (Covered in detail in Chapter 10).</li>
</ul>
</li>
<li>
<p><strong><code>interactive_page_url = live_server.url + reverse('interactive_page')</code></strong>:</p>
<ul>
<li><code>live_server.url</code>: Provides the base URL of the running test server (e.g., <code>http://localhost:8081</code>).</li>
<li><code>reverse('interactive_page')</code>: Dynamically gets the path for our view named <code>interactive_page</code>. Using <code>reverse</code> is robust against URL changes.</li>
<li>This constructs the full URL to our test page.</li>
</ul>
</li>
<li>
<p><strong><code>page.goto(interactive_page_url)</code></strong>:</p>
<ul>
<li>Navigates the browser controlled by <code>page</code> to the specified URL. Playwright waits for the page to load before proceeding.</li>
</ul>
</li>
<li>
<p><strong><code>reveal_button = page.locator("[data-testid='reveal-btn']")</code></strong>:</p>
<ul>
<li>We locate the button using its <code>data-testid</code> attribute. As discussed in Chapter 11, <code>data-testid</code> attributes are excellent for creating stable locators that are decoupled from styling or text content that might change.</li>
<li>This returns a <code>Locator</code> object, not the element itself.</li>
</ul>
</li>
<li>
<p><strong><code>secret_message = page.locator("[data-testid='secret-msg']")</code></strong>:</p>
<ul>
<li>Similarly, we locate the <code>div</code> element containing the secret message using its <code>data-testid</code>.</li>
</ul>
</li>
<li>
<p><strong><code>expect(secret_message).to_be_hidden()</code></strong>:</p>
<ul>
<li>This is an assertion using Playwright's <code>expect</code> library (covered in Chapter 12).</li>
<li>It checks that the <code>secret_message</code> element is initially not visible on the page (due to <code>style="display: none;"</code>). Playwright's <code>to_be_hidden()</code> also has auto-waiting capabilities.</li>
</ul>
</li>
<li>
<p><strong><code>reveal_button.click()</code></strong>:</p>
<ul>
<li><strong>This is the core action.</strong> We call the <code>.click()</code> method on our <code>reveal_button</code> locator.</li>
<li>Playwright will:
<ul>
<li>Ensure the button matching <code>[data-testid='reveal-btn']</code> is attached, visible, stable, enabled, and can receive events.</li>
<li>Perform the click.</li>
<li>This click, in turn, triggers the JavaScript event listener we defined in our HTML, which changes the <code>display</code> style of the <code>#secret-message</code> div to <code>block</code>.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong><code>expect(secret_message).to_be_visible()</code></strong>:</p>
<ul>
<li>After the click, we assert that the <code>secret_message</code> element is now visible. If the click didn't work or the JavaScript failed, this assertion would fail.</li>
</ul>
</li>
<li>
<p><strong><code>expect(secret_message).to_have_text("This is the secret message!")</code></strong>:</p>
<ul>
<li>We further assert that the now-visible message contains the expected text. This confirms not only visibility but also content.</li>
</ul>
</li>
</ol>
<p>This example demonstrates a complete Arrange-Act-Assert cycle for a click interaction. The use of <code>live_server</code> provides the real application context, <code>page.goto</code> navigates, <code>locator</code> finds elements, <code>.click()</code> performs the crucial interaction, and <code>expect</code> verifies the outcome. Playwright's auto-waiting during both the <code>.click()</code> and the <code>expect</code> calls makes this test robust against minor timing variations.</p>
<p><strong>Click Options</strong></p>
<p>The <code>.click()</code> method can accept an options object to modify its behavior. Some common options include:</p>
<ul>
<li><code>button</code>: <code>'left'</code>, <code>'right'</code>, or <code>'middle'</code>. Defaults to <code>'left'</code>.<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#my-element"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span>button<span class="token operator">=</span><span class="token string">"right"</span><span class="token punctuation">)</span> <span class="token comment"># Simulate a right-click</span>
</code></pre>
</li>
<li><code>modifiers</code>: A list of modifier keys to press during the click, e.g., <code>['Shift', 'Control']</code>.<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#my-link"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span>modifiers<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"Shift"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># Shift-click</span>
</code></pre>
</li>
<li><code>position</code>: <code>{ x: number, y: number }</code> relative to the top-left corner of the element's padding box. If not specified, clicks the center of the element.<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#my-canvas"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span>position<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"x"</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">"y"</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
</li>
<li><code>timeout</code>: Overrides the default actionability timeout for this specific click operation (in milliseconds).<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># Wait up to 10 seconds for this specific button to become clickable</span>
page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#slow-button"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">10000</span><span class="token punctuation">)</span>
</code></pre>
While Playwright's default timeouts are generally good, you might use a custom <code>timeout</code> if a specific element is known to take longer to become interactive under certain conditions, and you don't want to change the global timeout. However, frequent reliance on increased timeouts might indicate underlying performance issues or overly complex UI updates that could be simplified.</li>
</ul>
<p><strong>Common Pitfalls and Troubleshooting</strong></p>
<ul>
<li><strong>Element Not Found</strong>: If Playwright can't find the element specified by your locator, <code>.click()</code> will fail with a <code>TimeoutError</code> indicating the locator didn't resolve.
<ul>
<li><strong>Solution</strong>: Double-check your locator (Chapter 11). Use the browser's developer tools to inspect the element and verify its attributes, text, or role. Use Playwright's debugging tools (like <code>PWDEBUG=1 pytest ...</code>) to pause execution and inspect the page.</li>
</ul>
</li>
<li><strong>Element Not Clickable (Obscured, Disabled, Not Visible)</strong>: Playwright's actionability checks will usually catch this and provide a descriptive <code>TimeoutError</code>.
<ul>
<li><strong>Solution</strong>: The error message often tells you <em>why</em> it's not clickable (e.g., "element is not visible" or "element is disabled" or "element is obscured by another element..."). Investigate the state of the UI at the time of the click. Is there a modal overlay? Is the button conditionally disabled?</li>
</ul>
</li>
<li><strong>Clicking the Wrong Element</strong>: If your locator is too broad, you might click an unintended element.
<ul>
<li><strong>Solution</strong>: Make your locators more specific. Use <code>data-testid</code> or a combination of locators to pinpoint the exact element.</li>
</ul>
</li>
<li><strong>Race Conditions with UI Updates</strong>: Although Playwright's auto-waiting handles many cases, if a click triggers a complex series of asynchronous UI updates, you might occasionally need more explicit waits <em>after</em> the click before asserting outcomes (see Chapter 14 on Handling Dynamic Content). However, for the click action itself, Playwright's actionability is usually sufficient.</li>
</ul>
<p><strong>Summary of <code>.click()</code></strong></p>
<p>The <code>.click()</code> method is a powerful and reliable way to simulate user clicks in Playwright. Its strength lies in the automatic actionability checks, which wait for elements to be in a truly interactive state before attempting the click. This significantly reduces test flakiness.</p>
<p>When using <code>.click()</code>:</p>
<ol>
<li>Always use a robust <strong>locator strategy</strong> (Chapter 11) to find the element you intend to click. <code>data-testid</code> and role locators are often preferred for stability.</li>
<li>Trust Playwright's <strong>auto-waiting</strong> mechanism. Avoid adding manual sleeps before clicks.</li>
<li>Understand that <code>.click()</code> is an <strong>action</strong> that may trigger changes in the page state.</li>
<li>Follow up clicks with <strong>assertions</strong> (<code>expect</code> from Chapter 12) to verify that the click had the intended effect.</li>
</ol>
<p>By mastering <code>.click()</code>, you gain a fundamental tool for building comprehensive E2E tests that accurately reflect how users interact with your Django application.</p>
<h3 id="132-filling-input-fields-fill" tabindex="-1"><a class="anchor" href="#132-filling-input-fields-fill" name="132-filling-input-fields-fill" tabindex="-1"><span class="octicon octicon-link"></span></a>13.2 Filling Input Fields: <code>.fill()</code></h3>
<p>After learning how to navigate to pages and click on elements, the next fundamental interaction you'll need to master is entering text into input fields. This is crucial for testing forms, search functionalities, login pages, and virtually any part of your web application that requires user input. Playwright provides the <code>.fill()</code> method for this purpose, and it's designed to closely mimic actual user behavior.</p>
<p><strong>The Purpose of <code>.fill()</code></strong></p>
<p>The primary role of the <code>.fill()</code> method is to populate form fields such as <code>&lt;input&gt;</code>, <code>&lt;textarea&gt;</code>, and elements with the <code>contenteditable</code> attribute with the text you specify. It's not just about programmatically setting a value; <code>.fill()</code> simulates a user typing into the field, which includes focusing the element, clearing its current content (by default), and then typing the new text. This simulation triggers associated JavaScript events (like <code>input</code>, <code>change</code>, <code>keydown</code>, <code>keyup</code>), which is vital for modern web applications that often rely on these events to provide dynamic feedback or perform validation.</p>
<p>Let's start with a basic example. Imagine a simple search input field on a page:</p>
<pre class="language-html" tabindex="0"><code class="language-html"><span class="token comment">&lt;!-- THIS_CODE_SNIPPET --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search-box<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Search here...<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>To fill this input field using Playwright, you would first locate it and then call <code>.fill()</code>:</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># tests/test_search.py</span>
<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> Page<span class="token punctuation">,</span> expect
<span class="token keyword">import</span> pytest

<span class="token comment"># Assume this test is part of a larger test file where live_server is available</span>
<span class="token comment"># and the page fixture is correctly configured.</span>

<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>mark<span class="token punctuation">.</span>django_db</span>
<span class="token keyword">def</span> <span class="token function">test_fill_search_box</span><span class="token punctuation">(</span>page<span class="token punctuation">:</span> Page<span class="token punctuation">,</span> live_server<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># For this example, let's imagine a simple page with just an input</span>
    <span class="token comment"># In a real scenario, you'd navigate to a Django view</span>
    page<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>live_server<span class="token punctuation">.</span>url<span class="token punctuation">}</span></span><span class="token string">/some-page-with-a-searchbox/"</span></span><span class="token punctuation">)</span> <span class="token comment"># Replace with an actual URL</span>

    <span class="token comment"># Locate the search box using its ID</span>
    search_input_locator <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#search-box"</span><span class="token punctuation">)</span>

    <span class="token comment"># Fill the input field with text</span>
    search_input_locator<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token string">"Playwright testing"</span><span class="token punctuation">)</span>

    <span class="token comment"># Assert that the input field now contains the text</span>
    expect<span class="token punctuation">(</span>search_input_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_value<span class="token punctuation">(</span><span class="token string">"Playwright testing"</span><span class="token punctuation">)</span>
</code></pre>
<p>Let's examine this code in detail:</p>
<ol>
<li>
<p><strong><code>search_input_locator = page.locator("#search-box")</code></strong>:</p>
<ul>
<li>We first obtain a <code>Locator</code> object for the input field. Here, we're using a CSS selector <code>#search-box</code> to find an element with the ID <code>search-box</code>. As discussed in Chapter 11, choosing robust locators is key.</li>
<li>This step doesn't interact with the page yet; it just defines how Playwright will find the element when an action is performed.</li>
</ul>
</li>
<li>
<p><strong><code>search_input_locator.fill("Playwright testing")</code></strong>:</p>
<ul>
<li>This is the core action. We call the <code>.fill()</code> method on our <code>search_input_locator</code>.</li>
<li>The first and only required argument is the <code>value</code> (a string) that we want to type into the input field: <code>"Playwright testing"</code>.</li>
<li><strong>Under the Hood</strong>: When this line executes, Playwright performs several steps:
<ol>
<li>It waits for the element identified by <code>#search-box</code> to be visible, enabled, and editable (these are part of Playwright's "actionability checks").</li>
<li>It scrolls the element into view if it's not already.</li>
<li>It focuses the input field.</li>
<li><strong>Crucially, it clears any existing text within the input field.</strong> This is the default behavior.</li>
<li>It then types the specified text ("Playwright testing") into the field. This typing action triggers JavaScript events like <code>keydown</code>, <code>keypress</code>, <code>input</code>, and <code>keyup</code> for each character, followed by a <code>change</code> event once the filling is complete and the element might lose focus (though focus typically remains until the next interaction).</li>
</ol>
</li>
<li>The choice to clear the field by default is a sensible one for most testing scenarios, as you usually want to set a field to a specific known value, regardless of its previous state.</li>
</ul>
</li>
<li>
<p><strong><code>expect(search_input_locator).to_have_value("Playwright testing")</code></strong>:</p>
<ul>
<li>After filling the input, we use an assertion (Chapter 12) to verify that the action was successful.</li>
<li><code>to_have_value()</code> checks the <code>value</code> property of the input element.</li>
<li>This confirms that the <code>.fill()</code> operation resulted in the input field containing the desired text.</li>
</ul>
</li>
</ol>
<p><strong>Why Simulating Events Matters</strong></p>
<p>You might wonder why Playwright goes to the trouble of simulating key presses and events, rather than just directly setting the <code>value</code> attribute of the HTML element. The reason lies in how modern web applications are built. Many applications use JavaScript to:</p>
<ul>
<li>Perform real-time validation as the user types.</li>
<li>Show or hide other elements based on input.</li>
<li>Enable or disable submit buttons.</li>
<li>Fetch suggestions or auto-complete options.</li>
</ul>
<p>If <code>.fill()</code> merely changed the <code>value</code> attribute, none of these JavaScript-driven behaviors would be triggered, leading to tests that don't accurately reflect real user interaction and potentially miss bugs. By simulating the events, <code>.fill()</code> ensures your tests interact with the application in a much more realistic and reliable way.</p>
<p><strong>Filling Different Types of Input Elements</strong></p>
<p>The <code>.fill()</code> method is versatile and works with various elements that accept text input:</p>
<ul>
<li><strong>Standard text inputs</strong>: <code>&lt;input type="text"&gt;</code>, <code>&lt;input type="password"&gt;</code>, <code>&lt;input type="email"&gt;</code>, <code>&lt;input type="search"&gt;</code>, <code>&lt;input type="url"&gt;</code>, <code>&lt;input type="tel"&gt;</code>, <code>&lt;input type="number"&gt;</code>.</li>
<li><strong>Text areas</strong>: <code>&lt;textarea&gt;&lt;/textarea&gt;</code>.</li>
<li><strong>Content-editable elements</strong>: Any HTML element with the <code>contenteditable="true"</code> attribute (e.g., <code>&lt;div contenteditable="true"&gt;&lt;/div&gt;</code>).</li>
</ul>
<p>The underlying mechanism is the same: Playwright focuses the element, clears it, and types the text.</p>
<p><strong>Practical Django Example: Filling a Feedback Form</strong></p>
<p>Let's consider a more complete example using a Django form. Suppose we have a simple feedback form in our Django application:</p>
<ul>
<li><code>models.py</code>:<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># feedback/models.py</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models

<span class="token keyword">class</span> <span class="token class-name">Feedback</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    email <span class="token operator">=</span> models<span class="token punctuation">.</span>EmailField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    message <span class="token operator">=</span> models<span class="token punctuation">.</span>TextField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    created_at <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>auto_now_add<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"Feedback from </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>email<span class="token punctuation">}</span></span><span class="token string">"</span></span>
</code></pre>
</li>
<li><code>forms.py</code>:<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># feedback/forms.py</span>
<span class="token keyword">from</span> django <span class="token keyword">import</span> forms
<span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> Feedback

<span class="token keyword">class</span> <span class="token class-name">FeedbackForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>ModelForm<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> Feedback
        fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'email'</span><span class="token punctuation">,</span> <span class="token string">'message'</span><span class="token punctuation">]</span>
        widgets <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'email'</span><span class="token punctuation">:</span> forms<span class="token punctuation">.</span>EmailInput<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'data-testid'</span><span class="token punctuation">:</span> <span class="token string">'email-input'</span><span class="token punctuation">,</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token string">'id_email'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'message'</span><span class="token punctuation">:</span> forms<span class="token punctuation">.</span>Textarea<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'data-testid'</span><span class="token punctuation">:</span> <span class="token string">'message-textarea'</span><span class="token punctuation">,</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token string">'id_message'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
</code></pre>
</li>
<li><code>views.py</code>:<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># feedback/views.py</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render<span class="token punctuation">,</span> redirect
<span class="token keyword">from</span> django<span class="token punctuation">.</span>http <span class="token keyword">import</span> HttpResponse
<span class="token keyword">from</span> <span class="token punctuation">.</span>forms <span class="token keyword">import</span> FeedbackForm
<span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> Feedback

<span class="token keyword">def</span> <span class="token function">feedback_view</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>
        form <span class="token operator">=</span> FeedbackForm<span class="token punctuation">(</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">)</span>
        <span class="token keyword">if</span> form<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            form<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">"Feedback submitted successfully!"</span><span class="token punctuation">,</span> status<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token comment"># Simple success response</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        form <span class="token operator">=</span> FeedbackForm<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'feedback_form.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'form'</span><span class="token punctuation">:</span> form<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># Ensure you have a template 'feedback_form.html'</span>
<span class="token comment"># And urls.py configured for this view.</span>
</code></pre>
</li>
<li><code>templates/feedback_form.html</code>:<pre class="language-html" tabindex="0"><code class="language-html"><span class="token comment">&lt;!-- THIS_CODE_SNIPPET --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{% url 'feedback' %}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    {% csrf_token %}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id_email<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Email:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">data-testid</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email-input<span class="token punctuation">"</span></span> <span class="token attr-name">required</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id_email<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id_message<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Message:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>message<span class="token punctuation">"</span></span> <span class="token attr-name">cols</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>40<span class="token punctuation">"</span></span> <span class="token attr-name">rows</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10<span class="token punctuation">"</span></span> <span class="token attr-name">data-testid</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>message-textarea<span class="token punctuation">"</span></span> <span class="token attr-name">required</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id_message<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">data-testid</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit-button<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Submit Feedback<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre>
</li>
<li><code>urls.py</code> (in your app, e.g., <code>feedback/urls.py</code>):<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># feedback/urls.py</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path
<span class="token keyword">from</span> <span class="token punctuation">.</span> <span class="token keyword">import</span> views

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    path<span class="token punctuation">(</span><span class="token string">'submit/'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>feedback_view<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'feedback'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre>
(Ensure this app's URLs are included in your project's main <code>urls.py</code>).</li>
</ul>
<p>Now, let's write a Playwright test to fill and submit this form:</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># tests/test_feedback_form.py</span>
<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> Page<span class="token punctuation">,</span> expect
<span class="token keyword">import</span> pytest
<span class="token keyword">from</span> feedback<span class="token punctuation">.</span>models <span class="token keyword">import</span> Feedback <span class="token comment"># Assuming your app is named 'feedback'</span>

<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>mark<span class="token punctuation">.</span>django_db</span>
<span class="token keyword">def</span> <span class="token function">test_submit_feedback_form</span><span class="token punctuation">(</span>page<span class="token punctuation">:</span> Page<span class="token punctuation">,</span> live_server<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 1. Arrange: Navigate to the feedback form page</span>
    page<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>live_server<span class="token punctuation">.</span>url<span class="token punctuation">}</span></span><span class="token string">/feedback/submit/"</span></span><span class="token punctuation">)</span> <span class="token comment"># Adjust URL as per your project setup</span>

    <span class="token comment"># 2. Act: Fill out the form fields</span>
    email_input <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"[data-testid='email-input']"</span><span class="token punctuation">)</span>
    message_textarea <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"[data-testid='message-textarea']"</span><span class="token punctuation">)</span>
    submit_button <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"[data-testid='submit-button']"</span><span class="token punctuation">)</span>

    test_email <span class="token operator">=</span> <span class="token string">"testuser@example.com"</span>
    test_message <span class="token operator">=</span> <span class="token string">"This is a test feedback message."</span>

    email_input<span class="token punctuation">.</span>fill<span class="token punctuation">(</span>test_email<span class="token punctuation">)</span>
    message_textarea<span class="token punctuation">.</span>fill<span class="token punctuation">(</span>test_message<span class="token punctuation">)</span>

    <span class="token comment"># 3. Act: Click the submit button</span>
    submit_button<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 4. Assert: Check for success indication and database record</span>
    <span class="token comment">#    Assert that we see a success message on the page</span>
    expect<span class="token punctuation">(</span>page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"body"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to_contain_text<span class="token punctuation">(</span><span class="token string">"Feedback submitted successfully!"</span><span class="token punctuation">)</span>

    <span class="token comment">#    Assert that the feedback was saved to the database</span>
    <span class="token keyword">assert</span> Feedback<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span>
    feedback_entry <span class="token operator">=</span> Feedback<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">assert</span> feedback_entry<span class="token punctuation">.</span>email <span class="token operator">==</span> test_email
    <span class="token keyword">assert</span> feedback_entry<span class="token punctuation">.</span>message <span class="token operator">==</span> test_message
</code></pre>
<p>Let's break down this test:</p>
<ol>
<li><strong><code>@pytest.mark.django_db</code></strong>: This marker is essential. It ensures that a fresh, isolated test database is created for this test and that Django's settings are correctly configured. This allows us to interact with the Django ORM (<code>Feedback.objects.count()</code>, <code>Feedback.objects.first()</code>) safely.</li>
<li><strong><code>page.goto(f"{live_server.url}/feedback/submit/")</code></strong>: We navigate to the feedback form page served by our Django <code>live_server</code>.</li>
<li><strong><code>email_input = page.locator("[data-testid='email-input']")</code></strong> and <strong><code>message_textarea = page.locator("[data-testid='message-textarea']")</code></strong>: We locate the email input and the message textarea using their <code>data-testid</code> attributes. This is a robust way to select elements, as recommended in Chapter 11.</li>
<li><strong><code>test_email = "testuser@example.com"</code></strong> and <strong><code>test_message = "This is a test feedback message."</code></strong>: We define the test data we'll use.</li>
<li><strong><code>email_input.fill(test_email)</code></strong>: Playwright waits for the email input to be actionable, clears it, and then types <code>testuser@example.com</code> into it.</li>
<li><strong><code>message_textarea.fill(test_message)</code></strong>: Similarly, Playwright fills the textarea with our test message. This works just like filling an <code>&lt;input&gt;</code> field.</li>
<li><strong><code>submit_button.click()</code></strong>: After filling the form, we locate the submit button and click it (as covered in section 13.1). This will trigger the form submission to our Django view.</li>
<li><strong><code>expect(page.locator("body")).to_contain_text("Feedback submitted successfully!")</code></strong>: We assert that the page content updates to show our success message. This confirms the view processed the form correctly and returned the success response.</li>
<li><strong><code>assert Feedback.objects.count() == 1</code></strong>: We query the test database to ensure that one <code>Feedback</code> object has been created.</li>
<li><strong><code>feedback_entry = Feedback.objects.first()</code></strong> and subsequent <code>assert</code>s: We retrieve the created <code>Feedback</code> object and verify that its <code>email</code> and <code>message</code> fields contain the data we submitted. This provides strong confirmation that the entire flow—from browser interaction to database persistence—worked as expected.</li>
</ol>
<p>This example demonstrates how <code>.fill()</code> is a cornerstone of testing form interactions in a Django application. It seamlessly integrates with locators for finding elements and actions like <code>.click()</code> for submitting forms.</p>
<p><strong>Options for <code>.fill()</code></strong></p>
<p>The <code>.fill()</code> method has a few options you can pass as keyword arguments, though you'll rarely need them:</p>
<ul>
<li><code>timeout</code> (float): Overrides the default timeout for the action. If the element doesn't become actionable within this time (in milliseconds), the operation will fail.<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># Example of using timeout with fill</span>
<span class="token comment"># search_input_locator.fill("some text", timeout=5000) # Wait up to 5 seconds</span>
</code></pre>
</li>
<li><code>no_wait_after</code> (bool): By default, Playwright waits for the element to be stable after performing the action. Setting <code>no_wait_after=True</code> disables this, which can be useful in rare, advanced scenarios where subsequent actions need to happen immediately, but it can also lead to flakiness if not used carefully. It's generally best to rely on Playwright's default waiting mechanisms.</li>
<li><code>force</code> (bool): If set to <code>True</code>, Playwright will bypass its actionability checks (e.g., visibility, enabled state). <strong>Using <code>force=True</code> is generally discouraged.</strong> It can hide real issues in your application (e.g., trying to fill a disabled field that a user couldn't interact with) and make tests less reliable. If you find yourself needing <code>force=True</code>, it's often a sign that your test or application logic needs re-evaluation.</li>
</ul>
<p><strong>What if the Element Cannot Be Filled?</strong></p>
<p>If you attempt to call <code>.fill()</code> on an element that is not an input field, textarea, or content-editable element, Playwright will raise an error. For example, trying to <code>.fill()</code> a <code>&lt;div&gt;</code> that is not <code>contenteditable</code> will fail. Similarly, if the element is found but is not actionable (e.g., it's hidden or disabled) and the timeout is reached, Playwright will also raise an error, clearly indicating the problem. This is helpful because it prevents your tests from silently passing when they should be failing.</p>
<p><strong>Clearing Fields Explicitly</strong></p>
<p>As mentioned, <code>.fill()</code> clears the field by default before typing. If you need to explicitly clear a field without typing anything new, or before performing a different kind of interaction (like sending individual key presses with <code>.press()</code>), you can use the <code>.clear()</code> method:</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># Example of using .clear()</span>
<span class="token comment"># email_input = page.locator("[data-testid='email-input']")</span>
<span class="token comment"># email_input.fill("initial.value@example.com") # Fill with some value</span>
<span class="token comment"># ... some other actions ...</span>
<span class="token comment"># email_input.clear() # Now the field is empty</span>
<span class="token comment"># expect(email_input).to_be_empty()</span>
</code></pre>
<p>The <code>.clear()</code> method, like <code>.fill()</code>, also performs actionability checks and triggers relevant JavaScript events.</p>
<p><strong>Common Pitfalls and Best Practices for <code>.fill()</code></strong></p>
<ul>
<li><strong>Pitfall: Incorrect Locator</strong>: If your locator doesn't uniquely or correctly identify the input field, <code>.fill()</code> will target the wrong element or fail if no element (or too many elements) are found. Always double-check your locators (Chapter 11).</li>
<li><strong>Pitfall: Element Not Actionable</strong>: If the input field is hidden (e.g., <code>display: none;</code> or <code>visibility: hidden;</code>), disabled, or overlaid by another element, Playwright's actionability checks will prevent <code>.fill()</code> from executing until the element becomes interactive or the timeout expires. This is usually desired behavior, as it reflects user limitations. Debug by inspecting the element's state in the browser or using <code>page.pause()</code> or screenshots.</li>
<li><strong>Pitfall: Race Conditions with JavaScript</strong>: If JavaScript modifies the input field's value immediately after you <code>.fill()</code> it (e.g., an input mask or formatter), your subsequent assertions on the value might fail. Playwright's auto-waiting helps, but complex client-side logic might require more specific waits or assertions that account for the transformation.</li>
<li><strong>Best Practice: Use <code>data-testid</code></strong>: As shown in the Django example, using <code>data-testid</code> attributes for your input fields makes your locators resilient to UI changes.</li>
<li><strong>Best Practice: Verify After Filling</strong>: Don't just assume <code>.fill()</code> worked. Add an assertion using <code>expect(locator).to_have_value("expected text")</code> to confirm the field contains the correct text. This makes your tests more robust.</li>
<li><strong>Best Practice: Fill with Realistic Data</strong>: Use data that a real user might enter. For email fields, use a valid email format. For numeric fields, use numbers. This can help catch validation issues.</li>
<li><strong>Best Practice: Understand Default Clearing</strong>: Remember that <code>.fill()</code> clears the field. If you need to append text character by character or simulate more nuanced typing, consider using <code>locator.press()</code> (covered in section 13.6).</li>
</ul>
<p>The <code>.fill()</code> method is a workhorse in UI automation. By understanding its mechanics—especially its simulation of user events and default clearing behavior—you can write effective and reliable tests for your Django application's forms and input fields. It's a crucial step in simulating a user's journey through your application.</p>
<h3 id="133-selecting-dropdowns-select_option" tabindex="-1"><a class="anchor" href="#133-selecting-dropdowns-select_option" name="133-selecting-dropdowns-select_option" tabindex="-1"><span class="octicon octicon-link"></span></a>13.3 Selecting Dropdowns: <code>.select_option()</code></h3>
<p>Dropdown menus, represented by the HTML <code>&lt;select&gt;</code> element, are a common way for users to choose one or more options from a predefined list. Interacting with these elements in an automated test requires a precise method to ensure the correct option is chosen and the application reacts accordingly. Playwright provides the <code>.select_option()</code> method, specifically designed for this purpose.</p>
<p><strong>Understanding HTML <code>&lt;select&gt;</code> Elements</strong></p>
<p>Before diving into Playwright's interaction, let's briefly revisit the structure of an HTML dropdown:</p>
<pre class="language-html" tabindex="0"><code class="language-html"><span class="token comment">&lt;!-- THIS_CODE_SNIPPET --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>country-select<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>country<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>--Please choose an option--<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>US<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>United States<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>CA<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Canada<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>GB<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>United Kingdom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>Let's examine this HTML snippet:</p>
<ol>
<li>The <code>&lt;select&gt;</code> tag defines the dropdown list.
<ul>
<li>It often has an <code>id</code> for easy targeting (e.g., <code>country-select</code>) and a <code>name</code> attribute used when submitting the form data (e.g., <code>country</code>).</li>
</ul>
</li>
<li>Each <code>&lt;option&gt;</code> tag within the <code>&lt;select&gt;</code> element represents an available choice.
<ul>
<li>The <code>value</code> attribute (e.g., <code>"US"</code>, <code>"CA"</code>) is the actual data sent to the server when the form is submitted. This is often a concise identifier.</li>
<li>The text content between the opening and closing <code>&lt;option&gt;</code> tags (e.g., "United States", "Canada") is what the user sees in the dropdown. This is often referred to as the "label" or "visible text".</li>
</ul>
</li>
</ol>
<p>When a user interacts with this dropdown, they click it to reveal the options and then click on their desired choice. The browser then updates the selected state of the <code>&lt;select&gt;</code> element and, importantly, often fires a <code>change</code> event, which JavaScript on the page might listen to for dynamic updates.</p>
<p><strong>Introducing <code>.select_option()</code></strong></p>
<p>Playwright's <code>.select_option()</code> method is the recommended way to programmatically select options within a <code>&lt;select&gt;</code> element. It abstracts away the low-level details of finding and clicking options, ensuring that the selection is made correctly and that relevant browser events are triggered.</p>
<p>The general usage pattern is:
<code>locator_for_select_element.select_option(...)</code></p>
<p>You first get a <code>Locator</code> for the <code>&lt;select&gt;</code> element itself, and then call <code>.select_option()</code> on that locator, passing arguments that specify which option(s) to select.</p>
<p><strong>Specifying Options to Select</strong></p>
<p>Playwright offers several flexible ways to tell <code>.select_option()</code> which option(s) you want to pick:</p>
<ol>
<li>
<p><strong>By Value:</strong> You can specify the <code>value</code> attribute of the <code>&lt;option&gt;</code> tag. This is often the most robust method, as values are typically stable identifiers.</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># Assuming 'page' is your Playwright Page object</span>
<span class="token comment"># And there's a &lt;select id="country-select"&gt; element</span>
country_dropdown <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#country-select"</span><span class="token punctuation">)</span>
country_dropdown<span class="token punctuation">.</span>select_option<span class="token punctuation">(</span><span class="token string">"CA"</span><span class="token punctuation">)</span> <span class="token comment"># Selects the option with value="CA"</span>
</code></pre>
<ul>
<li>In this snippet, <code>page.locator("#country-select")</code> targets the <code>&lt;select&gt;</code> element.</li>
<li><code>.select_option("CA")</code> tells Playwright to find an <code>&lt;option&gt;</code> child of this <code>&lt;select&gt;</code> element that has <code>value="CA"</code> and select it.</li>
</ul>
</li>
<li>
<p><strong>By Label (Visible Text):</strong> You can specify the visible text of the <code>&lt;option&gt;</code>.</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
country_dropdown <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#country-select"</span><span class="token punctuation">)</span>
country_dropdown<span class="token punctuation">.</span>select_option<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">"Canada"</span><span class="token punctuation">)</span> <span class="token comment"># Selects the option with text "Canada"</span>
</code></pre>
<ul>
<li>Here, <code>label="Canada"</code> instructs Playwright to find an <code>&lt;option&gt;</code> whose displayed text matches "Canada".</li>
<li>This can be more readable but might be less robust if the display text changes frequently (e.g., due to internationalization or minor wording tweaks).</li>
</ul>
</li>
<li>
<p><strong>By Index:</strong> You can specify the 0-based index of the <code>&lt;option&gt;</code> within the <code>&lt;select&gt;</code> element.</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
country_dropdown <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#country-select"</span><span class="token punctuation">)</span>
<span class="token comment"># Assuming "Canada" is the third option (index 2), after a placeholder and "United States"</span>
<span class="token comment"># &lt;option value=""&gt;--Please choose an option--&lt;/option&gt; &lt;!-- index 0 --&gt;</span>
<span class="token comment"># &lt;option value="US"&gt;United States&lt;/option&gt;           &lt;!-- index 1 --&gt;</span>
<span class="token comment"># &lt;option value="CA"&gt;Canada&lt;/option&gt;                  &lt;!-- index 2 --&gt;</span>
country_dropdown<span class="token punctuation">.</span>select_option<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre>
<ul>
<li><code>index=2</code> selects the third <code>&lt;option&gt;</code> element.</li>
<li>This is generally the most brittle approach, as the order of options can easily change, breaking your test. It should be used sparingly and only when other methods are not feasible.</li>
</ul>
</li>
</ol>
<p>You can also pass a dictionary to specify the selection criterion more explicitly, which is particularly useful if an option might have a value that looks like a label or vice-versa:
<code>country_dropdown.select_option({"value": "CA"})</code>
<code>country_dropdown.select_option({"label": "Canada"})</code>
<code>country_dropdown.select_option({"index": 2})</code></p>
<p><strong>Practical Example: Selecting an Option in a Django Form</strong></p>
<p>Let's consider a Django application where users can select their country from a dropdown.</p>
<p><strong>1. Django Setup (Illustrative)</strong></p>
<p>First, imagine we have a simple Django model, form, view, and template.</p>
<ul>
<li>
<p><code>models.py</code>:</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># myapp/models.py</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models

<span class="token keyword">class</span> <span class="token class-name">Profile</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
    country_code <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> blank<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>name
</code></pre>
<ul>
<li>This model <code>Profile</code> has a <code>country_code</code> field which we'll populate using a dropdown.</li>
</ul>
</li>
<li>
<p><code>forms.py</code>:</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># myapp/forms.py</span>
<span class="token keyword">from</span> django <span class="token keyword">import</span> forms
<span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> Profile

COUNTRY_CHOICES <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"--Select Country--"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">"US"</span><span class="token punctuation">,</span> <span class="token string">"United States"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">"CA"</span><span class="token punctuation">,</span> <span class="token string">"Canada"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">"GB"</span><span class="token punctuation">,</span> <span class="token string">"United Kingdom"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">"DE"</span><span class="token punctuation">,</span> <span class="token string">"Germany"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

<span class="token keyword">class</span> <span class="token class-name">ProfileForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
    country <span class="token operator">=</span> forms<span class="token punctuation">.</span>ChoiceField<span class="token punctuation">(</span>choices<span class="token operator">=</span>COUNTRY_CHOICES<span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">save_profile</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># In a real app, you'd likely use a ModelForm or handle instance creation/update</span>
        <span class="token comment"># This is simplified for demonstration</span>
        profile <span class="token operator">=</span> Profile<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
            name<span class="token operator">=</span>self<span class="token punctuation">.</span>cleaned_data<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            country_code<span class="token operator">=</span>self<span class="token punctuation">.</span>cleaned_data<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span>
        <span class="token punctuation">)</span>
        <span class="token keyword">return</span> profile
</code></pre>
<ul>
<li><code>COUNTRY_CHOICES</code> defines the options for our dropdown. Each tuple is <code>(value, label)</code>.</li>
<li><code>ProfileForm</code> includes a <code>country</code> field, which is a <code>ChoiceField</code>. Django will render this as a <code>&lt;select&gt;</code> element in a template.</li>
<li>The <code>save_profile</code> method is a simplified way to imagine saving data.</li>
</ul>
</li>
<li>
<p><code>views.py</code> (Simplified):</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># myapp/views.py</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render<span class="token punctuation">,</span> redirect
<span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> reverse
<span class="token keyword">from</span> <span class="token punctuation">.</span>forms <span class="token keyword">import</span> ProfileForm
<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> messages

<span class="token keyword">def</span> <span class="token function">create_profile_view</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>
        form <span class="token operator">=</span> ProfileForm<span class="token punctuation">(</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">)</span>
        <span class="token keyword">if</span> form<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            profile <span class="token operator">=</span> form<span class="token punctuation">.</span>save_profile<span class="token punctuation">(</span><span class="token punctuation">)</span>
            messages<span class="token punctuation">.</span>success<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"Profile for </span><span class="token interpolation"><span class="token punctuation">{</span>profile<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string"> created with country </span><span class="token interpolation"><span class="token punctuation">{</span>profile<span class="token punctuation">.</span>country_code<span class="token punctuation">}</span></span><span class="token string">."</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>reverse<span class="token punctuation">(</span><span class="token string">'profile_success'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># Assume 'profile_success' is a simple success page</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        form <span class="token operator">=</span> ProfileForm<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'myapp/profile_form.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'form'</span><span class="token punctuation">:</span> form<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">profile_success_view</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'myapp/profile_success.html'</span><span class="token punctuation">)</span>
</code></pre>
<ul>
<li>This view handles both displaying the empty form (GET) and processing the submitted form (POST).</li>
<li>On successful submission, it saves a profile and redirects.</li>
</ul>
</li>
<li>
<p><code>profile_form.html</code> (Template):</p>
<pre class="language-html" tabindex="0"><code class="language-html"><span class="token comment">&lt;!-- THIS_CODE_SNIPPET --&gt;</span>
<span class="token comment">&lt;!-- myapp/templates/myapp/profile_form.html --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    {% csrf_token %}
    {{ form.as_p }}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Submit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>

{% if messages %}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>messages<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    {% for message in messages %}
    &lt;li{% if message.tags %} class="{{ message.tags }}"{% endif %}&gt;{{ message }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    {% endfor %}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
{% endif %}
</code></pre>
<ul>
<li>This template renders the Django form. <code>{{ form.as_p }}</code> will render the <code>name</code> field as an <code>&lt;input type="text"&gt;</code> and the <code>country</code> <code>ChoiceField</code> as a <code>&lt;select&gt;</code> element with <code>&lt;option&gt;</code> tags corresponding to <code>COUNTRY_CHOICES</code>. The <code>country</code> field will likely have an <code>id</code> like <code>id_country</code> by default.</li>
</ul>
</li>
</ul>
<p><strong>2. Playwright Test for Single Selection</strong></p>
<p>Now, let's write a Playwright test to interact with this form.</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># tests/e2e/test_profile_creation.py</span>
<span class="token keyword">import</span> pytest
<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> Page<span class="token punctuation">,</span> expect
<span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> reverse

<span class="token keyword">from</span> myapp<span class="token punctuation">.</span>models <span class="token keyword">import</span> Profile <span class="token comment"># Assuming your models.py is accessible</span>

<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>mark<span class="token punctuation">.</span>django_db</span>
<span class="token keyword">def</span> <span class="token function">test_create_profile_with_country_selection</span><span class="token punctuation">(</span>page<span class="token punctuation">:</span> Page<span class="token punctuation">,</span> live_server<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Arrange: Navigate to the form page</span>
    form_url <span class="token operator">=</span> live_server<span class="token punctuation">.</span>url <span class="token operator">+</span> reverse<span class="token punctuation">(</span><span class="token string">'create_profile'</span><span class="token punctuation">)</span> <span class="token comment"># Assuming 'create_profile' is the URL name</span>
    page<span class="token punctuation">.</span>goto<span class="token punctuation">(</span>form_url<span class="token punctuation">)</span>

    <span class="token comment"># Act: Fill in the name</span>
    page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#id_name"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token string">"Alice Wonderland"</span><span class="token punctuation">)</span>

    <span class="token comment"># Act: Select a country from the dropdown</span>
    <span class="token comment"># We'll use the 'value' attribute for selection, which is 'CA' for Canada.</span>
    <span class="token comment"># Django typically renders ChoiceField select elements with an id like 'id_&lt;fieldname&gt;'</span>
    country_dropdown_locator <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#id_country"</span><span class="token punctuation">)</span>
    country_dropdown_locator<span class="token punctuation">.</span>select_option<span class="token punctuation">(</span><span class="token string">"CA"</span><span class="token punctuation">)</span> <span class="token comment"># Select by value</span>

    <span class="token comment"># Act: Submit the form</span>
    page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"button[type='submit']"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># Assert: Check for success message and data persistence</span>
    <span class="token comment"># 1. Check for success message on the page (assuming redirection to a success page or message display)</span>
    <span class="token comment">#    For this example, let's assume the success message appears on the same page or a redirected one.</span>
    <span class="token comment">#    We'll use the message content from the view.</span>
    expect<span class="token punctuation">(</span>page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">".messages .success"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to_contain_text<span class="token punctuation">(</span><span class="token string">"Profile for Alice Wonderland created with country CA."</span><span class="token punctuation">)</span>

    <span class="token comment"># 2. Assert that the data was saved correctly in the database</span>
    <span class="token keyword">assert</span> Profile<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span>
    profile <span class="token operator">=</span> Profile<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">assert</span> profile<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">"Alice Wonderland"</span>
    <span class="token keyword">assert</span> profile<span class="token punctuation">.</span>country_code <span class="token operator">==</span> <span class="token string">"CA"</span>
</code></pre>
<p>Let's break down this test:</p>
<ol>
<li><strong><code>@pytest.mark.django_db</code></strong>: This marker is crucial. It ensures that a test database is set up for this test, allowing us to interact with Django models safely and in isolation.</li>
<li><strong><code>page: Page, live_server</code></strong>: These are <code>pytest-playwright</code> and <code>pytest-django</code> fixtures, respectively. <code>page</code> provides the browser context, and <code>live_server</code> starts a real Django server running your application with the test database.</li>
<li><strong><code>form_url = live_server.url + reverse('create_profile')</code></strong>: We construct the full URL to our form page. <code>live_server.url</code> gives the base URL of the running test server (e.g., <code>http://localhost:8081</code>), and <code>reverse('create_profile')</code> gets the path for our view.</li>
<li><strong><code>page.goto(form_url)</code></strong>: Navigates the browser to the profile creation form.</li>
<li><strong><code>page.locator("#id_name").fill("Alice Wonderland")</code></strong>: Fills the "name" input field. Django forms typically generate IDs like <code>id_&lt;field_name&gt;</code>.</li>
<li><strong><code>country_dropdown_locator = page.locator("#id_country")</code></strong>: We get a <code>Locator</code> for our <code>&lt;select&gt;</code> element. Again, <code>id_country</code> is the typical ID Django would generate for a field named <code>country</code>.</li>
<li><strong><code>country_dropdown_locator.select_option("CA")</code></strong>: This is the core action.
<ul>
<li>It targets the <code>&lt;select id="id_country"&gt;</code> element.</li>
<li>It then looks for an <code>&lt;option&gt;</code> child element with <code>value="CA"</code>.</li>
<li>It programmatically selects this option. Playwright ensures that this triggers any associated <code>change</code> events on the element, mimicking user behavior.</li>
<li>We chose to select by <code>value</code> ("CA") because it's generally more stable than relying on the visible label ("Canada"), which might change for localization or display purposes.</li>
</ul>
</li>
<li><strong><code>page.locator("button[type='submit']").click()</code></strong>: Finds the submit button and clicks it.</li>
<li><strong><code>expect(page.locator(".messages .success")).to_contain_text(...)</code></strong>: This assertion checks if a success message (as defined in our view) is visible on the page after submission. We assume the message is displayed within an element with class <code>success</code> inside an element with class <code>messages</code>.</li>
<li><strong><code>assert Profile.objects.count() == 1</code></strong>: We query the test database directly to verify that a <code>Profile</code> object was created.</li>
<li><strong><code>profile = Profile.objects.first()</code></strong>: Retrieves the created profile.</li>
<li><strong><code>assert profile.name == "Alice Wonderland"</code> and <code>assert profile.country_code == "CA"</code></strong>: These lines confirm that the data stored in the database matches what we submitted, including the selected country code.</li>
</ol>
<p>This example demonstrates how <code>.select_option()</code> fits into a typical E2E test flow for a Django form. The key is to correctly locate the <code>&lt;select&gt;</code> element and then use <code>.select_option()</code> with a reliable identifier for the desired <code>&lt;option&gt;</code>.</p>
<p><strong>Selecting Multiple Options</strong></p>
<p>If your <code>&lt;select&gt;</code> element allows multiple selections (i.e., it has the <code>multiple</code> attribute: <code>&lt;select multiple name="colors"&gt;...</code>), you can pass a list of values, labels, or indices to <code>.select_option()</code>.</p>
<p>Consider this HTML for a multi-select dropdown:</p>
<pre class="language-html" tabindex="0"><code class="language-html"><span class="token comment">&lt;!-- THIS_CODE_SNIPPET --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>colors-select<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>colors<span class="token punctuation">"</span></span> <span class="token attr-name">multiple</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>red<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Red<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>green<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Green<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blue<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Blue<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>yellow<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Yellow<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>You can select multiple options like this:</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># Assuming 'page' is your Playwright Page object</span>
colors_multiselect <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#colors-select"</span><span class="token punctuation">)</span>

<span class="token comment"># Select "Red" and "Blue" by their values</span>
colors_multiselect<span class="token punctuation">.</span>select_option<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token string">"blue"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># You can also select by label</span>
<span class="token comment"># colors_multiselect.select_option([{"label": "Red"}, {"label": "Blue"}])</span>

<span class="token comment"># Or by index</span>
<span class="token comment"># colors_multiselect.select_option([{"index": 0}, {"index": 2}]) # Red (index 0), Blue (index 2)</span>
</code></pre>
<p>Let's examine this code:</p>
<ol>
<li><strong><code>colors_multiselect = page.locator("#colors-select")</code></strong>: We get a locator for the multi-select dropdown.</li>
<li><strong><code>colors_multiselect.select_option(["red", "blue"])</code></strong>:
<ul>
<li>We pass a list of strings <code>["red", "blue"]</code> to <code>select_option()</code>.</li>
<li>Playwright interprets these as values and selects the <code>&lt;option value="red"&gt;</code> and <code>&lt;option value="blue"&gt;</code> elements.</li>
<li>If the dropdown were not a multi-select, typically only the last item in the list would end up being selected, or it might result in an error, depending on the browser and exact element behavior. For true multi-select elements, all specified options are selected.</li>
</ul>
</li>
<li>The commented-out lines show alternative ways to select multiple options using lists of dictionaries, specifying either <code>label</code> or <code>index</code> for each option. This provides clarity when mixing selection strategies or when values/labels might be ambiguous.</li>
</ol>
<p>When working with Django forms that have a <code>MultipleChoiceField</code> rendered as a multi-select dropdown, this list-based approach to <code>select_option()</code> is what you would use.</p>
<p><strong>Asserting the Selection</strong></p>
<p>After selecting an option, you might want to verify that the dropdown reflects the new selection. Playwright's <code>expect</code> assertions can be used for this.</p>
<p>For a <strong>single-select</strong> dropdown:</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># Continuing from the single-select example:</span>
country_dropdown_locator <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#id_country"</span><span class="token punctuation">)</span>
country_dropdown_locator<span class="token punctuation">.</span>select_option<span class="token punctuation">(</span><span class="token string">"CA"</span><span class="token punctuation">)</span>

<span class="token comment"># Assert that the dropdown's current value is "CA"</span>
expect<span class="token punctuation">(</span>country_dropdown_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_value<span class="token punctuation">(</span><span class="token string">"CA"</span><span class="token punctuation">)</span>

<span class="token comment"># You can also check the label of the selected option, though this is more complex</span>
<span class="token comment"># as you need to find the selected &lt;option&gt; element first.</span>
<span class="token comment"># For example, if the selected option gets a 'selected' attribute (browser-dependent):</span>
<span class="token comment"># selected_option_label = country_dropdown_locator.locator("option[selected]").text_content()</span>
<span class="token comment"># assert selected_option_label == "Canada"</span>
<span class="token comment"># However, to_have_value is generally more straightforward for single-select.</span>
</code></pre>
<p>Let's analyze this assertion snippet:</p>
<ol>
<li><strong><code>expect(country_dropdown_locator).to_have_value("CA")</code></strong>:
<ul>
<li>This is the most direct way to assert the selected value of a <code>&lt;select&gt;</code> element.</li>
<li><code>to_have_value()</code> checks the current <code>value</code> property of the DOM element. For a <code>&lt;select&gt;</code> element, this property reflects the <code>value</code> attribute of the currently selected <code>&lt;option&gt;</code>.</li>
<li>This assertion is concise and directly tests what matters for form submission.</li>
</ul>
</li>
</ol>
<p>For a <strong>multi-select</strong> dropdown, asserting selected values is slightly different as <code>to_have_value</code> typically returns the value of the <em>first</em> selected option. Instead, you'd usually check <code>to_have_values</code>:</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># Continuing from the multi-select example:</span>
colors_multiselect <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#colors-select"</span><span class="token punctuation">)</span>
colors_multiselect<span class="token punctuation">.</span>select_option<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token string">"blue"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># Assert that the dropdown has the specified values selected</span>
<span class="token comment"># The order in the list for to_have_values usually matters and should match the selection order</span>
<span class="token comment"># or the order they appear in the DOM if selection order isn't guaranteed.</span>
expect<span class="token punctuation">(</span>colors_multiselect<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_values<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token string">"blue"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<p>Let's analyze this multi-select assertion:</p>
<ol>
<li><strong><code>expect(colors_multiselect).to_have_values(["red", "blue"])</code></strong>:
<ul>
<li>The <code>to_have_values()</code> assertion is designed for elements that can have multiple values, such as a <code>&lt;select multiple&gt;</code>.</li>
<li>It checks that the set of selected option values matches the provided list. The order of items in the list passed to <code>to_have_values</code> typically needs to match the order of the selected options.</li>
</ul>
</li>
</ol>
<p><strong>Why <code>.select_option()</code> is Preferred</strong></p>
<p>You might wonder why you can't just locate the specific <code>&lt;option&gt;</code> element and <code>.click()</code> it. While clicking an option might work in some simple cases, <code>.select_option()</code> is more robust and semantically correct for several reasons:</p>
<ol>
<li><strong>Handles Events Correctly:</strong> Selecting an option in a dropdown often triggers JavaScript <code>change</code> events. <code>.select_option()</code> is designed to ensure these events are fired appropriately, just as a browser would when a user makes a selection. Manually clicking might not always trigger these events consistently across all scenarios.</li>
<li><strong>Declarative Intent:</strong> <code>.select_option("CA")</code> clearly states your intent: "I want the option with value 'CA' to be selected." This is more readable and maintainable than a sequence of clicks that might be necessary to open the dropdown and then click an option.</li>
<li><strong>Works with Hidden Options:</strong> Some dropdowns might not have all options immediately visible in the DOM until the dropdown is interacted with. <code>.select_option()</code> handles the necessary interactions to make the selection.</li>
<li><strong>Actionability:</strong> Like other Playwright actions, <code>.select_option()</code> performs actionability checks. It waits for the <code>&lt;select&gt;</code> element to be visible, enabled, and stable before attempting to change its value.</li>
</ol>
<p><strong>Common Pitfalls and Best Practices</strong></p>
<ol>
<li><strong>Dynamic Dropdowns:</strong> If the options in your dropdown are loaded dynamically (e.g., via JavaScript based on a previous selection, or fetched from an API), ensure the desired option exists <em>before</em> you try to select it.
<ul>
<li><strong>Solution:</strong> Use a Playwright assertion with a timeout to wait for the option to appear. For example, before <code>select_option(label="Dynamic Option")</code>:<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># page.locator("#my-dynamic-dropdown option[value='dyn_val']").wait_for()</span>
<span class="token comment"># OR, using expect:</span>
<span class="token comment"># expect(page.locator("#my-dynamic-dropdown option[value='dyn_val']")).to_be_visible()</span>
<span class="token comment"># Then:</span>
<span class="token comment"># page.locator("#my-dynamic-dropdown").select_option("dyn_val")</span>
</code></pre>
</li>
</ul>
</li>
<li><strong>Robust Locators for Options:</strong>
<ul>
<li><strong>Prefer <code>value</code>:</strong> As mentioned, selecting by <code>value</code> is usually the most robust because values are less likely to change than display text (labels) or option order (index).</li>
<li><strong>Unique Labels:</strong> If you must use labels, ensure they are unique enough within that dropdown to avoid ambiguity.</li>
</ul>
</li>
<li><strong>Custom Dropdown Widgets:</strong> Many websites use custom JavaScript-based dropdown widgets that don't use standard HTML <code>&lt;select&gt;</code> and <code>&lt;option&gt;</code> elements (e.g., they might use <code>&lt;div&gt;</code>s, <code>&lt;ul&gt;</code>s, and <code>&lt;li&gt;</code>s to simulate a dropdown).
<ul>
<li><strong>Solution:</strong> <code>.select_option()</code> will <strong>not</strong> work on these custom widgets. You'll need to interact with them as a user would:
<ol>
<li>Click the element that opens the custom dropdown.</li>
<li>Wait for the desired option element (e.g., an <code>&lt;li&gt;</code> with specific text) to become visible.</li>
<li>Click that option element.</li>
</ol>
</li>
<li>This often requires more specific locators and careful handling of visibility and timing.</li>
</ul>
</li>
<li><strong>Invisible <code>&lt;select&gt;</code> Elements:</strong> Sometimes, a custom widget might still use an underlying <code>&lt;select&gt;</code> element for form submission but keep it hidden. If the actual <code>&lt;select&gt;</code> is hidden (<code>display: none</code> or <code>visibility: hidden</code>), Playwright's actionability checks might prevent <code>.select_option()</code> from working directly on it unless you use <code>force=True</code> (which is generally discouraged as it bypasses user-like interaction checks). The preferred way is to interact with the visible parts of the custom widget.</li>
</ol>
<p>By understanding how HTML dropdowns work and leveraging the power and flexibility of <code>.select_option()</code>, you can reliably test user interactions with these common form elements in your Django applications. Always prioritize selecting options by their <code>value</code> for robustness, and be mindful of dynamic content or custom widgets that may require different interaction strategies.</p>
<h2 id="134-checkboxes-and-radio-buttons-check-uncheck" tabindex="-1"><a class="anchor" href="#134-checkboxes-and-radio-buttons-check-uncheck" name="134-checkboxes-and-radio-buttons-check-uncheck" tabindex="-1"><span class="octicon octicon-link"></span></a>13.4 Checkboxes and Radio Buttons: <code>.check()</code>, <code>.uncheck()</code></h2>
<p>Checkboxes and radio buttons are fundamental HTML form elements that allow users to make selections. Checkboxes permit zero, one, or multiple selections from a set of options, while radio buttons (when grouped correctly) restrict the user to a single choice from a mutually exclusive set. Testing these interactions is crucial for ensuring your forms behave as expected. Playwright provides intuitive methods, <code>.check()</code> and <code>.uncheck()</code>, specifically designed for these elements.</p>
<p><strong>Understanding Checkboxes and Radio Buttons in Web Forms</strong></p>
<p>Before diving into Playwright's methods, let's briefly revisit the HTML elements themselves:</p>
<ul>
<li>
<p><strong>Checkboxes (<code>&lt;input type="checkbox"&gt;</code>)</strong>: Each checkbox operates independently (unless JavaScript adds custom grouping logic). A user can select or deselect any checkbox. They are typically used for options like "Remember me," "Subscribe to newsletter," or selecting multiple items from a list.</p>
<pre class="language-html" tabindex="0"><code class="language-html"><span class="token comment">&lt;!-- THIS_CODE_SNIPPET --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>subscribe<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>newsletter<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  Subscribe to newsletter
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>terms<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>agree<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  I agree to the terms and conditions
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>In this HTML snippet:</p>
<ol>
<li>We have two checkboxes.</li>
<li>The first is for "Subscribe to newsletter" with <code>name="subscribe"</code>.</li>
<li>The second is for "I agree to the terms and conditions" with <code>name="terms"</code>.</li>
<li>A user can check one, both, or neither.</li>
</ol>
</li>
<li>
<p><strong>Radio Buttons (<code>&lt;input type="radio"&gt;</code>)</strong>: Radio buttons work in groups. All radio buttons sharing the same <code>name</code> attribute form a group, and only one button within that group can be selected at any given time. Selecting one automatically deselects any other previously selected button in the same group. They are used for choices like "Payment method: Credit Card / PayPal / Bank Transfer" or "Gender: Male / Female / Other."</p>
<pre class="language-html" tabindex="0"><code class="language-html"><span class="token comment">&lt;!-- THIS_CODE_SNIPPET --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>legend</span><span class="token punctuation">&gt;</span></span>Preferred Contact Method:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>legend</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>radio<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contact_method<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">checked</span><span class="token punctuation">&gt;</span></span>
    Email
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>radio<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contact_method<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>phone<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    Phone
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>radio<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contact_method<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mail<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    Mail
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>In this HTML snippet:</p>
<ol>
<li>We have a group of three radio buttons for "Preferred Contact Method," all sharing <code>name="contact_method"</code>.</li>
<li>The <code>checked</code> attribute on the "Email" option indicates it's selected by default.</li>
<li>A user can only select one of "Email," "Phone," or "Mail." If "Email" is selected and the user clicks "Phone," "Email" will become deselected, and "Phone" will become selected.</li>
</ol>
</li>
</ul>
<p>Playwright's <code>.check()</code> and <code>.uncheck()</code> methods are designed to interact with these elements in a way that mirrors user behavior and respects their intrinsic properties.</p>
<h3 id="1341-interacting-with-checkboxes-using-playwright" tabindex="-1"><a class="anchor" href="#1341-interacting-with-checkboxes-using-playwright" name="1341-interacting-with-checkboxes-using-playwright" tabindex="-1"><span class="octicon octicon-link"></span></a>13.4.1 Interacting with Checkboxes using Playwright</h3>
<h4 id="the-check-method-for-checkboxes" tabindex="-1"><a class="anchor" href="#the-check-method-for-checkboxes" name="the-check-method-for-checkboxes" tabindex="-1"><span class="octicon octicon-link"></span></a>The <code>.check()</code> Method for Checkboxes</h4>
<p>The <code>.check()</code> method is used to ensure a checkbox is in the "checked" (selected) state.</p>
<ul>
<li><strong>Purpose</strong>: To select a checkbox.</li>
<li><strong>Behavior</strong>:
<ul>
<li>If the checkbox is currently unchecked, <code>.check()</code> will click it, changing its state to checked.</li>
<li>If the checkbox is already checked, <code>.check()</code> does nothing; the checkbox remains checked. This property is known as <strong>idempotency</strong> – applying the operation multiple times has the same effect as applying it once. This is beneficial because you don't need to know the current state of the checkbox before calling <code>.check()</code> if your goal is to ensure it's checked.</li>
</ul>
</li>
<li><strong>Actionability</strong>: Before attempting to check, Playwright performs actionability checks, ensuring the checkbox is visible, enabled, and not obscured.</li>
</ul>
<p>Let's see an example. Assume you have the following HTML:</p>
<pre class="language-html" tabindex="0"><code class="language-html"><span class="token comment">&lt;!-- THIS_CODE_SNIPPET --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>subscribe-checkbox<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Subscribe to updates:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>subscribe-checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>subscribe<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>And here's how you might test it:</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> Page<span class="token punctuation">,</span> expect

<span class="token keyword">def</span> <span class="token function">test_check_newsletter_subscription</span><span class="token punctuation">(</span>page<span class="token punctuation">:</span> Page<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Arrange: Navigate to the page with the checkbox</span>
    page<span class="token punctuation">.</span>set_content<span class="token punctuation">(</span><span class="token string">'&lt;input type="checkbox" id="subscribe-checkbox" name="subscribe"&gt;'</span><span class="token punctuation">)</span>
    subscribe_checkbox <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#subscribe-checkbox"</span><span class="token punctuation">)</span>

    <span class="token comment"># Act: Check the checkbox</span>
    subscribe_checkbox<span class="token punctuation">.</span>check<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># Assert: Verify the checkbox is checked</span>
    expect<span class="token punctuation">(</span>subscribe_checkbox<span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_checked<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>Let's examine this code in detail:</p>
<ol>
<li><code>page.set_content(...)</code>: For this standalone example, we're directly setting the HTML content of the page. In a real Django test, you'd use <code>page.goto(live_server.url + reverse('your_view_name'))</code>.</li>
<li><code>subscribe_checkbox = page.locator("#subscribe-checkbox")</code>: We first locate the checkbox using its ID. As discussed in Chapter 11, you could also use other locators like <code>page.get_by_label("Subscribe to updates:")</code> if the label were correctly associated.</li>
<li><code>subscribe_checkbox.check()</code>: This is the core action. Playwright finds the element and, if it's not already checked, performs the necessary interaction (typically a click) to check it. If it were already checked, this line would effectively do nothing but still pass the actionability checks.</li>
<li><code>expect(subscribe_checkbox).to_be_checked()</code>: After performing the action, we assert that the checkbox is indeed in the checked state. This confirms our interaction had the desired effect. This uses Playwright's assertion library, covered in Chapter 12.</li>
</ol>
<h4 id="the-uncheck-method-for-checkboxes" tabindex="-1"><a class="anchor" href="#the-uncheck-method-for-checkboxes" name="the-uncheck-method-for-checkboxes" tabindex="-1"><span class="octicon octicon-link"></span></a>The <code>.uncheck()</code> Method for Checkboxes</h4>
<p>Conversely, the <code>.uncheck()</code> method ensures a checkbox is in the "unchecked" (deselected) state.</p>
<ul>
<li><strong>Purpose</strong>: To deselect a checkbox.</li>
<li><strong>Behavior</strong>:
<ul>
<li>If the checkbox is currently checked, <code>.uncheck()</code> will click it, changing its state to unchecked.</li>
<li>If the checkbox is already unchecked, <code>.uncheck()</code> does nothing; the checkbox remains unchecked. This method is also idempotent.</li>
</ul>
</li>
<li><strong>Actionability</strong>: Similar to <code>.check()</code>, Playwright performs actionability checks before attempting to uncheck.</li>
</ul>
<p>Using the same HTML as above:</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> Page<span class="token punctuation">,</span> expect

<span class="token keyword">def</span> <span class="token function">test_uncheck_newsletter_subscription</span><span class="token punctuation">(</span>page<span class="token punctuation">:</span> Page<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Arrange: Navigate and ensure the checkbox is initially checked</span>
    page<span class="token punctuation">.</span>set_content<span class="token punctuation">(</span><span class="token string">'&lt;input type="checkbox" id="subscribe-checkbox" name="subscribe" checked&gt;'</span><span class="token punctuation">)</span>
    subscribe_checkbox <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#subscribe-checkbox"</span><span class="token punctuation">)</span>

    <span class="token comment"># Act: Uncheck the checkbox</span>
    subscribe_checkbox<span class="token punctuation">.</span>uncheck<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># Assert: Verify the checkbox is unchecked</span>
    expect<span class="token punctuation">(</span>subscribe_checkbox<span class="token punctuation">)</span><span class="token punctuation">.</span>not_to_be_checked<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># Or, more explicitly for unchecked state:</span>
    <span class="token comment"># expect(subscribe_checkbox).to_be_checked(checked=False)</span>
</code></pre>
<p>Let's break down this example:</p>
<ol>
<li><code>page.set_content('&lt;input type="checkbox" id="subscribe-checkbox" name="subscribe" checked&gt;')</code>: Notice the <code>checked</code> attribute in the HTML. We start with the checkbox already selected.</li>
<li><code>subscribe_checkbox = page.locator("#subscribe-checkbox")</code>: We locate the checkbox.</li>
<li><code>subscribe_checkbox.uncheck()</code>: Playwright interacts with the checkbox to deselect it.</li>
<li><code>expect(subscribe_checkbox).not_to_be_checked()</code>: We assert that the checkbox is now unchecked. The alternative <code>expect(subscribe_checkbox).to_be_checked(checked=False)</code> is also valid and perhaps more explicit about expecting an unchecked state.</li>
</ol>
<h4 id="asserting-checkbox-state" tabindex="-1"><a class="anchor" href="#asserting-checkbox-state" name="asserting-checkbox-state" tabindex="-1"><span class="octicon octicon-link"></span></a>Asserting Checkbox State</h4>
<p>As shown in the examples, the primary way to assert the state of a checkbox is using <code>expect(locator).to_be_checked()</code>.</p>
<ul>
<li><code>expect(locator).to_be_checked()</code>: Asserts that the checkbox is currently checked.</li>
<li><code>expect(locator).not_to_be_checked()</code>: Asserts that the checkbox is currently unchecked.</li>
<li><code>expect(locator).to_be_checked(checked=False)</code>: An alternative, more explicit way to assert it's unchecked.</li>
<li><code>expect(locator).to_be_checked(checked=True)</code>: Equivalent to <code>expect(locator).to_be_checked()</code>.</li>
</ul>
<p>It's a crucial best practice to always assert the state of the checkbox after an interaction to confirm the action was successful and the application state is as expected.</p>
<h3 id="1342-interacting-with-radio-buttons-using-playwright" tabindex="-1"><a class="anchor" href="#1342-interacting-with-radio-buttons-using-playwright" name="1342-interacting-with-radio-buttons-using-playwright" tabindex="-1"><span class="octicon octicon-link"></span></a>13.4.2 Interacting with Radio Buttons using Playwright</h3>
<p>Radio buttons behave differently from checkboxes, primarily because they are part of a group where only one can be selected.</p>
<h4 id="the-check-method-for-radio-buttons" tabindex="-1"><a class="anchor" href="#the-check-method-for-radio-buttons" name="the-check-method-for-radio-buttons" tabindex="-1"><span class="octicon octicon-link"></span></a>The <code>.check()</code> Method for Radio Buttons</h4>
<p>The <code>.check()</code> method is also used for radio buttons, but its effect considers the group dynamics.</p>
<ul>
<li><strong>Purpose</strong>: To select a specific radio button within its group.</li>
<li><strong>Behavior</strong>:
<ul>
<li>If the target radio button is not already selected, <code>.check()</code> will select it.</li>
<li>Crucially, if another radio button in the same <code>name</code> group was previously selected, it will become unselected as a result of checking the new one. This mimics standard browser behavior for radio button groups.</li>
<li>If the target radio button is already selected, <code>.check()</code> does nothing (idempotent for the target button itself).</li>
</ul>
</li>
<li><strong>Actionability</strong>: Playwright performs actionability checks (visible, enabled, etc.) on the target radio button.</li>
</ul>
<p>Consider this HTML for a radio button group:</p>
<pre class="language-html" tabindex="0"><code class="language-html"><span class="token comment">&lt;!-- THIS_CODE_SNIPPET --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>legend</span><span class="token punctuation">&gt;</span></span>Preferred Contact Method:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>legend</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>radio<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contact_method<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contact-email<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    Email
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>radio<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contact_method<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>phone<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contact-phone<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    Phone
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>Here's how you might test selecting a radio button:</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> Page<span class="token punctuation">,</span> expect

<span class="token keyword">def</span> <span class="token function">test_select_radio_button</span><span class="token punctuation">(</span>page<span class="token punctuation">:</span> Page<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Arrange</span>
    page<span class="token punctuation">.</span>set_content<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""
        &lt;fieldset&gt;
          &lt;legend&gt;Preferred Contact Method:&lt;/legend&gt;
          &lt;label&gt;
            &lt;input type="radio" name="contact_method" value="email" id="contact-email"&gt;
            Email
          &lt;/label&gt;
          &lt;label&gt;
            &lt;input type="radio" name="contact_method" value="phone" id="contact-phone"&gt;
            Phone
          &lt;/label&gt;
        &lt;/fieldset&gt;
    """</span><span class="token punctuation">)</span>
    email_radio <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#contact-email"</span><span class="token punctuation">)</span>
    phone_radio <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#contact-phone"</span><span class="token punctuation">)</span>

    <span class="token comment"># Act: Select the 'phone' radio button</span>
    phone_radio<span class="token punctuation">.</span>check<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># Assert: Verify 'phone' is checked and 'email' is not</span>
    expect<span class="token punctuation">(</span>phone_radio<span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_checked<span class="token punctuation">(</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>email_radio<span class="token punctuation">)</span><span class="token punctuation">.</span>not_to_be_checked<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># or .to_be_checked(checked=False)</span>
</code></pre>
<p>Let's analyze this code:</p>
<ol>
<li><code>page.set_content(...)</code>: We set up HTML with two radio buttons in the group <code>contact_method</code>. Neither is checked initially.</li>
<li><code>email_radio = page.locator("#contact-email")</code> and <code>phone_radio = page.locator("#contact-phone")</code>: We get locators for both radio buttons.</li>
<li><code>phone_radio.check()</code>: We call <code>.check()</code> on the "Phone" radio button. This action selects it.</li>
<li><code>expect(phone_radio).to_be_checked()</code>: We assert that the "Phone" radio button is now selected.</li>
<li><code>expect(email_radio).not_to_be_checked()</code>: Crucially, we also assert that the "Email" radio button (which is in the same group) is <em>not</em> checked. This confirms the mutual exclusivity of radio buttons.</li>
</ol>
<p><strong>Why is the <code>name</code> attribute important?</strong>
The <code>name</code> attribute is what HTML uses to group radio buttons. All <code>&lt;input type="radio"&gt;</code> elements with the same <code>name</code> value belong to the same group. When you <code>.check()</code> one radio button in a group, the browser (and thus Playwright, which controls the browser) automatically unchecks any other radio button in that same group that might have been previously checked. If radio buttons have different <code>name</code> attributes (or no <code>name</code> attribute), they are not considered part of the same group, and checking one will not affect the others.</p>
<h4 id="why-uncheck-is-not-typically-used-for-radio-buttons" tabindex="-1"><a class="anchor" href="#why-uncheck-is-not-typically-used-for-radio-buttons" name="why-uncheck-is-not-typically-used-for-radio-buttons" tabindex="-1"><span class="octicon octicon-link"></span></a>Why <code>.uncheck()</code> is Not Typically Used for Radio Buttons</h4>
<p>Playwright's <code>.uncheck()</code> method is primarily designed for checkboxes. You generally <strong>do not use <code>.uncheck()</code> on a radio button</strong>.</p>
<ul>
<li><strong>The "Why"</strong>: The fundamental design of radio button groups is that one option <em>must</em> be selected (once any selection has been made within the group, unless specific non-standard JavaScript logic is involved or no default is set and no interaction has occurred). To "uncheck" a radio button, you select <em>another</em> radio button in its group. There isn't a direct user action to simply "uncheck" a selected radio button and leave the group with no selection (again, barring custom JavaScript).</li>
<li><strong>Playwright's Behavior</strong>: If you attempt to call <code>.uncheck()</code> on a radio button:
<ul>
<li>It might throw an error because the operation is not semantically valid for a radio button.</li>
<li>It might have no effect.
The exact behavior can sometimes depend on the browser and specific state, but the guiding principle is: <strong>to change a radio button selection, <code>.check()</code> the desired new option.</strong></li>
</ul>
</li>
</ul>
<p>If you find yourself needing to ensure no radio button in a group is selected, this usually implies a flaw in the form design or a misunderstanding of how radio groups are intended to work. However, if a form <em>can</em> legitimately be in a state where no radio button in a group is selected (e.g., before any user interaction and no default <code>checked</code> attribute), your assertions would simply check that all radio buttons in that group are <code>not_to_be_checked()</code>.</p>
<h4 id="asserting-radio-button-state" tabindex="-1"><a class="anchor" href="#asserting-radio-button-state" name="asserting-radio-button-state" tabindex="-1"><span class="octicon octicon-link"></span></a>Asserting Radio Button State</h4>
<p>Similar to checkboxes, you use <code>expect(locator).to_be_checked()</code>:</p>
<ul>
<li><code>expect(radio_locator_selected).to_be_checked()</code>: Asserts the specific radio button is selected.</li>
<li><code>expect(radio_locator_unselected).not_to_be_checked()</code>: Asserts another radio button in the group is not selected.</li>
</ul>
<p>When testing radio buttons, it's good practice to assert the state of the one you intended to select <em>and</em> at least one other in the group (or all others, if critical) to ensure the grouping logic is working correctly.</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> Page<span class="token punctuation">,</span> expect

<span class="token keyword">def</span> <span class="token function">test_radio_button_group_behavior</span><span class="token punctuation">(</span>page<span class="token punctuation">:</span> Page<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Arrange</span>
    page<span class="token punctuation">.</span>set_content<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""
        &lt;input type="radio" name="payment" value="cc" id="payment-cc" checked&gt; CC
        &lt;input type="radio" name="payment" value="paypal" id="payment-paypal"&gt; PayPal
    """</span><span class="token punctuation">)</span>
    cc_radio <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#payment-cc"</span><span class="token punctuation">)</span>
    paypal_radio <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#payment-paypal"</span><span class="token punctuation">)</span>

    <span class="token comment"># Initial state check</span>
    expect<span class="token punctuation">(</span>cc_radio<span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_checked<span class="token punctuation">(</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>paypal_radio<span class="token punctuation">)</span><span class="token punctuation">.</span>not_to_be_checked<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># Act: Select PayPal</span>
    paypal_radio<span class="token punctuation">.</span>check<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># Assert: PayPal is checked, CC is not</span>
    expect<span class="token punctuation">(</span>paypal_radio<span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_checked<span class="token punctuation">(</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>cc_radio<span class="token punctuation">)</span><span class="token punctuation">.</span>not_to_be_checked<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>This example demonstrates:</p>
<ol>
<li>Setting up HTML with "CC" initially checked.</li>
<li>Asserting the initial state.</li>
<li>Performing the <code>.check()</code> action on "PayPal".</li>
<li>Asserting that "PayPal" is now checked and "CC" has become unchecked, confirming the group behavior.</li>
</ol>
<h3 id="1343-locating-checkboxes-and-radio-buttons-effectively" tabindex="-1"><a class="anchor" href="#1343-locating-checkboxes-and-radio-buttons-effectively" name="1343-locating-checkboxes-and-radio-buttons-effectively" tabindex="-1"><span class="octicon octicon-link"></span></a>13.4.3 Locating Checkboxes and Radio Buttons Effectively</h3>
<p>The reliability of your checkbox and radio button tests hinges on robust locators (Chapter 11). Here are common and effective strategies:</p>
<ul>
<li><strong><code>page.get_by_label("Your Label Text")</code></strong>: This is often the most user-centric and resilient way if your inputs are correctly associated with <code>&lt;label&gt;</code> elements (e.g., via <code>for</code> attribute or by nesting the input inside the label).<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># Assuming HTML: &lt;label for="agree"&gt;Agree to terms&lt;/label&gt;&lt;input type="checkbox" id="agree"&gt;</span>
agree_checkbox <span class="token operator">=</span> page<span class="token punctuation">.</span>get_by_label<span class="token punctuation">(</span><span class="token string">"Agree to terms"</span><span class="token punctuation">)</span>
agree_checkbox<span class="token punctuation">.</span>check<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
</li>
<li><strong><code>page.get_by_role('checkbox', name="Accessible Name")</code></strong> or <strong><code>page.get_by_role('radio', name="Accessible Name")</code></strong>: Uses ARIA roles and accessible names. The <code>name</code> option here refers to the accessible name (often derived from the label text).<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># Assuming HTML: &lt;label&gt;&lt;input type="checkbox"&gt; Subscribe&lt;/label&gt;</span>
subscribe_checkbox <span class="token operator">=</span> page<span class="token punctuation">.</span>get_by_role<span class="token punctuation">(</span><span class="token string">'checkbox'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"Subscribe"</span><span class="token punctuation">)</span>
subscribe_checkbox<span class="token punctuation">.</span>check<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
</li>
<li><strong><code>page.locator("input[value='specific_value']")</code></strong> (especially for radio buttons): If radio buttons are differentiated by their <code>value</code> attribute and labels might be less stable or harder to target.<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># Assuming HTML: &lt;input type="radio" name="color" value="blue"&gt; Blue</span>
blue_radio <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"input[name='color'][value='blue']"</span><span class="token punctuation">)</span>
blue_radio<span class="token punctuation">.</span>check<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
</li>
<li><strong><code>page.locator("#element-id")</code></strong>: Good if unique and stable IDs are available.</li>
<li><strong><code>page.locator('[data-testid="my-checkbox"]')</code></strong>: Excellent for test-specific, stable locators.</li>
</ul>
<p>Avoid overly specific CSS or XPath locators that are prone to break with minor HTML structure changes. Prioritize locators that reflect how a user would find the element.</p>
<h3 id="1344-practical-scenario-a-settings-form" tabindex="-1"><a class="anchor" href="#1344-practical-scenario-a-settings-form" name="1344-practical-scenario-a-settings-form" tabindex="-1"><span class="octicon octicon-link"></span></a>13.4.4 Practical Scenario: A Settings Form</h3>
<p>Let's imagine a Django settings page for a user profile. The template (<code>settings_form.html</code>) might look like this:</p>
<pre class="language-html" tabindex="0"><code class="language-html"><span class="token comment">&lt;!-- THIS_CODE_SNIPPET --&gt;</span>
<span class="token comment">&lt;!-- templates/myapp/settings_form.html --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    {% csrf_token %}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>Notification Settings<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email_notifications<span class="token punctuation">"</span></span> <span class="token attr-name">{%</span> <span class="token attr-name">if</span> <span class="token attr-name">form.email_notifications.value</span> <span class="token attr-name">%}checked{%</span> <span class="token attr-name">endif</span> <span class="token attr-name">%}</span><span class="token punctuation">&gt;</span></span>
        Receive email notifications
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sms_notifications<span class="token punctuation">"</span></span> <span class="token attr-name">{%</span> <span class="token attr-name">if</span> <span class="token attr-name">form.sms_notifications.value</span> <span class="token attr-name">%}checked{%</span> <span class="token attr-name">endif</span> <span class="token attr-name">%}</span><span class="token punctuation">&gt;</span></span>
        Receive SMS notifications
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>Theme Preference<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">&gt;</span></span>
        &lt;input type="radio" name="theme" value="light" {% if form.theme.value == "light" %}checked{% endif %}&gt;
        Light Theme
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">&gt;</span></span>
        &lt;input type="radio" name="theme" value="dark" {% if form.theme.value == "dark" %}checked{% endif %}&gt;
        Dark Theme
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Save Settings<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>This form has two checkboxes for notification preferences and a radio button group for theme selection. The <code>{% if ... %}</code> tags would typically be driven by Django form field values passed in the context.</p>
<p>Now, let's write a Playwright test for this form. We'll assume this form is rendered by a view accessible at <code>/settings/</code>.</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># tests/e2e/test_settings_page.py</span>
<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> Page<span class="token punctuation">,</span> expect
<span class="token keyword">import</span> pytest
<span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> reverse

<span class="token comment"># Assume User model and a way to create users if login is required.</span>
<span class="token comment"># For simplicity, we'll assume the page is accessible without login,</span>
<span class="token comment"># or that login is handled by another fixture.</span>

<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>mark<span class="token punctuation">.</span>django_db</span> <span class="token comment"># If form submission interacts with the DB</span>
<span class="token keyword">def</span> <span class="token function">test_settings_form_interactions</span><span class="token punctuation">(</span>page<span class="token punctuation">:</span> Page<span class="token punctuation">,</span> live_server<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Arrange: Navigate to the settings page</span>
    settings_url <span class="token operator">=</span> live_server<span class="token punctuation">.</span>url <span class="token operator">+</span> reverse<span class="token punctuation">(</span><span class="token string">'settings_view_name'</span><span class="token punctuation">)</span> <span class="token comment"># Replace 'settings_view_name'</span>
    page<span class="token punctuation">.</span>goto<span class="token punctuation">(</span>settings_url<span class="token punctuation">)</span>

    <span class="token comment"># Locate the elements</span>
    email_notifications_checkbox <span class="token operator">=</span> page<span class="token punctuation">.</span>get_by_label<span class="token punctuation">(</span><span class="token string">"Receive email notifications"</span><span class="token punctuation">)</span>
    sms_notifications_checkbox <span class="token operator">=</span> page<span class="token punctuation">.</span>get_by_label<span class="token punctuation">(</span><span class="token string">"Receive SMS notifications"</span><span class="token punctuation">)</span>
    light_theme_radio <span class="token operator">=</span> page<span class="token punctuation">.</span>get_by_label<span class="token punctuation">(</span><span class="token string">"Light Theme"</span><span class="token punctuation">)</span>
    dark_theme_radio <span class="token operator">=</span> page<span class="token punctuation">.</span>get_by_label<span class="token punctuation">(</span><span class="token string">"Dark Theme"</span><span class="token punctuation">)</span>

    <span class="token comment"># Act &amp; Assert: Interact with checkboxes</span>
    <span class="token comment"># 1. Ensure email notifications are checked</span>
    email_notifications_checkbox<span class="token punctuation">.</span>check<span class="token punctuation">(</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>email_notifications_checkbox<span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_checked<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 2. Ensure SMS notifications are unchecked (assuming it might be checked by default or by previous state)</span>
    sms_notifications_checkbox<span class="token punctuation">.</span>uncheck<span class="token punctuation">(</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>sms_notifications_checkbox<span class="token punctuation">)</span><span class="token punctuation">.</span>not_to_be_checked<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># Act &amp; Assert: Interact with radio buttons</span>
    <span class="token comment"># 3. Select dark theme</span>
    dark_theme_radio<span class="token punctuation">.</span>check<span class="token punctuation">(</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>dark_theme_radio<span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_checked<span class="token punctuation">(</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>light_theme_radio<span class="token punctuation">)</span><span class="token punctuation">.</span>not_to_be_checked<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># Verify other option is deselected</span>

    <span class="token comment"># 4. (Optional) Change mind and select light theme</span>
    light_theme_radio<span class="token punctuation">.</span>check<span class="token punctuation">(</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>light_theme_radio<span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_checked<span class="token punctuation">(</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>dark_theme_radio<span class="token punctuation">)</span><span class="token punctuation">.</span>not_to_be_checked<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># (Optional) Submit the form and verify changes if applicable</span>
    <span class="token comment"># page.click("button[type='submit']")</span>
    <span class="token comment"># ... assertions for successful save message or DB state ...</span>
</code></pre>
<p>Let's break down this test:</p>
<ol>
<li><code>@pytest.mark.django_db</code>: This marker is included if saving the form interacts with the database. If the form is purely client-side or doesn't save to the DB in this particular test flow, it might not be strictly necessary for the interaction part but is good practice if submission is involved.</li>
<li><code>live_server</code>: We use the <code>live_server</code> fixture (Chapter 10) to get the URL for our running Django application.</li>
<li><code>page.goto(settings_url)</code>: Navigates to the settings page.</li>
<li><strong>Locating Elements</strong>: We use <code>page.get_by_label()</code> to find our checkboxes and radio buttons. This is a robust method assuming our HTML labels are correctly set up.</li>
<li><strong>Interacting with Checkboxes</strong>:
<ul>
<li><code>email_notifications_checkbox.check()</code>: We ensure the email notifications checkbox is selected.</li>
<li><code>expect(email_notifications_checkbox).to_be_checked()</code>: We immediately assert its state.</li>
<li><code>sms_notifications_checkbox.uncheck()</code>: We ensure the SMS notifications checkbox is deselected.</li>
<li><code>expect(sms_notifications_checkbox).not_to_be_checked()</code>: We assert its state.</li>
</ul>
</li>
<li><strong>Interacting with Radio Buttons</strong>:
<ul>
<li><code>dark_theme_radio.check()</code>: We select the "Dark Theme."</li>
<li><code>expect(dark_theme_radio).to_be_checked()</code>: Assert "Dark Theme" is selected.</li>
<li><code>expect(light_theme_radio).not_to_be_checked()</code>: Crucially, assert that "Light Theme" (the other option in the group) is now deselected.</li>
<li>The test then demonstrates changing the radio selection back to "Light Theme" and re-asserting.</li>
</ul>
</li>
<li><strong>Optional Form Submission</strong>: The commented-out lines suggest how you might proceed to submit the form and verify the outcome, which would typically involve checking for a success message or querying the database to see if the settings were saved correctly.</li>
</ol>
<p>This practical example shows how <code>.check()</code> and <code>.uncheck()</code> are used in a more complete flow, combining location, action, and assertion for both types of input elements.</p>
<h3 id="1345-common-pitfalls-and-considerations" tabindex="-1"><a class="anchor" href="#1345-common-pitfalls-and-considerations" name="1345-common-pitfalls-and-considerations" tabindex="-1"><span class="octicon octicon-link"></span></a>13.4.5 Common Pitfalls and Considerations</h3>
<ul>
<li><strong>Interacting with Disabled Elements</strong>: If a checkbox or radio button is <code>disabled</code> (e.g., <code>&lt;input type="checkbox" disabled&gt;</code>), Playwright's <code>.check()</code> and <code>.uncheck()</code> methods will, by default, wait for the element to become enabled. If it doesn't become enabled within the timeout, the action will fail. This is generally desired behavior, as users cannot interact with disabled elements. If you <em>must</em> interact with a notionally disabled element (e.g., because it's only visually styled as disabled but still technically interactive, which is bad practice), you might need <code>force=True</code> (e.g., <code>my_checkbox.check(force=True)</code>), but this should be a last resort and indicates a potential accessibility or usability issue in the application.</li>
<li><strong>Custom Styled Controls (Fake Checkboxes/Radios)</strong>:
<ul>
<li>Some web applications use <code>&lt;div&gt;</code>, <code>&lt;span&gt;</code>, or other elements, styled with CSS and manipulated with JavaScript, to <em>look and behave</em> like checkboxes or radio buttons, without using actual <code>&lt;input type="checkbox/radio"&gt;</code> elements.</li>
<li>In such cases, <code>.check()</code> and <code>.uncheck()</code> <strong>will not work</strong> because these methods are specifically for native HTML input elements.</li>
<li>You would need to interact with these custom controls as you would with any other element, typically using <code>.click()</code> on the visible part of the custom control.</li>
<li>Assertions would then need to check attributes or styles on the custom element (e.g., <code>expect(custom_checkbox_div).to_have_class("checked")</code>) rather than using <code>to_be_checked()</code>.</li>
<li><strong>The "Why"</strong>: Playwright's <code>.check()</code> and <code>.uncheck()</code> methods are deeply tied to the browser's internal understanding and handling of standard form input elements. They don't just simulate a click; they ensure the element's <code>checked</code> property is appropriately set. Custom controls bypass this native mechanism.</li>
<li>Sometimes, custom controls might still use a hidden, actual <code>&lt;input type="checkbox/radio"&gt;</code> element underneath. If you can locate this hidden input, <code>.check(force=True)</code> <em>might</em> work on it, but interacting with the visible element is usually more aligned with user behavior.</li>
</ul>
</li>
<li><strong>Implicit Assertions in Actions</strong>: Remember that Playwright actions like <code>.check()</code> and <code>.uncheck()</code> include implicit assertions (actionability checks). The element must be attached to the DOM, visible, stable, enabled, and able to receive events. If these conditions aren't met, the action will fail before even attempting the check/uncheck operation.</li>
<li><strong>Timing and Asynchronous Updates</strong>: If checking a box or radio button triggers an asynchronous update on the page (e.g., fetching new data, enabling other fields), ensure you wait for those updates (Chapter 14) before making further assertions or interactions that depend on them.</li>
</ul>
<h3 id="1346-best-practices-for-testing-checkboxes-and-radio-buttons" tabindex="-1"><a class="anchor" href="#1346-best-practices-for-testing-checkboxes-and-radio-buttons" name="1346-best-practices-for-testing-checkboxes-and-radio-buttons" tabindex="-1"><span class="octicon octicon-link"></span></a>13.4.6 Best Practices for Testing Checkboxes and Radio Buttons</h3>
<ol>
<li><strong>Use User-Facing Locators</strong>: Prefer <code>page.get_by_label()</code>, <code>page.get_by_role()</code>, or <code>data-testid</code> attributes for locating checkboxes and radio buttons. This makes your tests more resilient to changes in the HTML structure and closer to how a user perceives the page.</li>
<li><strong>Assert State After Action</strong>: Always follow a <code>.check()</code> or <code>.uncheck()</code> call with an <code>expect(...).to_be_checked()</code> or <code>expect(...).not_to_be_checked()</code> assertion. This verifies that your action had the intended effect and that the application is in the correct state. Don't assume the action worked.</li>
<li><strong>Test Radio Group Exclusivity</strong>: When testing radio buttons, select one option and then assert that it is checked <em>and</em> that other options in the same group are unchecked. This validates the core behavior of radio button groups.</li>
<li><strong>Consider Initial States</strong>: If the initial state of a checkbox or radio group is important (e.g., a checkbox should be checked by default, or a specific radio option pre-selected), include assertions for this initial state before performing any actions.</li>
<li><strong>Idempotency is Your Friend</strong>: Leverage the idempotent nature of <code>.check()</code> and <code>.uncheck()</code>. If you need to ensure a checkbox is checked, just call <code>.check()</code>. You don't need to first query its state and then conditionally call <code>.check()</code>.</li>
</ol>
<p>By understanding the nuances of checkboxes and radio buttons and utilizing Playwright's <code>.check()</code> and <code>.uncheck()</code> methods correctly, along with robust locators and assertions, you can confidently test these essential form interactions in your Django applications. This ensures that users can make their intended selections, and your application correctly processes their choices.</p>
<h3 id="135-hovering-focusing-drag-and-drop-brief-overview" tabindex="-1"><a class="anchor" href="#135-hovering-focusing-drag-and-drop-brief-overview" name="135-hovering-focusing-drag-and-drop-brief-overview" tabindex="-1"><span class="octicon octicon-link"></span></a>13.5 Hovering, Focusing, Drag-and-Drop (Brief Overview)</h3>
<p>Beyond simple clicks and text input, modern web applications often involve richer user interactions like hovering to reveal menus, elements changing behavior when focused, or reordering items with drag-and-drop. Playwright provides robust methods to simulate these actions, allowing you to test these dynamic aspects of your user interface. This section offers a brief overview of these capabilities. While powerful, these interactions can sometimes be more complex to test reliably due to their dependency on precise event sequences and browser rendering.</p>
<h4 id="1351-hovering-over-elements" tabindex="-1"><a class="anchor" href="#1351-hovering-over-elements" name="1351-hovering-over-elements" tabindex="-1"><span class="octicon octicon-link"></span></a>13.5.1 Hovering over Elements</h4>
<p>Hovering is a common interaction where moving the mouse cursor over an element triggers a change, such as displaying a tooltip, a submenu, or highlighting the element. Playwright's <code>locator.hover()</code> method simulates this action.</p>
<p><strong>Why test hovering?</strong>
You need to test hovering to ensure that:</p>
<ul>
<li>Elements that are supposed to appear on hover (e.g., dropdown menus, tooltips) do so correctly.</li>
<li>The state changes triggered by hover (e.g., CSS style changes) are applied as expected.</li>
<li>Subsequent interactions with elements revealed by hover are possible.</li>
</ul>
<p>Let's consider an example where hovering over a "User Profile" button reveals a "Logout" link.</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> Page<span class="token punctuation">,</span> expect

<span class="token keyword">def</span> <span class="token function">test_logout_link_appears_on_hover</span><span class="token punctuation">(</span>page<span class="token punctuation">:</span> Page<span class="token punctuation">,</span> live_server<span class="token punctuation">)</span><span class="token punctuation">:</span>
    page<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>live_server<span class="token punctuation">.</span>url<span class="token punctuation">}</span></span><span class="token string">/some_page_with_profile_menu/"</span></span><span class="token punctuation">)</span>

    profile_button <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#user-profile-button"</span><span class="token punctuation">)</span>
    logout_link <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"a#logout-link"</span><span class="token punctuation">)</span>

    <span class="token comment"># Initially, the logout link might be hidden</span>
    expect<span class="token punctuation">(</span>logout_link<span class="token punctuation">)</span><span class="token punctuation">.</span>not_to_be_visible<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># Simulate hovering over the profile button</span>
    profile_button<span class="token punctuation">.</span>hover<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># Now, the logout link should be visible</span>
    expect<span class="token punctuation">(</span>logout_link<span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_visible<span class="token punctuation">(</span><span class="token punctuation">)</span>
    logout_link<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># Optionally, interact with the revealed element</span>

    <span class="token comment"># Assert that logout was successful, e.g., by checking the URL</span>
    expect<span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_url<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>live_server<span class="token punctuation">.</span>url<span class="token punctuation">}</span></span><span class="token string">/login/"</span></span><span class="token punctuation">)</span>
</code></pre>
<p>Let's examine this code in detail:</p>
<ol>
<li>
<p><strong><code>profile_button = page.locator("#user-profile-button")</code></strong> and <strong><code>logout_link = page.locator("a#logout-link")</code></strong>:</p>
<ul>
<li>We first define locators for the "User Profile" button (the element we'll hover over) and the "Logout" link (the element that should appear).</li>
<li>Using IDs (<code>#user-profile-button</code>, <code>#logout-link</code>) provides stable locators.</li>
</ul>
</li>
<li>
<p><strong><code>expect(logout_link).not_to_be_visible()</code></strong>:</p>
<ul>
<li>This is an important preliminary assertion. We verify that the <code>logout_link</code> is <em>not</em> visible before the hover action. This ensures our test correctly attributes the link's visibility to the hover action.</li>
<li>This helps prevent false positives where the link might have been visible due to an unrelated issue.</li>
</ul>
</li>
<li>
<p><strong><code>profile_button.hover()</code></strong>:</p>
<ul>
<li>This is the core of the hover simulation. Playwright internally dispatches mouse events (like <code>mouseenter</code> or <code>mouseover</code>) to the browser, mimicking a user moving their mouse cursor over the <code>profile_button</code> element.</li>
<li>The browser's JavaScript and CSS that listen for these events will then execute, potentially changing the visibility or state of other elements.</li>
</ul>
</li>
<li>
<p><strong><code>expect(logout_link).to_be_visible()</code></strong>:</p>
<ul>
<li>After hovering, we assert that the <code>logout_link</code> is now visible. Playwright's <code>expect</code> will automatically wait for a short period for this condition to become true, accommodating animations or slight delays in the UI updating.</li>
<li>This confirms that the hover interaction successfully triggered the intended UI change.</li>
</ul>
</li>
<li>
<p><strong><code>logout_link.click()</code></strong> and <strong><code>expect(page).to_have_url(...)</code></strong>:</p>
<ul>
<li>These lines demonstrate a common follow-up: interacting with an element that became visible due to the hover.</li>
<li>This ensures not only that the element appears but also that it's interactive.</li>
</ul>
</li>
</ol>
<p>This pattern demonstrates how <code>hover()</code> allows you to test dynamic UI behaviors that depend on mouse position. In a real-world scenario, the profile menu might be implemented with CSS <code>:hover</code> pseudo-classes or JavaScript event listeners; Playwright's <code>hover()</code> effectively tests both.</p>
<h4 id="1352-focusing-on-elements" tabindex="-1"><a class="anchor" href="#1352-focusing-on-elements" name="1352-focusing-on-elements" tabindex="-1"><span class="octicon octicon-link"></span></a>13.5.2 Focusing on Elements</h4>
<p>Focusing an element means making it the active element on the page, typically ready to receive keyboard input or trigger focus-specific styling. Users can focus elements by tabbing to them or clicking on them. Programmatically, Playwright uses <code>locator.focus()</code>.</p>
<p><strong>Why test focusing?</strong></p>
<ul>
<li>To verify accessibility features, such as "skip links" or keyboard navigation.</li>
<li>To test JavaScript event handlers bound to <code>focus</code> or <code>blur</code> events.</li>
<li>To ensure elements that change appearance or behavior on focus (e.g., input fields highlighting) do so correctly.</li>
</ul>
<p>Consider an input field that displays a help message only when it's focused.</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> Page<span class="token punctuation">,</span> expect

<span class="token keyword">def</span> <span class="token function">test_help_message_appears_on_focus</span><span class="token punctuation">(</span>page<span class="token punctuation">:</span> Page<span class="token punctuation">,</span> live_server<span class="token punctuation">)</span><span class="token punctuation">:</span>
    page<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>live_server<span class="token punctuation">.</span>url<span class="token punctuation">}</span></span><span class="token string">/some_form_page/"</span></span><span class="token punctuation">)</span>

    username_input <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#username"</span><span class="token punctuation">)</span>
    help_text <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#username-help"</span><span class="token punctuation">)</span>

    <span class="token comment"># Initially, the help text might be hidden</span>
    expect<span class="token punctuation">(</span>help_text<span class="token punctuation">)</span><span class="token punctuation">.</span>not_to_be_visible<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># Simulate focusing on the username input field</span>
    username_input<span class="token punctuation">.</span>focus<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># Now, the help text should be visible</span>
    expect<span class="token punctuation">(</span>help_text<span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_visible<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># Optionally, simulate blurring (losing focus)</span>
    <span class="token comment"># For example, by focusing another element or clicking outside</span>
    page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"body"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># Click somewhere else to blur</span>
    expect<span class="token punctuation">(</span>help_text<span class="token punctuation">)</span><span class="token punctuation">.</span>not_to_be_visible<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># Assuming help text hides on blur</span>
</code></pre>
<p>Let's break down this example:</p>
<ol>
<li>
<p><strong><code>username_input = page.locator("#username")</code></strong> and <strong><code>help_text = page.locator("#username-help")</code></strong>:</p>
<ul>
<li>We locate the input field that will receive focus and the associated help text element.</li>
</ul>
</li>
<li>
<p><strong><code>expect(help_text).not_to_be_visible()</code></strong>:</p>
<ul>
<li>Similar to the hover example, we assert the initial state: the help text is not visible before the input field is focused.</li>
</ul>
</li>
<li>
<p><strong><code>username_input.focus()</code></strong>:</p>
<ul>
<li>This line simulates the user bringing the <code>username_input</code> element into focus. Playwright achieves this by dispatching a <code>focus</code> event to the element.</li>
<li>This is distinct from <code>click()</code>, although clicking an input field often also focuses it. <code>focus()</code> specifically targets the focus event without necessarily simulating a full mouse click.</li>
</ul>
</li>
<li>
<p><strong><code>expect(help_text).to_be_visible()</code></strong>:</p>
<ul>
<li>After focusing, we assert that the <code>help_text</code> element is now visible, confirming that the focus event triggered the desired UI change.</li>
</ul>
</li>
<li>
<p><strong><code>page.locator("body").click()</code></strong> and <strong><code>expect(help_text).not_to_be_visible()</code></strong>:</p>
<ul>
<li>This optional part demonstrates testing the <code>blur</code> behavior (when an element loses focus). By clicking the <code>body</code> (or any other focusable element), the <code>username_input</code> loses focus.</li>
<li>We then assert that the <code>help_text</code> becomes hidden again, assuming this is the intended behavior. This tests the full lifecycle of the focus-dependent UI.</li>
</ul>
</li>
</ol>
<p>Testing focus is crucial for ensuring your application is usable and accessible, especially for users who rely on keyboard navigation.</p>
<h4 id="1353-drag-and-drop" tabindex="-1"><a class="anchor" href="#1353-drag-and-drop" name="1353-drag-and-drop" tabindex="-1"><span class="octicon octicon-link"></span></a>13.5.3 Drag-and-Drop</h4>
<p>Drag-and-drop is a more complex interaction where a user "grabs" an element with the mouse, moves it to another location (or over another element), and then "releases" it. This is common in interfaces for reordering lists, uploading files, or moving items between containers. Playwright offers a couple of ways to simulate this, primarily <code>locator.drag_to()</code> and <code>page.drag_and_drop()</code>.</p>
<p><strong>Why test drag-and-drop?</strong></p>
<ul>
<li>To verify core functionality like reordering items in a list.</li>
<li>To test features like drag-and-drop file uploads.</li>
<li>To ensure that application state updates correctly after a drag-and-drop operation.</li>
</ul>
<p>The <code>locator.drag_to(target_locator)</code> method is often more convenient as it works directly with locators.</p>
<p>Let's imagine a simple scenario of dragging an item in a sortable list to a new position.</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> Page<span class="token punctuation">,</span> expect

<span class="token keyword">def</span> <span class="token function">test_reorder_item_in_list</span><span class="token punctuation">(</span>page<span class="token punctuation">:</span> Page<span class="token punctuation">,</span> live_server<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Assume a page with a sortable list like:</span>
    <span class="token comment"># &lt;ul id="sortable-list"&gt;</span>
    <span class="token comment">#   &lt;li data-testid="item-1"&gt;Item 1&lt;/li&gt;</span>
    <span class="token comment">#   &lt;li data-testid="item-2"&gt;Item 2&lt;/li&gt;</span>
    <span class="token comment">#   &lt;li data-testid="item-3"&gt;Item 3&lt;/li&gt;</span>
    <span class="token comment"># &lt;/ul&gt;</span>
    page<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>live_server<span class="token punctuation">.</span>url<span class="token punctuation">}</span></span><span class="token string">/sortable_list_page/"</span></span><span class="token punctuation">)</span>

    item_to_drag <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"[data-testid='item-1']"</span><span class="token punctuation">)</span>
    <span class="token comment"># Target can be another element, or a position within an element.</span>
    <span class="token comment"># For simplicity, let's say we want to drag it after item-3,</span>
    <span class="token comment"># which effectively means dragging it to the position of item-3.</span>
    <span class="token comment"># A more precise target might be a drop zone or specific coordinates.</span>
    target_location <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"[data-testid='item-3']"</span><span class="token punctuation">)</span>

    <span class="token comment"># Get initial order (simplified for example)</span>
    initial_items_text <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#sortable-list li"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>all_text_contents<span class="token punctuation">(</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>initial_items_text<span class="token punctuation">)</span><span class="token punctuation">.</span>to_equal<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Item 1"</span><span class="token punctuation">,</span> <span class="token string">"Item 2"</span><span class="token punctuation">,</span> <span class="token string">"Item 3"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token comment"># Perform the drag-and-drop operation</span>
    item_to_drag<span class="token punctuation">.</span>drag_to<span class="token punctuation">(</span>target_location<span class="token punctuation">)</span>

    <span class="token comment"># Assert the new order (simplified for example)</span>
    <span class="token comment"># The exact outcome depends on the sortable list's implementation.</span>
    <span class="token comment"># It might place 'item-1' before, after, or replace 'item-3'.</span>
    <span class="token comment"># Let's assume it moves 'item-1' to the end if dragged onto 'item-3'.</span>
    <span class="token comment"># A robust check would involve inspecting the DOM structure or attributes.</span>
    final_items_text <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#sortable-list li"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>all_text_contents<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># This assertion is highly dependent on the drag-and-drop library's behavior.</span>
    <span class="token comment"># For example, if dragging item-1 onto item-3 moves item-1 after item-3:</span>
    expect<span class="token punctuation">(</span>final_items_text<span class="token punctuation">)</span><span class="token punctuation">.</span>to_equal<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Item 2"</span><span class="token punctuation">,</span> <span class="token string">"Item 3"</span><span class="token punctuation">,</span> <span class="token string">"Item 1"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<p>Let's dissect this drag-and-drop example:</p>
<ol>
<li>
<p><strong><code>item_to_drag = page.locator("[data-testid='item-1']")</code></strong>:</p>
<ul>
<li>We identify the element that we want to drag. Using <code>data-testid</code> is excellent for stable locators.</li>
</ul>
</li>
<li>
<p><strong><code>target_location = page.locator("[data-testid='item-3']")</code></strong>:</p>
<ul>
<li>We identify the target locator where the <code>item_to_drag</code> should be dropped. <code>drag_to</code> will attempt to drop the source element onto the center of this target element.</li>
<li>The "target" for <code>drag_to</code> is another locator. Playwright will simulate dragging the source element and releasing it over the target element.</li>
</ul>
</li>
<li>
<p><strong><code>initial_items_text = page.locator("#sortable-list li").all_text_contents()</code></strong> and <strong><code>expect(initial_items_text).to_equal(...)</code></strong>:</p>
<ul>
<li>Before the drag operation, we capture the initial state of the list. This is crucial for verifying that the drag-and-drop actually changed something in the intended way.</li>
<li><code>all_text_contents()</code> retrieves the text of all matching <code>li</code> elements.</li>
</ul>
</li>
<li>
<p><strong><code>item_to_drag.drag_to(target_location)</code></strong>:</p>
<ul>
<li>This is the command that simulates the entire drag-and-drop sequence:
<ul>
<li>Mouse button down on <code>item_to_drag</code>.</li>
<li>Mouse move to the location of <code>target_location</code>.</li>
<li>Mouse button up.</li>
</ul>
</li>
<li>Playwright handles the underlying browser events (<code>mousedown</code>, <code>mousemove</code>, <code>mouseup</code>, and potentially HTML5 drag events like <code>dragstart</code>, <code>dragenter</code>, <code>dragover</code>, <code>drop</code>, <code>dragend</code>) to make this happen.</li>
</ul>
</li>
<li>
<p><strong><code>final_items_text = page.locator("#sortable-list li").all_text_contents()</code></strong> and <strong><code>expect(final_items_text).to_equal(...)</code></strong>:</p>
<ul>
<li>After the drag operation, we fetch the state of the list again.</li>
<li>We then assert that the order of items has changed as expected. The exact assertion here (<code>["Item 2", "Item 3", "Item 1"]</code>) is illustrative and depends heavily on how the specific JavaScript library implementing the sortable list handles drops. Some libraries might place the dragged item before the target, some after. You'll need to understand your UI's behavior.</li>
</ul>
</li>
</ol>
<p><strong>Alternative: <code>page.drag_and_drop(source_selector, target_selector)</code></strong>
Playwright also offers <code>page.drag_and_drop("selector_for_source", "selector_for_target")</code>. This method takes CSS selectors (or other selector engine strings) directly, rather than <code>Locator</code> objects.</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># Alternative using page.drag_and_drop</span>
<span class="token comment"># page.drag_and_drop("[data-testid='item-1']", "[data-testid='item-3']")</span>
</code></pre>
<p>This achieves a similar result to <code>locator.drag_to()</code>. The choice between them often comes down to personal preference or how you've structured your locators. <code>locator.drag_to()</code> can be more aligned with the Page Object Model pattern if you're already working with <code>Locator</code> instances.</p>
<p><strong>Important Considerations for Drag-and-Drop:</strong></p>
<ul>
<li><strong>Complexity:</strong> Drag-and-drop interactions can be some of the trickiest to automate reliably. They often involve complex JavaScript, precise timing, and visual feedback that can be hard for an automated tool to interpret perfectly.</li>
<li><strong>Underlying Implementation:</strong> The success of <code>drag_to</code> can depend on how the drag-and-drop functionality is implemented on the frontend (e.g., native HTML5 drag and drop, or a JavaScript library like SortableJS or jQuery UI Draggable). Playwright aims to work with most common implementations.</li>
<li><strong>Targeting:</strong> Precisely defining the drop target can be crucial. Sometimes, dropping onto the center of an element is not enough, and you might need to specify coordinates or use helper elements as drop zones.</li>
<li><strong>Waiting:</strong> Ensure that any asynchronous operations triggered by the drop (like an AJAX call to save the new order) have completed before making assertions. Playwright's auto-waiting helps, but explicit waits might sometimes be necessary for backend confirmations.</li>
</ul>
<p>While this section provides a brief overview, successfully testing these advanced interactions often requires careful locator strategy, understanding the specific event sequences your application expects, and potentially more fine-grained control or assertions. Start with these basic methods, and if you encounter issues, delve deeper into Playwright's documentation on input events and actionability checks.</p>
<h3 id="136-simulating-keyboard-input-press" tabindex="-1"><a class="anchor" href="#136-simulating-keyboard-input-press" name="136-simulating-keyboard-input-press" tabindex="-1"><span class="octicon octicon-link"></span></a>13.6 Simulating Keyboard Input (<code>.press()</code>)</h3>
<p>Beyond clicking elements and filling out forms with complete strings, users often interact with web applications using individual key presses. They might use the 'Enter' key to submit a form, 'Escape' to close a dialog, 'Tab' to navigate between focusable elements, or keyboard shortcuts like 'Ctrl+S' to save data. To test these crucial user interactions, Playwright provides the powerful <code>.press()</code> method, available on both locators and the <code>page.keyboard</code> object.</p>
<p>Simulating keyboard input is vital for several reasons:</p>
<ul>
<li><strong>Testing Accessibility:</strong> Ensuring users who rely on keyboard navigation can effectively use your application.</li>
<li><strong>Verifying Keyboard Shortcuts:</strong> Confirming that custom shortcuts trigger the expected actions.</li>
<li><strong>Realistic Form Submission:</strong> Testing form submission via the 'Enter' key, a common user behavior.</li>
<li><strong>Interaction with Dynamic UI:</strong> Triggering events that are specifically bound to key presses (e.g., type-ahead search, closing modals).</li>
</ul>
<p>The fundamental principle behind <code>.press()</code> is that it simulates a user physically pressing a key, which in turn fires the corresponding sequence of browser events (like <code>keydown</code>, <code>keypress</code>, <code>keyup</code>, and potentially <code>input</code> or <code>change</code> events). This is distinct from methods like <code>.fill()</code>, which directly set an input's value, often bypassing some of these granular events.</p>
<p><strong>Basic Key Presses and Focus</strong></p>
<p>The <code>.press()</code> method typically operates on the element that currently has focus on the page. If you call <code>.press()</code> on a specific locator (e.g., <code>my_input_locator.press('Enter')</code>), Playwright will first attempt to focus that element before dispatching the key press. Alternatively, <code>page.keyboard.press('KeyName')</code> sends the key press to the currently focused element on the page.</p>
<p>Let's explore with a practical example: submitting a search form by pressing 'Enter'.</p>
<p>Imagine your Django application has a search page with the following simplified HTML structure:</p>
<pre class="language-html" tabindex="0"><code class="language-html"><span class="token comment">&lt;!-- THIS_CODE_SNIPPET --&gt;</span>
<span class="token comment">&lt;!-- search_page.html (rendered by a Django view) --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search-form<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>GET<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/search-results/<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search-query-input<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Search:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search-query-input<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>query<span class="token punctuation">"</span></span> <span class="token attr-name">aria-label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Search query<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Search<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>This is a standard HTML form. Users often type their query and press 'Enter' instead of clicking the "Search" button. We need to test this behavior.</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># tests/e2e/test_search_interaction.py</span>
<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> Page<span class="token punctuation">,</span> expect
<span class="token keyword">import</span> pytest

<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>mark<span class="token punctuation">.</span>django_db</span> <span class="token comment"># Not strictly needed if the page doesn't hit DB on load, but good practice</span>
<span class="token keyword">def</span> <span class="token function">test_search_form_submit_with_enter</span><span class="token punctuation">(</span>page<span class="token punctuation">:</span> Page<span class="token punctuation">,</span> live_server<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Assume this URL in your Django app serves the search_page.html</span>
    page<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>live_server<span class="token punctuation">.</span>url<span class="token punctuation">}</span></span><span class="token string">/search-page/"</span></span><span class="token punctuation">)</span>

    search_input <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">'input[name="query"]'</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 1. Fill the search input field</span>
    search_input<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token string">"Django testing with Playwright"</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 2. Simulate pressing the 'Enter' key on the input field</span>
    search_input<span class="token punctuation">.</span>press<span class="token punctuation">(</span><span class="token string">"Enter"</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 3. Assert that the form submission led to the correct results page URL</span>
    <span class="token comment"># This assumes a GET request form submission.</span>
    expected_url_part <span class="token operator">=</span> <span class="token string">"/search-results/?query=Django+testing+with+Playwright"</span>
    expect<span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_url<span class="token punctuation">(</span><span class="token keyword">lambda</span> url<span class="token punctuation">:</span> expected_url_part <span class="token keyword">in</span> url<span class="token punctuation">)</span>
    <span class="token comment"># Alternatively, if search results appear on the same page via AJAX:</span>
    <span class="token comment"># expect(page.locator("#results-container")).to_contain_text("Django testing with Playwright")</span>
</code></pre>
<p>Let's examine this code in detail:</p>
<ol>
<li>
<p>First, we navigate to our search page using <code>page.goto()</code>. The <code>live_server</code> fixture provides the base URL for our running Django application.</p>
<ul>
<li>This sets up the browser context for our test.</li>
</ul>
</li>
<li>
<p>We locate the search input field using <code>page.locator('input[name="query"]')</code>.</p>
<ul>
<li>This gives us a handle to the specific element we want to interact with.</li>
<li>Using the <code>name</code> attribute is a common and often stable way to locate form inputs.</li>
</ul>
</li>
<li>
<p><code>search_input.fill("Django testing with Playwright")</code>: We use the <code>.fill()</code> method to enter text into the search field.</p>
<ul>
<li>This simulates a user typing their search query.</li>
</ul>
</li>
<li>
<p><code>search_input.press("Enter")</code>: This is the core of this example. We call the <code>.press()</code> method directly on the <code>search_input</code> locator.</p>
<ul>
<li>This accomplishes the simulation of a user pressing the 'Enter' key while the input field is (or becomes) focused.</li>
<li>Playwright handles focusing the element if it's not already focused before sending the key press.</li>
<li>The argument <code>"Enter"</code> is a special key string recognized by Playwright. Other common special keys include <code>"Tab"</code>, <code>"Escape"</code>, <code>"ArrowLeft"</code>, <code>"ArrowRight"</code>, <code>"Backspace"</code>, <code>"Delete"</code>, etc. For simple character keys, you'd pass the character itself, like <code>'a'</code>, <code>'B'</code>, <code>'7'</code>, <code>'@'</code>.</li>
</ul>
</li>
<li>
<p>Finally, <code>expect(page).to_have_url(...)</code>: We assert that the browser navigated to the expected URL.</p>
<ul>
<li>This confirms that pressing 'Enter' successfully submitted the form. The URL includes the query parameter, demonstrating the form data was sent.</li>
<li>The <code>lambda url: expected_url_part in url</code> is used because the full URL might have slight variations (e.g. port number if not default) but we are interested in the path and query parameters.</li>
<li>An alternative assertion is commented out, which would be relevant if the search results were loaded dynamically on the same page.</li>
</ul>
</li>
</ol>
<p>This pattern demonstrates how <code>.press()</code> can be used to test common form interactions that rely on specific key presses.</p>
<p><strong>Another common scenario: Closing a modal with the 'Escape' key.</strong></p>
<p>Many web applications use the 'Escape' key as a convention to close modal dialogs or pop-ups. Let's assume we have a page with a button that opens a modal, and this modal should close when 'Escape' is pressed.</p>
<p>Here's a simplified HTML and JavaScript snippet that might be part of your Django template and its associated static files:</p>
<pre class="language-html" tabindex="0"><code class="language-html"><span class="token comment">&lt;!-- THIS_CODE_SNIPPET --&gt;</span>
<span class="token comment">&lt;!-- modal_page.html --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>open-modal-btn<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Open Modal<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>my-modal<span class="token punctuation">"</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dialog<span class="token punctuation">"</span></span> <span class="token attr-name">aria-modal</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">tabindex</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>-1<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">display</span><span class="token punctuation">:</span>none<span class="token punctuation">;</span> <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #ccc<span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span> <span class="token property">background</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span> <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span> <span class="token property">top</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span> <span class="token property">left</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span> <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>-50%<span class="token punctuation">,</span> -50%<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>This is a modal. Press Escape to close.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>close-modal-btn-inside<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Close<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<pre class="language-javascript" tabindex="0"><code class="language-javascript"><span class="token comment">// THIS_CODE_SNIPPET</span>
<span class="token comment">// static/js/modal_handler.js (included in modal_page.html)</span>
document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> modal <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'my-modal'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> openBtn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'open-modal-btn'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> closeBtnInside <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'close-modal-btn-inside'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>openBtn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        openBtn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            modal<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'block'</span><span class="token punctuation">;</span>
            modal<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Crucial: Set focus to the modal for 'Escape' key to be contextually relevant</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>closeBtnInside<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        closeBtnInside<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            modal<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Global listener for the Escape key</span>
    document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'keydown'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>key <span class="token operator">===</span> <span class="token string">'Escape'</span> <span class="token operator">&amp;&amp;</span> modal<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">===</span> <span class="token string">'block'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            modal<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><em>Self-Correction during thought process:</em> The JavaScript above is illustrative. In a real Django app, this would be in a static JS file. The <code>modal.focus()</code> is important because some keyboard event handlers might be scoped to the modal itself or rely on it being the active container. The <code>tabindex="-1"</code> on the modal div allows it to be programmatically focused.</p>
<p>Now, the Playwright test:</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># tests/e2e/test_modal_interaction.py</span>
<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> Page<span class="token punctuation">,</span> expect
<span class="token keyword">import</span> pytest

<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>mark<span class="token punctuation">.</span>django_db</span>
<span class="token keyword">def</span> <span class="token function">test_modal_closes_with_escape_key</span><span class="token punctuation">(</span>page<span class="token punctuation">:</span> Page<span class="token punctuation">,</span> live_server<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Assume this URL serves the page with the modal HTML and JS</span>
    page<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>live_server<span class="token punctuation">.</span>url<span class="token punctuation">}</span></span><span class="token string">/modal-test-page/"</span></span><span class="token punctuation">)</span> 

    modal_element <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#my-modal"</span><span class="token punctuation">)</span>
    open_modal_button <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#open-modal-btn"</span><span class="token punctuation">)</span>

    <span class="token comment"># 1. Initially, the modal should be hidden</span>
    expect<span class="token punctuation">(</span>modal_element<span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_hidden<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 2. Click the button to open the modal</span>
    open_modal_button<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 3. Assert the modal is now visible</span>
    expect<span class="token punctuation">(</span>modal_element<span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_visible<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># Optional: Assert modal has focus if your JS explicitly sets it</span>
    <span class="token comment"># expect(modal_element).to_be_focused() </span>

    <span class="token comment"># 4. Simulate pressing the 'Escape' key</span>
    <span class="token comment"># page.press("Escape") sends the key press to the currently focused element,</span>
    <span class="token comment"># or the document body if no specific element has focus.</span>
    <span class="token comment"># Since our JS listens on the document, this should work.</span>
    page<span class="token punctuation">.</span>keyboard<span class="token punctuation">.</span>press<span class="token punctuation">(</span><span class="token string">"Escape"</span><span class="token punctuation">)</span> 

    <span class="token comment"># 5. Assert the modal is hidden again</span>
    expect<span class="token punctuation">(</span>modal_element<span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_hidden<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>Let's break down this test:</p>
<ol>
<li>
<p><code>expect(modal_element).to_be_hidden()</code>: We start by confirming our initial state: the modal is not visible.</p>
<ul>
<li>This is good practice to ensure the test setup is as expected.</li>
</ul>
</li>
<li>
<p><code>open_modal_button.click()</code>: We simulate a user clicking the button to display the modal.</p>
<ul>
<li>This triggers the JavaScript event listener that changes the modal's <code>display</code> style.</li>
</ul>
</li>
<li>
<p><code>expect(modal_element).to_be_visible()</code>: We verify that the modal has indeed appeared.</p>
<ul>
<li>The optional <code>expect(modal_element).to_be_focused()</code> could be added if your JavaScript explicitly moves focus to the modal (which is good for accessibility).</li>
</ul>
</li>
<li>
<p><code>page.keyboard.press("Escape")</code>: Here, we use <code>page.keyboard.press()</code> to simulate the 'Escape' key press.</p>
<ul>
<li><code>page.keyboard</code> provides access to the virtual keyboard. Its <code>.press()</code> method sends key events to the page's currently focused element, or to the <code>&lt;body&gt;</code> if no element is explicitly focused.</li>
<li>Since our example JavaScript adds a <code>keydown</code> listener to the <code>document</code>, this global key press will be caught and should trigger the modal to close.</li>
<li>If the 'Escape' key handler was attached to the modal element itself, and the modal received focus upon opening, <code>modal_element.press("Escape")</code> would also work and might be slightly more explicit.</li>
</ul>
</li>
<li>
<p><code>expect(modal_element).to_be_hidden()</code>: Finally, we assert that the modal is no longer visible, confirming that the 'Escape' key press had the desired effect.</p>
</li>
</ol>
<p>This example illustrates testing UI behavior that is directly tied to a specific key press, a common pattern for modals, dropdowns, and other dynamic components.</p>
<p><strong>Key Strings and Modifier Keys</strong></p>
<p>Playwright's <code>.press()</code> method accepts a string representing the key to be pressed.</p>
<ul>
<li><strong>Single Characters:</strong> <code>'a'</code>, <code>'Z'</code>, <code>'3'</code>, <code>'@'</code>, <code>' '</code> (space).</li>
<li><strong>Special Keys:</strong> <code>'Enter'</code>, <code>'Tab'</code>, <code>'Escape'</code>, <code>'ArrowUp'</code>, <code>'ArrowDown'</code>, <code>'ArrowLeft'</code>, <code>'ArrowRight'</code>, <code>'Home'</code>, <code>'End'</code>, <code>'PageUp'</code>, <code>'PageDown'</code>, <code>'Backspace'</code>, <code>'Delete'</code>, <code>'Insert'</code>, function keys like <code>'F1'</code>, <code>'F2'</code>, etc.
<ul>
<li>For a comprehensive list of all supported key names, refer to the official Playwright documentation.</li>
</ul>
</li>
</ul>
<p>You can also simulate pressing keys with <strong>modifiers</strong> (Shift, Control, Alt/Option, Meta/Command). The syntax involves joining the modifier and the key with a <code>+</code> sign:</p>
<ul>
<li><code>'Shift+A'</code> (for a capital 'A' or other shift-modified character)</li>
<li><code>'Control+C'</code> (for copy)</li>
<li><code>'Alt+Tab'</code> (for switching applications, though browser behavior might vary)</li>
<li><code>'Meta+S'</code> (Command+S on macOS, WindowsKey+S on Windows for save, if implemented)
<ul>
<li>Playwright often normalizes <code>Control</code> for common cross-platform shortcuts like select all (<code>Control+A</code>) or copy/paste. <code>Meta</code> typically maps to Command on macOS and the Windows key on Windows/Linux.</li>
</ul>
</li>
</ul>
<p>Let's see an example of using modifier keys to select all text in an input field and then delete it:</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># tests/e2e/test_input_manipulation.py</span>
<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> Page<span class="token punctuation">,</span> expect
<span class="token keyword">import</span> pytest

<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>mark<span class="token punctuation">.</span>django_db</span>
<span class="token keyword">def</span> <span class="token function">test_select_all_and_delete_in_input</span><span class="token punctuation">(</span>page<span class="token punctuation">:</span> Page<span class="token punctuation">,</span> live_server<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Assume a page with an input field: &lt;input type="text" id="my-text-input" /&gt;</span>
    page<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>live_server<span class="token punctuation">.</span>url<span class="token punctuation">}</span></span><span class="token string">/form-elements-page/"</span></span><span class="token punctuation">)</span> 

    text_input <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#my-text-input"</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 1. Fill the input with some initial text</span>
    initial_text <span class="token operator">=</span> <span class="token string">"Some sample text"</span>
    text_input<span class="token punctuation">.</span>fill<span class="token punctuation">(</span>initial_text<span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>text_input<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_value<span class="token punctuation">(</span>initial_text<span class="token punctuation">)</span>

    <span class="token comment"># 2. Focus the input field (good practice, though .press() on locator might do it)</span>
    text_input<span class="token punctuation">.</span>focus<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 3. Simulate 'Control+A' (select all)</span>
    <span class="token comment"># For cross-platform select all, 'Control+A' is generally understood by Playwright.</span>
    <span class="token comment"># On macOS, this effectively simulates 'Command+A'.</span>
    page<span class="token punctuation">.</span>keyboard<span class="token punctuation">.</span>press<span class="token punctuation">(</span><span class="token string">"Control+A"</span><span class="token punctuation">)</span>
    
    <span class="token comment"># At this point, all text within the input should be selected.</span>
    <span class="token comment"># We could add an assertion here if Playwright offered a direct way to check selection,</span>
    <span class="token comment"># but typically we verify the *effect* of the selection.</span>

    <span class="token comment"># 4. Simulate pressing 'Backspace' to delete the selected text</span>
    page<span class="token punctuation">.</span>keyboard<span class="token punctuation">.</span>press<span class="token punctuation">(</span><span class="token string">"Backspace"</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 5. Assert the input field is now empty</span>
    expect<span class="token punctuation">(</span>text_input<span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_empty<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># Alternative using locator.press() for each step:</span>
    <span class="token comment"># text_input.fill("Alternative text")</span>
    <span class="token comment"># text_input.press("Control+A") # Playwright focuses the element first</span>
    <span class="token comment"># text_input.press("Backspace")</span>
    <span class="token comment"># expect(text_input).to_be_empty()</span>
</code></pre>
<p>Dissecting the modifier key example:</p>
<ol>
<li><code>text_input.fill(initial_text)</code> and <code>expect(text_input).to_have_value(initial_text)</code>: We set up the input with known content.</li>
<li><code>text_input.focus()</code>: We explicitly focus the input. While <code>locator.press()</code> would attempt to focus, making it explicit can sometimes clarify intent or handle edge cases where automatic focusing might be ambiguous.</li>
<li><code>page.keyboard.press("Control+A")</code>: This is the key action. We use <code>page.keyboard.press()</code> to send a "Control+A" command.
<ul>
<li>This simulates the user pressing and holding 'Control' (or 'Command' on macOS for this common shortcut) and then pressing 'A'.</li>
<li>The browser interprets this as a "select all" command within the focused input field.</li>
</ul>
</li>
<li><code>page.keyboard.press("Backspace")</code>: After selecting all text, pressing 'Backspace' (or 'Delete') will remove the selected content.</li>
<li><code>expect(text_input).to_be_empty()</code>: We verify that the combined actions of "select all" and "backspace" have cleared the input field.</li>
</ol>
<p>The commented-out alternative shows that <code>locator.press("Control+A")</code> followed by <code>locator.press("Backspace")</code> would achieve the same result. The choice between <code>page.keyboard.press()</code> and <code>locator.press()</code> often depends on whether you want the action to be explicitly tied to a locator (which also handles focusing) or sent more globally to the currently focused element. For application-wide shortcuts, <code>page.keyboard.press()</code> is common. For actions specific to an element that might not yet be focused, <code>locator.press()</code> is convenient.</p>
<p><strong><code>.press()</code> vs. <code>.fill()</code> for Text Input</strong></p>
<p>It's important to understand the difference between <code>locator.press('A')</code> and <code>locator.fill('A')</code>:</p>
<ul>
<li>
<p><strong><code>locator.fill("some text")</code></strong>:</p>
<ul>
<li>This method is designed for efficiently populating form fields.</li>
<li>It typically clears the input field first (unless <code>force=True</code> is used with some elements or options are passed to disable clearing) and then types the entire string.</li>
<li>It's generally faster and more reliable for setting the value of an input.</li>
<li>It triggers necessary events like <code>input</code> and <code>change</code> to simulate user typing, but it doesn't simulate individual <code>keydown</code>/<code>keyup</code> events for each character in the string.</li>
</ul>
</li>
<li>
<p><strong><code>locator.press('S')</code>, <code>locator.press('o')</code>, <code>locator.press('m')</code>, <code>locator.press('e')</code>...</strong>:</p>
<ul>
<li>This simulates individual key presses for each character.</li>
<li>It will fire <code>keydown</code>, <code>keypress</code>, and <code>keyup</code> events for each character, which is closer to actual human typing.</li>
<li>This is generally too verbose and less efficient for filling out entire text fields.</li>
<li>Its primary use is for single key actions (like 'Enter', 'Escape', 'Tab') or when the specific intermediate key events are critical for the functionality being tested (e.g., an input field that triggers suggestions on each <code>keyup</code>).</li>
</ul>
</li>
</ul>
<p><strong>In summary:</strong></p>
<ul>
<li>Use <strong><code>.fill()</code></strong> for populating text inputs, textareas, and contenteditable elements with strings of text.</li>
<li>Use <strong><code>.press()</code></strong> for:
<ul>
<li>Simulating special key presses ('Enter', 'Escape', 'Tab', arrow keys, etc.).</li>
<li>Testing keyboard shortcuts (e.g., 'Control+S').</li>
<li>Interactions where the individual <code>keydown</code>/<code>keyup</code> events matter, not just the final text value.</li>
</ul>
</li>
</ul>
<p><strong>Best Practices and Considerations for <code>.press()</code></strong></p>
<ol>
<li><strong>Focus Management:</strong> Keyboard events are directed to the currently focused element. While Playwright's <code>locator.press()</code> attempts to focus the element first, be mindful of which element <em>should</em> have focus when a key is pressed. You can use <code>locator.focus()</code> explicitly if needed, or <code>expect(locator).to_be_focused()</code> to verify.</li>
<li><strong>Element Visibility and Enabled State:</strong> Ensure the element intended to receive the key press is visible and enabled. Playwright's auto-waiting mechanisms usually handle this for actions like <code>.press()</code>, but it's a common source of issues if an element is not interactive.</li>
<li><strong>Test Keyboard Navigability:</strong> Use <code>.press("Tab")</code> and <code>.press("Shift+Tab")</code> to test if users can navigate through your form fields, links, and buttons using only the keyboard. Assert that focus moves to the correct elements.</li>
<li><strong>Context is Key:</strong> Understand what the expected behavior of a key press is within the specific context of your application's UI. Does 'Enter' submit a form, activate a button, or add a new line in a textarea?</li>
<li><strong>Use for Intended Purpose:</strong> While you <em>can</em> type out a word character by character using multiple <code>.press()</code> calls, <code>.fill()</code> is almost always the better choice for text entry. Reserve <code>.press()</code> for simulating single keystrokes or key combinations that trigger specific behaviors.</li>
</ol>
<p>By mastering <code>.press()</code>, you can create more comprehensive E2E tests that cover a wider range of user interactions, leading to a more robust and accessible Django application. This method is crucial for ensuring that features relying on keyboard input, from simple form submissions to complex shortcuts, work as intended for all users.</p>
<h3 id="137-case-study-automating-your-admin-login-flow" tabindex="-1"><a class="anchor" href="#137-case-study-automating-your-admin-login-flow" name="137-case-study-automating-your-admin-login-flow" tabindex="-1"><span class="octicon octicon-link"></span></a>13.7 Case Study: Automating Your Admin Login Flow</h3>
<p>In the preceding sections, we've explored various Playwright actions like clicking, filling input fields, and navigating pages. Now, let's consolidate this knowledge into a practical, end-to-end scenario: automating the login process for the Django admin interface. This is a critical user flow for many Django applications, and ensuring it works reliably is paramount.</p>
<p>This case study will demonstrate how to:</p>
<ol>
<li>Create necessary test data (a superuser).</li>
<li>Navigate to the admin login page using <code>live_server</code>.</li>
<li>Locate and fill in the username and password fields.</li>
<li>Locate and click the login button.</li>
<li>Verify that the login was successful by checking for an element on the admin dashboard.</li>
</ol>
<p>This example directly addresses one of the common frustrations mentioned earlier: "The Mystery of Failing Logins." By using <code>live_server</code> (which provides a real Django server instance) in conjunction with <code>@pytest.mark.django_db</code> (which ensures a clean, isolated test database), we can reliably test login functionality without interference from development data or stale server states.</p>
<p><strong>Assumptions:</strong></p>
<ul>
<li>You have <code>pytest</code>, <code>pytest-django</code>, and <code>pytest-playwright</code> installed and configured.</li>
<li>Your Django project has the admin interface enabled (<code>django.contrib.admin</code> in <code>INSTALLED_APPS</code>).</li>
</ul>
<p>Let's build the test step-by-step.</p>
<p>First, we need a test function that uses the <code>page</code> fixture from <code>pytest-playwright</code> and the <code>live_server</code> fixture from <code>pytest-django</code>. We'll also mark it with <code>@pytest.mark.django_db</code> to ensure it has access to a fresh test database.</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token keyword">import</span> pytest
<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> Page<span class="token punctuation">,</span> expect
<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth <span class="token keyword">import</span> get_user_model
<span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> reverse <span class="token comment"># For robust URL generation</span>

User <span class="token operator">=</span> get_user_model<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>mark<span class="token punctuation">.</span>django_db</span>
<span class="token keyword">def</span> <span class="token function">test_admin_login_flow</span><span class="token punctuation">(</span>page<span class="token punctuation">:</span> Page<span class="token punctuation">,</span> live_server<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Arrange: Create a superuser</span>
    admin_username <span class="token operator">=</span> <span class="token string">"test_admin"</span>
    admin_password <span class="token operator">=</span> <span class="token string">"a_very_secure_password_123"</span>
    User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create_superuser<span class="token punctuation">(</span>admin_username<span class="token punctuation">,</span> <span class="token string">"admin@example.com"</span><span class="token punctuation">,</span> admin_password<span class="token punctuation">)</span>

    <span class="token comment"># Construct the admin login URL. Using reverse() is more robust to URL changes.</span>
    <span class="token comment"># However, for /admin/, it's fairly stable. We'll use a simple approach here</span>
    <span class="token comment"># but acknowledge reverse() as a best practice for other views.</span>
    admin_login_url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>live_server<span class="token punctuation">.</span>url<span class="token punctuation">}</span></span><span class="token string">/admin/login/"</span></span>
    <span class="token comment"># Alternatively, Django's admin often redirects from /admin/ to /admin/login/ if not authenticated</span>
    <span class="token comment"># admin_login_url = f"{live_server.url}/admin/"</span>


    <span class="token comment"># Act Part 1: Navigate to the admin login page</span>
    page<span class="token punctuation">.</span>goto<span class="token punctuation">(</span>admin_login_url<span class="token punctuation">)</span>

    <span class="token comment"># Assert (Optional intermediate check): Verify we are on the login page</span>
    expect<span class="token punctuation">(</span>page<span class="token punctuation">.</span>get_by_role<span class="token punctuation">(</span><span class="token string">"heading"</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"Django administration"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_visible<span class="token punctuation">(</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>page<span class="token punctuation">.</span>get_by_label<span class="token punctuation">(</span><span class="token string">"Username:"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_visible<span class="token punctuation">(</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>page<span class="token punctuation">.</span>get_by_label<span class="token punctuation">(</span><span class="token string">"Password:"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_visible<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># Act Part 2: Fill in credentials and submit</span>
    <span class="token comment"># Use get_by_label for better accessibility and resilience to minor HTML changes</span>
    page<span class="token punctuation">.</span>get_by_label<span class="token punctuation">(</span><span class="token string">"Username:"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fill<span class="token punctuation">(</span>admin_username<span class="token punctuation">)</span>
    page<span class="token punctuation">.</span>get_by_label<span class="token punctuation">(</span><span class="token string">"Password:"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fill<span class="token punctuation">(</span>admin_password<span class="token punctuation">)</span>
    
    <span class="token comment"># Use get_by_role for the submit button</span>
    page<span class="token punctuation">.</span>get_by_role<span class="token punctuation">(</span><span class="token string">"button"</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"Log in"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># Assert Part 2: Verify successful login</span>
    <span class="token comment"># Check for a known element on the admin dashboard, like "Site administration" or "Log out" link</span>
    expect<span class="token punctuation">(</span>page<span class="token punctuation">.</span>get_by_text<span class="token punctuation">(</span><span class="token string">"Site administration"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_visible<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">)</span> <span class="token comment"># Increased timeout for page load</span>
    expect<span class="token punctuation">(</span>page<span class="token punctuation">.</span>get_by_role<span class="token punctuation">(</span><span class="token string">"link"</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"Log out"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_visible<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># Optional: Verify the URL has changed to the admin dashboard</span>
    <span class="token comment"># Note: The exact URL can sometimes have a trailing slash or not, depending on server config.</span>
    <span class="token comment"># Using a flexible check or focusing on content is often more robust.</span>
    expect<span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_url<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>live_server<span class="token punctuation">.</span>url<span class="token punctuation">}</span></span><span class="token string">/admin/"</span></span><span class="token punctuation">)</span>
</code></pre>
<p>Let's examine this code in detail:</p>
<ol>
<li>
<p><strong>Imports and Setup</strong>:</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token keyword">import</span> pytest
<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> Page<span class="token punctuation">,</span> expect
<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth <span class="token keyword">import</span> get_user_model
<span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> reverse <span class="token comment"># For robust URL generation</span>

User <span class="token operator">=</span> get_user_model<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<ul>
<li><code>pytest</code>: The testing framework itself.</li>
<li><code>Page</code>, <code>expect</code>: Core components from Playwright. <code>Page</code> represents the browser page we interact with, and <code>expect</code> is used for Playwright's specific assertions.</li>
<li><code>get_user_model</code>: A Django utility to fetch the currently active User model for your project. This is the recommended way to refer to the User model.</li>
<li><code>reverse</code>: (Imported but commented out in direct use for <code>/admin/login/</code> for simplicity in this example, but good to be aware of). Django's URL reversing utility, which allows you to generate URLs from their names, making tests more resilient to URL path changes. For <code>/admin/</code> paths, they are quite stable, but for your own application views, <code>reverse</code> is highly recommended.</li>
<li><code>User = get_user_model()</code>: We get the User model class and assign it to the <code>User</code> variable for easier use.</li>
</ul>
</li>
<li>
<p><strong>Test Function Definition and Decorator</strong>:</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>mark<span class="token punctuation">.</span>django_db</span>
<span class="token keyword">def</span> <span class="token function">test_admin_login_flow</span><span class="token punctuation">(</span>page<span class="token punctuation">:</span> Page<span class="token punctuation">,</span> live_server<span class="token punctuation">)</span><span class="token punctuation">:</span>
</code></pre>
<ul>
<li><code>@pytest.mark.django_db</code>: This crucial marker does two things:
<ol>
<li>Ensures that a fresh, isolated test database is created for this test.</li>
<li>Allows Django ORM operations within the test.</li>
</ol>
</li>
<li><code>def test_admin_login_flow(page: Page, live_server):</code>: Defines our test function.
<ul>
<li><code>page: Page</code>: This injects the Playwright <code>Page</code> fixture, giving us control over a browser page.</li>
<li><code>live_server</code>: This injects the <code>pytest-django</code> <code>live_server</code> fixture. It starts a real Django development server running your application, serving it over HTTP, and importantly, configured to use the <em>test database</em>. This is the "game changer" we discussed in Chapter 10.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Arrange - Creating Test Data</strong>:</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># Arrange: Create a superuser</span>
admin_username <span class="token operator">=</span> <span class="token string">"test_admin"</span>
admin_password <span class="token operator">=</span> <span class="token string">"a_very_secure_password_123"</span>
User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create_superuser<span class="token punctuation">(</span>admin_username<span class="token punctuation">,</span> <span class="token string">"admin@example.com"</span><span class="token punctuation">,</span> admin_password<span class="token punctuation">)</span>
</code></pre>
<ul>
<li>This is the "Arrange" phase of the AAA (Arrange, Act, Assert) pattern.</li>
<li>We define <code>admin_username</code> and <code>admin_password</code> variables. It's good practice to use distinct, test-specific credentials rather than relying on any default or development environment credentials.</li>
<li><code>User.objects.create_superuser(...)</code>: We use the Django ORM to create a new superuser in the test database. This user will only exist for the duration of this test (or potentially longer if fixture scopes are involved, which we'll cover later). This ensures our test is self-contained and doesn't depend on pre-existing data.</li>
</ul>
</li>
<li>
<p><strong>Arrange - Constructing the URL</strong>:</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># Construct the admin login URL. Using reverse() is more robust to URL changes.</span>
<span class="token comment"># However, for /admin/, it's fairly stable. We'll use a simple approach here</span>
<span class="token comment"># but acknowledge reverse() as a best practice for other views.</span>
admin_login_url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>live_server<span class="token punctuation">.</span>url<span class="token punctuation">}</span></span><span class="token string">/admin/login/"</span></span>
<span class="token comment"># Alternatively, Django's admin often redirects from /admin/ to /admin/login/ if not authenticated</span>
<span class="token comment"># admin_login_url = f"{live_server.url}/admin/"</span>
</code></pre>
<ul>
<li><code>live_server.url</code>: This attribute of the <code>live_server</code> fixture provides the base URL (e.g., <code>http://localhost:8081</code>) where the test Django server is running.</li>
<li>We append <code>/admin/login/</code> to get the full URL for the Django admin login page. Django's admin is typically configured to redirect from <code>/admin/</code> to <code>/admin/login/</code> if the user is not authenticated, so using <code>/admin/</code> directly often works too. For clarity and directness, <code>/admin/login/</code> is explicit.</li>
<li>The comment highlights that for application-specific views, using <code>reverse('admin:login')</code> (after importing <code>reverse</code> from <code>django.urls</code>) would be more robust: <code>admin_login_url = live_server.url + reverse('admin:login')</code>.</li>
</ul>
</li>
<li>
<p><strong>Act Part 1 - Navigation and Optional Intermediate Assertion</strong>:</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># Act Part 1: Navigate to the admin login page</span>
page<span class="token punctuation">.</span>goto<span class="token punctuation">(</span>admin_login_url<span class="token punctuation">)</span>

<span class="token comment"># Assert (Optional intermediate check): Verify we are on the login page</span>
expect<span class="token punctuation">(</span>page<span class="token punctuation">.</span>get_by_role<span class="token punctuation">(</span><span class="token string">"heading"</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"Django administration"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_visible<span class="token punctuation">(</span><span class="token punctuation">)</span>
expect<span class="token punctuation">(</span>page<span class="token punctuation">.</span>get_by_label<span class="token punctuation">(</span><span class="token string">"Username:"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_visible<span class="token punctuation">(</span><span class="token punctuation">)</span>
expect<span class="token punctuation">(</span>page<span class="token punctuation">.</span>get_by_label<span class="token punctuation">(</span><span class="token string">"Password:"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_visible<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<ul>
<li><code>page.goto(admin_login_url)</code>: This is the Playwright action that navigates the browser page to the specified URL. Playwright will wait for the page to load before proceeding.</li>
<li>The subsequent <code>expect</code> calls are optional intermediate assertions. They confirm that we've landed on the expected login page by checking for the presence of key elements like the main heading and the input field labels. This can be helpful for debugging if the navigation fails or leads to an unexpected page.
<ul>
<li><code>page.get_by_role("heading", name="Django administration")</code>: This uses a role-based locator, which is excellent for accessibility and robustness. It looks for an HTML heading element (like <code>&lt;h1&gt;</code>, <code>&lt;h2&gt;</code>, etc.) whose accessible name is "Django administration".</li>
<li><code>page.get_by_label("Username:")</code>: This locator finds an input field associated with a <code>&lt;label&gt;</code> tag containing the text "Username:". This is a very user-centric way to find form fields.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Act Part 2 - Filling Credentials and Submitting</strong>:</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># Act Part 2: Fill in credentials and submit</span>
<span class="token comment"># Use get_by_label for better accessibility and resilience to minor HTML changes</span>
page<span class="token punctuation">.</span>get_by_label<span class="token punctuation">(</span><span class="token string">"Username:"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fill<span class="token punctuation">(</span>admin_username<span class="token punctuation">)</span>
page<span class="token punctuation">.</span>get_by_label<span class="token punctuation">(</span><span class="token string">"Password:"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fill<span class="token punctuation">(</span>admin_password<span class="token punctuation">)</span>

<span class="token comment"># Use get_by_role for the submit button</span>
page<span class="token punctuation">.</span>get_by_role<span class="token punctuation">(</span><span class="token string">"button"</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"Log in"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<ul>
<li><code>page.get_by_label("Username:").fill(admin_username)</code>: We locate the username input field using its label (as identified by Playwright's accessibility engine) and then use the <code>.fill()</code> action to type the <code>admin_username</code> into it. <code>.fill()</code> first clears the field and then types the text.</li>
<li><code>page.get_by_label("Password:").fill(admin_password)</code>: Similarly, we fill the password field.</li>
<li><code>page.get_by_role("button", name="Log in").click()</code>: We locate the login button. The Django admin login button is typically an <code>&lt;input type="submit" value="Log in"&gt;</code> or a <code>&lt;button type="submit"&gt;Log in&lt;/button&gt;</code>. <code>get_by_role("button", name="Log in")</code> is a robust way to find it, as it looks for elements that behave as buttons and have the accessible name "Log in". Then, <code>.click()</code> simulates a user click. Playwright will typically wait for any navigation triggered by the click to complete.</li>
</ul>
</li>
<li>
<p><strong>Assert Part 2 - Verifying Successful Login</strong>:</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># Assert Part 2: Verify successful login</span>
<span class="token comment"># Check for a known element on the admin dashboard, like "Site administration" or "Log out" link</span>
expect<span class="token punctuation">(</span>page<span class="token punctuation">.</span>get_by_text<span class="token punctuation">(</span><span class="token string">"Site administration"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_visible<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">)</span> <span class="token comment"># Increased timeout for page load</span>
expect<span class="token punctuation">(</span>page<span class="token punctuation">.</span>get_by_role<span class="token punctuation">(</span><span class="token string">"link"</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"Log out"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_visible<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Optional: Verify the URL has changed to the admin dashboard</span>
<span class="token comment"># Note: The exact URL can sometimes have a trailing slash or not, depending on server config.</span>
<span class="token comment"># Using a flexible check or focusing on content is often more robust.</span>
expect<span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_url<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>live_server<span class="token punctuation">.</span>url<span class="token punctuation">}</span></span><span class="token string">/admin/"</span></span><span class="token punctuation">)</span>
</code></pre>
<ul>
<li>This is the final "Assert" phase. We need to confirm that the login was successful.</li>
<li><code>expect(page.get_by_text("Site administration")).to_be_visible(timeout=5000)</code>: After a successful login, the user is redirected to the admin dashboard. A common piece of text on this page is "Site administration" (often within an <code>&lt;h1&gt;</code> tag). We locate this text and assert that it's visible. The <code>timeout=5000</code> (milliseconds) gives Playwright up to 5 seconds to find this element, which can be useful if the page takes a moment to fully render after login.</li>
<li><code>expect(page.get_by_role("link", name="Log out")).to_be_visible()</code>: Another strong indicator of a successful login is the presence of a "Log out" link. We use <code>get_by_role</code> to find this link.</li>
<li><code>expect(page).to_have_url(f"{live_server.url}/admin/")</code>: We also assert that the current page URL is now the base admin URL (e.g., <code>http://localhost:8081/admin/</code>). This confirms the redirection to the dashboard. Be mindful that URL assertions can sometimes be brittle if there are slight variations (e.g., trailing slashes). Asserting content visibility is often more robust.</li>
</ul>
</li>
</ol>
<p><strong>How it All Works Together:</strong></p>
<p>This test function simulates a complete user journey for logging into the Django admin:</p>
<ol>
<li><strong>Setup</strong>: A dedicated superuser is created in an isolated test database, thanks to <code>@pytest.mark.django_db</code>.</li>
<li><strong>Server</strong>: <code>live_server</code> starts a real Django server instance connected to this test database.</li>
<li><strong>Navigation</strong>: Playwright's <code>page</code> object navigates to the admin login URL provided by <code>live_server</code>.</li>
<li><strong>Interaction</strong>: Playwright locates the username and password fields (preferably by their accessible labels) and fills them with the credentials of the superuser created in step 1. It then finds and clicks the login button.</li>
<li><strong>Verification</strong>: After the click (which triggers a form submission and page navigation), Playwright waits for the new page to load. The test then asserts that elements specific to the admin dashboard (like "Site administration" text or the "Log out" link) are visible, and that the URL matches the expected admin dashboard URL.</li>
</ol>
<p><strong>Why this approach is effective:</strong></p>
<ul>
<li><strong>Isolation</strong>: Each test run gets a fresh database, preventing interference from other tests or stale data. This is a direct solution to the "database disconnect nightmare."</li>
<li><strong>Realism</strong>: <code>live_server</code> runs your actual Django application code, providing a high-fidelity testing environment for E2E tests.</li>
<li><strong>Reliability</strong>: Playwright's auto-waiting capabilities and robust locators (especially user-facing ones like <code>get_by_role</code> and <code>get_by_label</code>) make tests less flaky.</li>
<li><strong>Clarity</strong>: The AAA pattern makes the test's intent clear.</li>
<li><strong>Maintainability</strong>: Using semantic locators and creating necessary data within the test (or fixtures, as we'll see later) makes the test self-contained and easier to understand and maintain.</li>
</ul>
<p>This case study demonstrates a fundamental E2E test. In a real-world scenario, you might extend this by:</p>
<ul>
<li>Creating the admin user within a <code>pytest</code> fixture for reusability across multiple tests (Chapter 16 will delve into this).</li>
<li>Parameterizing the test to check different user roles or invalid login attempts.</li>
<li>Interacting with more elements on the admin dashboard after logging in.</li>
</ul>
<p>By mastering such flows, you build confidence that critical pathways in your application are functioning correctly, directly addressing the core goal of making testing a valuable and reassuring part of your development process.</p>
</div></div><script>
document.addEventListener('DOMContentLoaded', function() {
  const preTags = document.querySelectorAll('pre');
  
  preTags.forEach(function(pre) {
    const existingContainer = pre.closest('.pre-container');
    if (existingContainer) {
      // If pre is already in a container (e.g. script ran multiple times or manual structure)
      // Ensure button is there or add it. For simplicity, we assume if container exists, button might too.
      // A more robust check would be to see if a .copy-btn already exists for this pre.
      // For now, let's prevent adding duplicate buttons if script re-runs on dynamic content.
      if (existingContainer.querySelector('.copy-btn')) {
          return; // Skip if button already there
      }
    }

    const container = document.createElement('div');
    container.className = 'pre-container';
    
    const copyBtn = document.createElement('button');
    copyBtn.textContent = 'Copy';
    copyBtn.className = 'copy-btn';
    
    copyBtn.addEventListener('click', function() {
      const textToCopy = pre.innerText || pre.textContent; // .innerText is often better for user-visible text
      navigator.clipboard.writeText(textToCopy).then(
        function() {
          const originalText = copyBtn.textContent;
          copyBtn.textContent = 'Copied!';
          copyBtn.classList.add('copied');
          copyBtn.classList.remove('failed');
          
          setTimeout(function() {
            copyBtn.textContent = originalText;
            copyBtn.classList.remove('copied');
          }, 2000);
        },
        function() {
          const originalText = copyBtn.textContent;
          copyBtn.textContent = 'Failed!';
          copyBtn.classList.add('failed');
          copyBtn.classList.remove('copied');
          
          setTimeout(function() {
            copyBtn.textContent = originalText;
            copyBtn.classList.remove('failed');
          }, 2000);
        }
      );
    });
    
    // Structure: parent -> container -> pre & button
    if (pre.parentNode) {
        pre.parentNode.insertBefore(container, pre);
    }
    container.appendChild(pre); // Move pre into container
    container.appendChild(copyBtn); // Add button to container
  });
});
</script></body></html>