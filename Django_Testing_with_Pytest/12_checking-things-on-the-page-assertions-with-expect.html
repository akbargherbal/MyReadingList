<html><head><meta content="light dark" name="color-scheme"/><link href="../style/icons/default/16x16.png" rel="icon"/><link href="../style/themes/github-dark.css" id="_theme" rel="stylesheet" type="text/css"/><link href="../style/vendor/prism-okaidia.min.css" id="_prism" rel="stylesheet" type="text/css"/><link defer="" href="../style/style.css" rel="stylesheet"/><style>
.pre-container {
    position: relative;
}

.copy-btn {
    position: absolute;
    top: 5px;
    right: 5px;
    padding: 3px 8px;
    font-size: 12px;
    background-color: #800000; /* Maroon */
    color: white;
    border: 1px solid #5c0000; /* Darker maroon */
    border-radius: 3px;
    cursor: pointer;
    transition: background-color 0.2s ease;
}

.copy-btn:hover {
    background-color: #a00000; /* Lighter maroon on hover */
}

.copy-btn.copied {
    background-color: #006400; /* Dark Green */
    border-color: #004d00;
    color: white;
}

.copy-btn.failed {
    background-color: #dc3545; /* Red */
    border-color: #c82333;
    color: white;
}
</style></head><body class="_theme-github _color-light"><div class="markdown-body" id="_html" style="visibility: visible;"><div class="akbar_container"><h1 id="chapter-12-checking-things-on-the-page-assertions-with-expect" tabindex="-1"><a class="anchor" href="#chapter-12-checking-things-on-the-page-assertions-with-expect" name="chapter-12-checking-things-on-the-page-assertions-with-expect" tabindex="-1"><span class="octicon octicon-link"></span></a>Chapter 12: Checking Things on the Page: Assertions with <code>expect</code></h1>
<h2 id="121-core-assertions-to_be_visible-to_be_hidden-to_be_enabled-to_be_empty" tabindex="-1"><a class="anchor" href="#121-core-assertions-to_be_visible-to_be_hidden-to_be_enabled-to_be_empty" name="121-core-assertions-to_be_visible-to_be_hidden-to_be_enabled-to_be_empty" tabindex="-1"><span class="octicon octicon-link"></span></a>12.1 Core Assertions: <code>to_be_visible</code>, <code>to_be_hidden</code>, <code>to_be_enabled</code>, <code>to_be_empty</code></h2>
<p>In the previous chapter, we learned how to locate elements on a web page. Locating elements is only the first step; the next crucial step is to verify their state and properties. This is where assertions come into play. Assertions are statements that check if a certain condition is true. If the condition is false, the test fails, signaling a discrepancy between expected and actual behavior.</p>
<p>Playwright provides a powerful assertion library through its <code>expect()</code> function. This function, when combined with a locator and an assertion method, allows you to make rich and reliable checks against the state of your web page. A key feature of Playwright's <code>expect()</code> is its auto-waiting capability. This means Playwright will automatically wait for a certain period for the condition to become true before failing the test. This significantly reduces flakiness often associated with UI tests where elements might not be immediately available or in the desired state.</p>
<p>In this section, we'll explore some of the most fundamental and commonly used assertions:</p>
<ul>
<li><code>to_be_visible()</code>: Checks if an element is visible to the user.</li>
<li><code>to_be_hidden()</code>: Checks if an element is not visible to the user.</li>
<li><code>to_be_enabled()</code>: Checks if an interactive element (like a button or input) is enabled.</li>
<li><code>to_be_disabled()</code>: Checks if an interactive element is disabled.</li>
<li><code>to_be_empty()</code>: Checks if an element has no text content and no child elements.</li>
</ul>
<p>Let's dive into each of these with practical examples. For the following examples, imagine we have a Django view that renders a simple HTML page. We'll focus on the Playwright test code and the HTML structure it expects.</p>
<h3 id="1211-expectlocatorto_be_visible" tabindex="-1"><a class="anchor" href="#1211-expectlocatorto_be_visible" name="1211-expectlocatorto_be_visible" tabindex="-1"><span class="octicon octicon-link"></span></a>12.1.1 <code>expect(locator).to_be_visible()</code></h3>
<p><strong>Conceptual Clarity:</strong>
The <code>to_be_visible()</code> assertion verifies that the element selected by the locator is currently visible on the page. Visibility in this context means more than just <code>display: block</code>; it implies that the element occupies space on the screen, is not transparent, and is not obscured by other elements.</p>
<p><strong>Why it's important:</strong>
Users can only interact with elements they can see. Asserting visibility is fundamental for ensuring that UI components are correctly displayed before attempting to interact with them or verifying that certain elements appear after a specific action (e.g., a success message appearing after form submission).</p>
<p><strong>Mental Model ("Under the Hood"):</strong>
When you use <code>expect(locator).to_be_visible()</code>, Playwright performs several checks:</p>
<ol>
<li><strong>Element Exists:</strong> It first ensures the element exists in the DOM.</li>
<li><strong>CSS Visibility:</strong> It checks CSS properties like <code>visibility: visible</code> (not <code>hidden</code> or <code>collapse</code>).</li>
<li><strong>CSS Display:</strong> It ensures the element is not <code>display: none</code>.</li>
<li><strong>Opacity:</strong> It checks that the element is not fully transparent (e.g., <code>opacity: 0</code>).</li>
<li><strong>Size:</strong> The element must have a width and height greater than zero. An element with <code>height: 0px</code> or <code>width: 0px</code> is not considered visible.</li>
<li><strong>Not Obscured:</strong> Playwright also attempts to determine if the element is obscured by other elements, although this can be complex. For basic cases, it checks if the element's center point is interactable.</li>
</ol>
<p>Playwright will retry these checks for a default timeout period (configurable) if the element is not immediately visible.</p>
<p><strong>Hands-on Example:</strong></p>
<p>Let's assume our Django template renders the following HTML:</p>
<pre class="language-html" tabindex="0"><code class="language-html"><span class="token comment">&lt;!-- THIS_CODE_SNIPPET --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>welcome-message<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Hello, User!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hidden-message<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>This is a secret.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>show-secret-button<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Show Secret<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token comment">// THIS_CODE_SNIPPET</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'show-secret-button'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> secretMessage <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'hidden-message'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    secretMessage<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'block'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>Now, let's write a Playwright test to verify the visibility of these elements.</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># tests/e2e/test_visibility.py</span>
<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> Page<span class="token punctuation">,</span> expect
<span class="token keyword">import</span> pytest

<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>mark<span class="token punctuation">.</span>django_db</span> <span class="token comment"># Ensures test database is available if needed</span>
<span class="token keyword">def</span> <span class="token function">test_welcome_message_is_visible</span><span class="token punctuation">(</span>page<span class="token punctuation">:</span> Page<span class="token punctuation">,</span> live_server<span class="token punctuation">)</span><span class="token punctuation">:</span>
    page<span class="token punctuation">.</span>goto<span class="token punctuation">(</span>live_server<span class="token punctuation">.</span>url <span class="token operator">+</span> <span class="token string">"/my-simple-page/"</span><span class="token punctuation">)</span> <span class="token comment"># Assuming this URL serves the HTML above</span>

    <span class="token comment"># Locate the welcome message</span>
    welcome_message_locator <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#welcome-message"</span><span class="token punctuation">)</span>
    <span class="token comment"># Assert that it is visible</span>
    expect<span class="token punctuation">(</span>welcome_message_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_visible<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># Locate the initially hidden message</span>
    hidden_message_locator <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#hidden-message"</span><span class="token punctuation">)</span>
    <span class="token comment"># Assert that it is NOT initially visible (we'll use .not later, or to_be_hidden)</span>
    <span class="token comment"># For now, let's focus on what becomes visible after an action</span>

    <span class="token comment"># Locate the button and click it</span>
    show_button_locator <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#show-secret-button"</span><span class="token punctuation">)</span>
    show_button_locator<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># Now, assert that the hidden message becomes visible</span>
    expect<span class="token punctuation">(</span>hidden_message_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_visible<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p><strong>Code Explanation:</strong></p>
<p>Let's examine the Python test code in detail:</p>
<ol>
<li><code>from playwright.sync_api import Page, expect</code>:
<ul>
<li>This line imports the necessary <code>Page</code> object type hint and the <code>expect</code> function from Playwright, which is central to making assertions.</li>
</ul>
</li>
<li><code>import pytest</code>:
<ul>
<li>Imports <code>pytest</code> for test framework functionalities.</li>
</ul>
</li>
<li><code>@pytest.mark.django_db</code>:
<ul>
<li>This marker, provided by <code>pytest-django</code>, ensures that a test database is set up for this test. While not strictly necessary for a purely client-side visibility check if the page content is static HTML, it's good practice if the page might eventually interact with the database.</li>
</ul>
</li>
<li><code>def test_welcome_message_is_visible(page: Page, live_server):</code>:
<ul>
<li>Defines our test function. It receives the <code>page</code> fixture from <code>pytest-playwright</code> (representing a browser tab) and the <code>live_server</code> fixture from <code>pytest-django</code> (providing the URL to our running Django application).</li>
</ul>
</li>
<li><code>page.goto(live_server.url + "/my-simple-page/")</code>:
<ul>
<li>Navigates the browser page to a hypothetical URL <code>/my-simple-page/</code> served by our Django development server. We assume this URL renders the HTML structure shown earlier.</li>
</ul>
</li>
<li><code>welcome_message_locator = page.locator("#welcome-message")</code>:
<ul>
<li>We use <code>page.locator()</code> with a CSS selector <code>#welcome-message</code> to get a reference (a <code>Locator</code> object) to the <code>div</code> element with the ID <code>welcome-message</code>. This doesn't immediately fetch the element but creates an object that knows how to find it.</li>
</ul>
</li>
<li><code>expect(welcome_message_locator).to_be_visible()</code>:
<ul>
<li>This is the core assertion.</li>
<li><code>expect(welcome_message_locator)</code>: We pass our locator to the <code>expect</code> function.</li>
<li><code>.to_be_visible()</code>: This specific assertion method is then called. Playwright will now check if the element identified by <code>welcome_message_locator</code> is visible on the page according to the criteria discussed in the "Mental Model." If it's not immediately visible, Playwright will wait and retry for a configured timeout before failing the test.</li>
</ul>
</li>
<li><code>hidden_message_locator = page.locator("#hidden-message")</code>:
<ul>
<li>Similarly, we get a locator for the initially hidden message.</li>
</ul>
</li>
<li><code>show_button_locator = page.locator("#show-secret-button")</code>:
<ul>
<li>We get a locator for the button.</li>
</ul>
</li>
<li><code>show_button_locator.click()</code>:
<ul>
<li>We simulate a user click on the "Show Secret" button. Based on our example HTML's JavaScript, this action should change the <code>display</code> style of <code>#hidden-message</code> from <code>none</code> to <code>block</code>.</li>
</ul>
</li>
<li><code>expect(hidden_message_locator).to_be_visible()</code>:
<ul>
<li>After the click action, we assert that the <code>hidden-message</code> element is now visible. Playwright will again wait if necessary for the JavaScript to execute and the element's style to update.</li>
</ul>
</li>
</ol>
<p>This example demonstrates how <code>to_be_visible()</code> can be used to check initial states and states after user interactions. The built-in wait mechanism is crucial here, as the JavaScript modifying the DOM might not execute instantaneously.</p>
<h3 id="1212-expectlocatorto_be_hidden" tabindex="-1"><a class="anchor" href="#1212-expectlocatorto_be_hidden" name="1212-expectlocatorto_be_hidden" tabindex="-1"><span class="octicon octicon-link"></span></a>12.1.2 <code>expect(locator).to_be_hidden()</code></h3>
<p><strong>Conceptual Clarity:</strong>
The <code>to_be_hidden()</code> assertion is the logical opposite of <code>to_be_visible()</code>. It verifies that the element selected by the locator is currently not visible on the page. This could mean the element has <code>display: none</code>, <code>visibility: hidden</code>, zero dimensions, or is simply not present in the DOM.</p>
<p><strong>Why it's important:</strong>
This assertion is useful for verifying that:</p>
<ul>
<li>Elements that should be initially hidden are indeed hidden (e.g., modals, dropdown menus).</li>
<li>Elements correctly disappear after a user action (e.g., a notification closing, an item being removed from a list).</li>
<li>Elements are not rendered based on certain conditions (e.g., admin-only links for non-admin users).</li>
</ul>
<p><strong>Mental Model ("Under the Hood"):</strong>
Playwright considers an element hidden if:</p>
<ol>
<li><strong>Element Does Not Exist:</strong> The element is not found in the DOM.</li>
<li><strong>CSS Hiding:</strong> It has <code>display: none</code> or <code>visibility: hidden</code>.</li>
<li><strong>Zero Size:</strong> It has a width or height of zero.</li>
<li><strong>Opacity Zero:</strong> It has <code>opacity: 0</code>.</li>
</ol>
<p>Similar to <code>to_be_visible()</code>, Playwright will auto-wait for the element to become hidden.</p>
<p><strong>Hands-on Example:</strong></p>
<p>Using the same HTML structure from the previous example:</p>
<pre class="language-html" tabindex="0"><code class="language-html"><span class="token comment">&lt;!-- THIS_CODE_SNIPPET --&gt;</span>
<span class="token comment">&lt;!-- (Same HTML as before) --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>welcome-message<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Hello, User!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hidden-message<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>This is a secret.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>show-secret-button<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Show Secret<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token comment">// THIS_CODE_SNIPPET</span>
<span class="token comment">// (Same JavaScript as before)</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'show-secret-button'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> secretMessage <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'hidden-message'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    secretMessage<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'block'</span><span class="token punctuation">;</span>
    <span class="token comment">// Let's add a way to hide it again for a more complete example</span>
    secretMessage<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        secretMessage<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span> <span class="token comment">// Click the message to hide it</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>And the Playwright test:</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># tests/e2e/test_visibility.py (continued or a new test)</span>
<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> Page<span class="token punctuation">,</span> expect
<span class="token keyword">import</span> pytest

<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>mark<span class="token punctuation">.</span>django_db</span>
<span class="token keyword">def</span> <span class="token function">test_message_visibility_toggle</span><span class="token punctuation">(</span>page<span class="token punctuation">:</span> Page<span class="token punctuation">,</span> live_server<span class="token punctuation">)</span><span class="token punctuation">:</span>
    page<span class="token punctuation">.</span>goto<span class="token punctuation">(</span>live_server<span class="token punctuation">.</span>url <span class="token operator">+</span> <span class="token string">"/my-simple-page/"</span><span class="token punctuation">)</span>

    welcome_message_locator <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#welcome-message"</span><span class="token punctuation">)</span>
    hidden_message_locator <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#hidden-message"</span><span class="token punctuation">)</span>
    show_button_locator <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#show-secret-button"</span><span class="token punctuation">)</span>

    <span class="token comment"># 1. Assert initial states</span>
    expect<span class="token punctuation">(</span>welcome_message_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_visible<span class="token punctuation">(</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>hidden_message_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_hidden<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># Initially hidden</span>

    <span class="token comment"># 2. Click button to show the message</span>
    show_button_locator<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>hidden_message_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_visible<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># Should now be visible</span>

    <span class="token comment"># 3. Click the message itself to hide it (as per our modified JS)</span>
    hidden_message_locator<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>hidden_message_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_hidden<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># Should be hidden again</span>
</code></pre>
<p><strong>Code Explanation:</strong></p>
<ol>
<li><code>page.goto(...)</code>, <code>welcome_message_locator = ...</code>, <code>hidden_message_locator = ...</code>, <code>show_button_locator = ...</code>:
<ul>
<li>These lines are for setup: navigating to the page and getting locators for the elements we're interested in, same as before.</li>
</ul>
</li>
<li><code>expect(welcome_message_locator).to_be_visible()</code>:
<ul>
<li>Confirms the welcome message is visible as expected.</li>
</ul>
</li>
<li><code>expect(hidden_message_locator).to_be_hidden()</code>:
<ul>
<li>This is our first use of <code>to_be_hidden()</code>. It asserts that the element with ID <code>hidden-message</code> is not visible when the page initially loads. This passes because of <code>style="display: none;"</code>.</li>
</ul>
</li>
<li><code>show_button_locator.click()</code>:
<ul>
<li>Simulates a click on the "Show Secret" button.</li>
</ul>
</li>
<li><code>expect(hidden_message_locator).to_be_visible()</code>:
<ul>
<li>After the click, we assert that the <code>hidden-message</code> is now visible, as the JavaScript should have changed its <code>display</code> style.</li>
</ul>
</li>
<li><code>hidden_message_locator.click()</code>:
<ul>
<li>We added JavaScript to our HTML example so that clicking the secret message itself will hide it again. This line simulates that click.</li>
</ul>
</li>
<li><code>expect(hidden_message_locator).to_be_hidden()</code>:
<ul>
<li>Finally, we assert that after clicking the message, it becomes hidden again.</li>
</ul>
</li>
</ol>
<p>This test demonstrates a common pattern: asserting an initial state, performing an action, and then asserting the new state. <code>to_be_hidden()</code> is crucial for verifying that elements are correctly removed from view or are not displayed when they shouldn't be.</p>
<h3 id="1213-expectlocatorto_be_enabled" tabindex="-1"><a class="anchor" href="#1213-expectlocatorto_be_enabled" name="1213-expectlocatorto_be_enabled" tabindex="-1"><span class="octicon octicon-link"></span></a>12.1.3 <code>expect(locator).to_be_enabled()</code></h3>
<p><strong>Conceptual Clarity:</strong>
The <code>to_be_enabled()</code> assertion checks if an interactive element (typically form elements like <code>&lt;button&gt;</code>, <code>&lt;input&gt;</code>, <code>&lt;select&gt;</code>, <code>&lt;textarea&gt;</code>) is currently enabled. An enabled element is one that a user can interact with (e.g., click a button, type into an input field).</p>
<p><strong>Why it's important:</strong>
This is vital for testing form behavior and user workflows. For example:</p>
<ul>
<li>A submit button might be disabled until all required fields are filled.</li>
<li>Certain options might be enabled or disabled based on user roles or previous selections.</li>
<li>Ensuring an element is enabled before attempting to interact with it can make tests more robust.</li>
</ul>
<p><strong>Mental Model ("Under the Hood"):</strong>
Playwright checks if the element:</p>
<ol>
<li>Is a type of element that can be disabled (button, input, select, textarea, option, optgroup, fieldset).</li>
<li>Does <strong>not</strong> have the <code>disabled</code> HTML attribute.</li>
<li>If it's part of a <code>fieldset</code> with the <code>disabled</code> attribute, the element itself must not be explicitly enabled (which is less common).</li>
</ol>
<p>Playwright will auto-wait for the element to become enabled.</p>
<p><strong>Hands-on Example:</strong></p>
<p>Consider this HTML for a simple form:</p>
<pre class="language-html" tabindex="0"><code class="language-html"><span class="token comment">&lt;!-- THIS_CODE_SNIPPET --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>my-form<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Name:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name-input<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>agree<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Agree to terms:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>agree-checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>agree<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit-button<span class="token punctuation">"</span></span> <span class="token attr-name">disabled</span><span class="token punctuation">&gt;</span></span>Submit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token comment">// THIS_CODE_SNIPPET</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'agree-checkbox'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> submitButton <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'submit-button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>checked<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        submitButton<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// Enable the button</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        submitButton<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token comment">// Disable the button</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>In this HTML, the submit button is initially disabled. It only becomes enabled when the "Agree to terms" checkbox is checked.</p>
<p>Now, the Playwright test:</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># tests/e2e/test_form_elements.py</span>
<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> Page<span class="token punctuation">,</span> expect
<span class="token keyword">import</span> pytest

<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>mark<span class="token punctuation">.</span>django_db</span>
<span class="token keyword">def</span> <span class="token function">test_submit_button_enablement</span><span class="token punctuation">(</span>page<span class="token punctuation">:</span> Page<span class="token punctuation">,</span> live_server<span class="token punctuation">)</span><span class="token punctuation">:</span>
    page<span class="token punctuation">.</span>goto<span class="token punctuation">(</span>live_server<span class="token punctuation">.</span>url <span class="token operator">+</span> <span class="token string">"/my-form-page/"</span><span class="token punctuation">)</span> <span class="token comment"># Assumed URL for the form</span>

    name_input_locator <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#name-input"</span><span class="token punctuation">)</span>
    agree_checkbox_locator <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#agree-checkbox"</span><span class="token punctuation">)</span>
    submit_button_locator <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#submit-button"</span><span class="token punctuation">)</span>

    <span class="token comment"># 1. Assert initial states</span>
    expect<span class="token punctuation">(</span>name_input_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_enabled<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># Text inputs are usually enabled by default</span>
    expect<span class="token punctuation">(</span>agree_checkbox_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_enabled<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># Checkboxes are also enabled by default</span>
    <span class="token comment"># The submit button is initially disabled, so to_be_enabled() would fail.</span>
    <span class="token comment"># We'll use its counterpart to_be_disabled() for the initial check here.</span>
    expect<span class="token punctuation">(</span>submit_button_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_disabled<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 2. Interact with the checkbox to enable the button</span>
    agree_checkbox_locator<span class="token punctuation">.</span>check<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># Checks the checkbox</span>

    <span class="token comment"># 3. Assert that the submit button is now enabled</span>
    expect<span class="token punctuation">(</span>submit_button_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_enabled<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 4. Uncheck the checkbox to disable the button again</span>
    agree_checkbox_locator<span class="token punctuation">.</span>uncheck<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 5. Assert that the submit button is now disabled again</span>
    expect<span class="token punctuation">(</span>submit_button_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_disabled<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p><strong>Code Explanation:</strong></p>
<ol>
<li><code>page.goto(...)</code>, <code>name_input_locator = ...</code>, etc.:
<ul>
<li>Standard setup: navigate and get locators for the form elements.</li>
</ul>
</li>
<li><code>expect(name_input_locator).to_be_enabled()</code>:
<ul>
<li>Asserts that the text input field for "Name" is enabled. Standard input fields are enabled by default unless explicitly set to <code>disabled</code>.</li>
</ul>
</li>
<li><code>expect(agree_checkbox_locator).to_be_enabled()</code>:
<ul>
<li>Asserts that the "Agree to terms" checkbox is enabled. Checkboxes are also typically enabled by default.</li>
</ul>
</li>
<li><code>expect(submit_button_locator).to_be_disabled()</code>:
<ul>
<li>This uses <code>to_be_disabled()</code>, which we'll cover next, but it's the logical assertion here. Initially, our submit button has the <code>disabled</code> attribute, so this assertion passes.</li>
</ul>
</li>
<li><code>agree_checkbox_locator.check()</code>:
<ul>
<li>This Playwright action checks the checkbox. Our JavaScript is set up to remove the <code>disabled</code> attribute from the submit button when this checkbox is checked.</li>
</ul>
</li>
<li><code>expect(submit_button_locator).to_be_enabled()</code>:
<ul>
<li>Now, after checking the box, we assert that the submit button is enabled. Playwright waits for the <code>disabled</code> attribute to be removed. This is a key test for our form's dynamic behavior.</li>
</ul>
</li>
<li><code>agree_checkbox_locator.uncheck()</code>:
<ul>
<li>This action unchecks the checkbox. Our JavaScript should now re-apply the <code>disabled</code> attribute to the button.</li>
</ul>
</li>
<li><code>expect(submit_button_locator).to_be_disabled()</code>:
<ul>
<li>We assert that the button is once again disabled, confirming the toggle logic.</li>
</ul>
</li>
</ol>
<p>This example highlights how <code>to_be_enabled()</code> is crucial for testing interactive forms where element states change based on user input or other conditions.</p>
<h3 id="1214-expectlocatorto_be_disabled" tabindex="-1"><a class="anchor" href="#1214-expectlocatorto_be_disabled" name="1214-expectlocatorto_be_disabled" tabindex="-1"><span class="octicon octicon-link"></span></a>12.1.4 <code>expect(locator).to_be_disabled()</code></h3>
<p><strong>Conceptual Clarity:</strong>
The <code>to_be_disabled()</code> assertion is the direct counterpart to <code>to_be_enabled()</code>. It verifies that an interactive element is currently disabled, meaning the user cannot interact with it.</p>
<p><strong>Why it's important:</strong>
This is essential for:</p>
<ul>
<li>Confirming that elements are correctly initialized in a disabled state (e.g., a submit button before a form is valid).</li>
<li>Verifying that actions correctly disable elements (e.g., a button being disabled after it's clicked to prevent double submission).</li>
<li>Ensuring UI correctly reflects access control (e.g., features disabled for certain user roles).</li>
</ul>
<p><strong>Mental Model ("Under the Hood"):</strong>
Playwright checks if the element:</p>
<ol>
<li>Is a type of element that can be disabled.</li>
<li><strong>Has</strong> the <code>disabled</code> HTML attribute.</li>
<li>Or, if it's part of a <code>fieldset</code> with the <code>disabled</code> attribute and the element itself is not overriding that.</li>
</ol>
<p>Auto-waiting applies here as well.</p>
<p><strong>Hands-on Example:</strong>
We've already seen <code>to_be_disabled()</code> in action in the previous example (<code>test_submit_button_enablement</code>). Let's reinforce it with a slightly more direct example.</p>
<p>Assume this HTML:</p>
<pre class="language-html" tabindex="0"><code class="language-html"><span class="token comment">&lt;!-- THIS_CODE_SNIPPET --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>action-button<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Perform Action<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>locked-feature-button<span class="token punctuation">"</span></span> <span class="token attr-name">disabled</span><span class="token punctuation">&gt;</span></span>Locked Feature<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>Playwright test:</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># tests/e2e/test_disabled_elements.py</span>
<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> Page<span class="token punctuation">,</span> expect
<span class="token keyword">import</span> pytest

<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>mark<span class="token punctuation">.</span>django_db</span>
<span class="token keyword">def</span> <span class="token function">test_button_disabled_state</span><span class="token punctuation">(</span>page<span class="token punctuation">:</span> Page<span class="token punctuation">,</span> live_server<span class="token punctuation">)</span><span class="token punctuation">:</span>
    page<span class="token punctuation">.</span>goto<span class="token punctuation">(</span>live_server<span class="token punctuation">.</span>url <span class="token operator">+</span> <span class="token string">"/my-buttons-page/"</span><span class="token punctuation">)</span> <span class="token comment"># Assumed URL</span>

    action_button_locator <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#action-button"</span><span class="token punctuation">)</span>
    locked_button_locator <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#locked-feature-button"</span><span class="token punctuation">)</span>

    <span class="token comment"># 1. Assert that the action button is NOT disabled (i.e., it's enabled)</span>
    <span class="token comment"># We can use .not.to_be_disabled() or simply to_be_enabled()</span>
    expect<span class="token punctuation">(</span>action_button_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>not_to_be_disabled<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># Alternatively, and often more direct:</span>
    expect<span class="token punctuation">(</span>action_button_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_enabled<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 2. Assert that the locked feature button IS disabled</span>
    expect<span class="token punctuation">(</span>locked_button_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_disabled<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># Imagine an action that disables the action_button after click</span>
    <span class="token comment"># For simplicity, let's assume clicking it adds 'disabled' attribute via JS (not shown in HTML)</span>
    <span class="token comment"># action_button_locator.click()</span>
    <span class="token comment"># expect(action_button_locator).to_be_disabled() # This would be the check after such an action</span>
</code></pre>
<p><strong>Code Explanation:</strong></p>
<ol>
<li><code>page.goto(...)</code>, <code>action_button_locator = ...</code>, <code>locked_button_locator = ...</code>:
<ul>
<li>Page navigation and locator setup.</li>
</ul>
</li>
<li><code>expect(action_button_locator).not_to_be_disabled()</code>:
<ul>
<li>This demonstrates the use of <code>not</code> with an assertion. It checks that the <code>action-button</code> is <em>not</em> disabled. This is equivalent to <code>expect(action_button_locator).to_be_enabled()</code>.</li>
</ul>
</li>
<li><code>expect(action_button_locator).to_be_enabled()</code>:
<ul>
<li>A more direct way to assert that the button is enabled. Both this and the line above achieve the same goal for this specific case.</li>
</ul>
</li>
<li><code>expect(locked_button_locator).to_be_disabled()</code>:
<ul>
<li>This is the core assertion. It verifies that the <code>locked-feature-button</code>, which has the <code>disabled</code> attribute in the HTML, is indeed recognized as disabled by Playwright.</li>
</ul>
</li>
<li>The commented-out lines (<code>action_button_locator.click()</code> and the subsequent <code>expect</code>) sketch out a common scenario: an element starts enabled, an action occurs, and then the element becomes disabled. <code>to_be_disabled()</code> would be used to verify this state change.</li>
</ol>
<p>Using <code>to_be_disabled()</code> and <code>to_be_enabled()</code> allows you to precisely verify the interactability of your application's UI components, which is fundamental to testing user workflows.</p>
<h3 id="1215-expectlocatorto_be_empty" tabindex="-1"><a class="anchor" href="#1215-expectlocatorto_be_empty" name="1215-expectlocatorto_be_empty" tabindex="-1"><span class="octicon octicon-link"></span></a>12.1.5 <code>expect(locator).to_be_empty()</code></h3>
<p><strong>Conceptual Clarity:</strong>
The <code>to_be_empty()</code> assertion checks if an element contains no text content and no child DOM elements. It's "empty" in terms of what a user would perceive as content within that element.</p>
<p><strong>Why it's important:</strong>
This assertion is useful for verifying:</p>
<ul>
<li>That an element meant to display dynamic content is initially empty (e.g., an error message container, a list of search results before a search).</li>
<li>That content is correctly cleared from an element after an action (e.g., clearing a shopping cart, resetting a form).</li>
<li>Input fields that should be empty by default. Note that for input fields, <code>to_have_value('')</code> (covered later) is often more specific, but <code>to_be_empty()</code> can also apply if the input has no default <code>value</code> attribute and no placeholder that might be considered content by some interpretations (though <code>to_be_empty</code> primarily looks at <code>textContent</code> and child nodes).</li>
</ul>
<p><strong>Mental Model ("Under the Hood"):</strong>
Playwright checks if the element's <code>textContent</code> is an empty string (or whitespace-only, depending on the exact implementation details and options) AND if it has no child elements (<code>childNodes.length === 0</code>). It's important to distinguish this from an element not existing in the DOM; <code>to_be_empty()</code> expects the element to exist but to have no content.</p>
<p><strong>Hands-on Example:</strong></p>
<p>Consider this HTML:</p>
<pre class="language-html" tabindex="0"><code class="language-html"><span class="token comment">&lt;!-- THIS_CODE_SNIPPET --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>status-message<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>greeting-message<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Hello there!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item-list<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>Item 1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>empty-item-list<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>empty-input<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>Playwright test:</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># tests/e2e/test_empty_elements.py</span>
<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> Page<span class="token punctuation">,</span> expect
<span class="token keyword">import</span> pytest

<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>mark<span class="token punctuation">.</span>django_db</span>
<span class="token keyword">def</span> <span class="token function">test_element_emptiness</span><span class="token punctuation">(</span>page<span class="token punctuation">:</span> Page<span class="token punctuation">,</span> live_server<span class="token punctuation">)</span><span class="token punctuation">:</span>
    page<span class="token punctuation">.</span>goto<span class="token punctuation">(</span>live_server<span class="token punctuation">.</span>url <span class="token operator">+</span> <span class="token string">"/my-content-page/"</span><span class="token punctuation">)</span> <span class="token comment"># Assumed URL</span>

    status_message_locator <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#status-message"</span><span class="token punctuation">)</span>
    greeting_message_locator <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#greeting-message"</span><span class="token punctuation">)</span>
    item_list_locator <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#item-list"</span><span class="token punctuation">)</span>
    empty_list_locator <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#empty-item-list"</span><span class="token punctuation">)</span>
    empty_input_locator <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#empty-input"</span><span class="token punctuation">)</span>


    <span class="token comment"># 1. Assert that the status message div is empty</span>
    expect<span class="token punctuation">(</span>status_message_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_empty<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 2. Assert that the greeting message div is NOT empty</span>
    expect<span class="token punctuation">(</span>greeting_message_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>not_to_be_empty<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 3. Assert that the item list (with an &lt;li&gt;) is NOT empty</span>
    expect<span class="token punctuation">(</span>item_list_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>not_to_be_empty<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 4. Assert that the empty item list IS empty</span>
    expect<span class="token punctuation">(</span>empty_list_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_empty<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 5. Assert that an empty input field is empty</span>
    <span class="token comment"># For input fields, to_have_value('') is often more precise,</span>
    <span class="token comment"># but to_be_empty() can also work if it has no initial value attribute.</span>
    expect<span class="token punctuation">(</span>empty_input_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_empty<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p><strong>Code Explanation:</strong></p>
<ol>
<li><code>page.goto(...)</code> and locator definitions:
<ul>
<li>Standard setup.</li>
</ul>
</li>
<li><code>expect(status_message_locator).to_be_empty()</code>:
<ul>
<li>The <code>div</code> with ID <code>status-message</code> is empty in our HTML (<code>&lt;div id="status-message"&gt;&lt;/div&gt;</code>). This assertion passes because it has no text content and no child elements.</li>
</ul>
</li>
<li><code>expect(greeting_message_locator).not_to_be_empty()</code>:
<ul>
<li>The <code>div</code> with ID <code>greeting-message</code> contains the text "Hello there!". Therefore, it's not empty, and this assertion (using <code>not</code>) passes.</li>
</ul>
</li>
<li><code>expect(item_list_locator).not_to_be_empty()</code>:
<ul>
<li>The <code>ul</code> with ID <code>item-list</code> contains an <code>&lt;li&gt;</code> child element. Even if the <code>&lt;li&gt;</code> itself were empty, the <code>ul</code> would not be considered empty because it has a child node. This assertion passes.</li>
</ul>
</li>
<li><code>expect(empty_list_locator).to_be_empty()</code>:
<ul>
<li>The <code>ul</code> with ID <code>empty-item-list</code> has no <code>&lt;li&gt;</code> children and no text content directly within it. This assertion passes.</li>
</ul>
</li>
<li><code>expect(empty_input_locator).to_be_empty()</code>:
<ul>
<li>The <code>input</code> with ID <code>empty-input</code> has no <code>value</code> attribute and no inner content. Playwright considers such an input field to be empty. As noted in the comment, for specifically checking input values, <code>expect(locator).to_have_value('')</code> (which we'll cover in Section 12.2) is generally preferred for clarity and precision regarding input values. However, <code>to_be_empty()</code> can apply to inputs that are visually and structurally empty.</li>
</ul>
</li>
</ol>
<p><code>to_be_empty()</code> is a straightforward but useful assertion for verifying the absence of content, often used to check initial states or states after clearing operations.</p>
<p><strong>The Power of <code>not</code>:</strong>
As seen in some examples (e.g., <code>expect(locator).not_to_be_empty()</code>), you can prefix most Playwright assertions with <code>.not</code> to check for the opposite condition. This provides great flexibility:</p>
<ul>
<li><code>expect(locator).not_to_be_visible()</code></li>
<li><code>expect(locator).not_to_be_hidden()</code> (equivalent to <code>to_be_visible()</code>)</li>
<li><code>expect(locator).not_to_be_enabled()</code> (equivalent to <code>to_be_disabled()</code>)</li>
<li><code>expect(locator).not_to_be_disabled()</code> (equivalent to <code>to_be_enabled()</code>)</li>
<li><code>expect(locator).not_to_be_empty()</code></li>
</ul>
<p><strong>Implicit Waits - A Quick Reminder:</strong>
It's worth reiterating that all these <code>expect</code> assertions come with Playwright's auto-waiting mechanism. If an element is not immediately in the asserted state (e.g., not yet visible when <code>to_be_visible()</code> is called), Playwright doesn't fail instantly. Instead, it retries the check repeatedly for a configurable timeout period (typically a few seconds). This makes your tests much more resilient to minor timing variations in page rendering or JavaScript execution, a common source of flakiness in E2E tests.</p>
<p>These core assertions form the bedrock of verifying UI states in your Playwright tests. Mastering them will allow you to write expressive and reliable checks for a wide variety of conditions your application might present. In the next sections, we'll explore assertions for checking content, attributes, and more.</p>
<h2 id="122-content-assertions-to_have_text-to_contain_text-to_have_value-to_have_count" tabindex="-1"><a class="anchor" href="#122-content-assertions-to_have_text-to_contain_text-to_have_value-to_have_count" name="122-content-assertions-to_have_text-to_contain_text-to_have_value-to_have_count" tabindex="-1"><span class="octicon octicon-link"></span></a>12.2 Content Assertions: <code>to_have_text</code>, <code>to_contain_text</code>, <code>to_have_value</code>, <code>to_have_count</code></h2>
<p>Beyond knowing if an element is simply present or visible, a crucial aspect of testing web applications is verifying the <em>content</em> displayed to the user. Does the heading say what it should? Does a status message convey the correct information? Are form fields pre-filled correctly? Do lists display the expected number of items? Playwright's <code>expect</code> API provides a powerful set of assertions specifically designed for these content verification tasks.</p>
<p>These assertions, like others in Playwright, come with built-in auto-waiting. This means Playwright will intelligently retry the assertion for a configurable period (defaulting to 5 seconds) if the condition isn't immediately met. This handles situations where content might be loaded dynamically, making your tests more resilient.</p>
<p>In this section, we'll explore four fundamental content assertions:</p>
<ul>
<li><code>to_have_text()</code>: For checking if an element contains <em>exact</em> text.</li>
<li><code>to_contain_text()</code>: For checking if an element contains a <em>substring</em> of text.</li>
<li><code>to_have_value()</code>: For checking the current value of form input elements.</li>
<li><code>to_have_count()</code>: For checking how many elements match a given locator.</li>
</ul>
<p>Understanding these assertions will significantly enhance your ability to write expressive and reliable tests that confirm your application is presenting the correct information to your users.</p>
<h3 id="1221-expectto_have_text-verifying-exact-text-content" tabindex="-1"><a class="anchor" href="#1221-expectto_have_text-verifying-exact-text-content" name="1221-expectto_have_text-verifying-exact-text-content" tabindex="-1"><span class="octicon octicon-link"></span></a>12.2.1 <code>expect(...).to_have_text()</code>: Verifying Exact Text Content</h3>
<p>The <code>to_have_text()</code> assertion is your tool for verifying that an element, or a collection of elements, contains precisely the text you specify. This is a strict comparison; every character, including whitespace and case, must match.</p>
<p><strong>Why <code>to_have_text()</code>?</strong></p>
<p>You'd use <code>to_have_text()</code> when the exact wording and formatting of a piece of text are critical. This could be for:</p>
<ul>
<li>Important headings or titles.</li>
<li>Legal disclaimers or specific instructions.</li>
<li>Status messages where precision matters.</li>
<li>Ensuring that dynamically generated text matches an exact expected output.</li>
</ul>
<p>Its strictness ensures that even subtle, unintended changes in text content are caught.</p>
<p>Let's consider a simple HTML structure:</p>
<pre class="language-html" tabindex="0"><code class="language-html"><span class="token comment">&lt;!-- THIS_CODE_SNIPPET --&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Test Page<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>main-heading<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Welcome to Our Application!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>status-message<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>   Operation successful!   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user-greeting<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Hello, Alex<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>Now, let's write a Playwright test to verify the text of these elements.</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> Page<span class="token punctuation">,</span> expect

<span class="token keyword">def</span> <span class="token function">test_exact_text_content</span><span class="token punctuation">(</span>page<span class="token punctuation">:</span> Page<span class="token punctuation">)</span><span class="token punctuation">:</span>
    html_content <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
    &lt;!DOCTYPE html&gt;
    &lt;html&gt;
    &lt;head&gt;&lt;title&gt;Test Page&lt;/title&gt;&lt;/head&gt;
    &lt;body&gt;
      &lt;h1 id="main-heading"&gt;Welcome to Our Application!&lt;/h1&gt;
      &lt;p id="status-message"&gt;   Operation successful!   &lt;/p&gt;
      &lt;div id="user-greeting"&gt;Hello, Alex&lt;/div&gt;
      &lt;ul id="options"&gt;
        &lt;li&gt;View Profile&lt;/li&gt;
        &lt;li&gt;Settings&lt;/li&gt;
        &lt;li&gt;Logout&lt;/li&gt;
      &lt;/ul&gt;
    &lt;/body&gt;
    &lt;/html&gt;
    """</span>
    page<span class="token punctuation">.</span>set_content<span class="token punctuation">(</span>html_content<span class="token punctuation">)</span>

    <span class="token comment"># 1. Basic exact match</span>
    main_heading <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#main-heading"</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>main_heading<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_text<span class="token punctuation">(</span><span class="token string">"Welcome to Our Application!"</span><span class="token punctuation">)</span>

    <span class="token comment"># 2. Exact match including leading/trailing whitespace</span>
    status_message <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#status-message"</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>status_message<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_text<span class="token punctuation">(</span><span class="token string">"   Operation successful!   "</span><span class="token punctuation">)</span>

    <span class="token comment"># 3. Using a regular expression for more flexible exact matching</span>
    user_greeting <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#user-greeting"</span><span class="token punctuation">)</span>
    <span class="token keyword">import</span> re
    expect<span class="token punctuation">(</span>user_greeting<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_text<span class="token punctuation">(</span>re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r"Hello, \w+"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># 4. Matching an array of strings for a list (order matters)</span>
    options_list <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#options li"</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>options_list<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_text<span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token string">"View Profile"</span><span class="token punctuation">,</span>
        <span class="token string">"Settings"</span><span class="token punctuation">,</span>
        <span class="token string">"Logout"</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<p>Let's examine this code in detail:</p>
<ol>
<li>
<p><strong><code>html_content = """..."""</code> and <code>page.set_content(html_content)</code></strong>:</p>
<ul>
<li>For this standalone example, we define a string <code>html_content</code> containing the HTML structure we want to test against.</li>
<li><code>page.set_content(html_content)</code> tells Playwright to load this HTML directly into the current browser page. This is a convenient way to create a controlled environment for testing specific assertions without needing a running web server. In your Django projects, you'll typically use <code>page.goto(live_server.url + "/your-page/")</code>.</li>
</ul>
</li>
<li>
<p><strong><code>main_heading = page.locator("#main-heading")</code></strong>:</p>
<ul>
<li>We use <code>page.locator()</code> with a CSS selector <code>#main-heading</code> to get a <code>Locator</code> object representing the <code>&lt;h1&gt;</code> element. A <code>Locator</code> is Playwright's way to represent how to find an element (or elements) on the page. It doesn't fetch the element immediately but rather holds the recipe to find it when an action or assertion is performed.</li>
</ul>
</li>
<li>
<p><strong><code>expect(main_heading).to_have_text("Welcome to Our Application!")</code></strong>:</p>
<ul>
<li>This is the core assertion. <code>expect(main_heading)</code> initiates an assertion against the <code>main_heading</code> locator.</li>
<li><code>.to_have_text("Welcome to Our Application!")</code> checks if the <em>entire text content</em> of the element located by <code>main_heading</code> is <em>exactly</em> "Welcome to Our Application!".</li>
<li>This includes case sensitivity. If the page had "welcome to our application!", the test would fail.</li>
<li>Playwright will automatically wait for the element to appear and have this exact text, up to the configured timeout.</li>
</ul>
</li>
<li>
<p><strong><code>status_message = page.locator("#status-message")</code></strong> and <strong><code>expect(status_message).to_have_text("   Operation successful!   ")</code></strong>:</p>
<ul>
<li>This demonstrates the strictness regarding whitespace. The <code>status-message</code> paragraph in our HTML has leading and trailing spaces within its content.</li>
<li><code>to_have_text()</code> requires these spaces to be present in the expected string for the assertion to pass. If we had used <code>"Operation successful!"</code>, the test would fail.</li>
<li><strong>Why this strictness?</strong> It ensures that you are aware of and explicitly account for all parts of the text content, including formatting spaces that might affect layout or user perception. Sometimes, these spaces are intentional; other times, they might indicate a rendering issue.</li>
</ul>
</li>
<li>
<p><strong><code>user_greeting = page.locator("#user-greeting")</code></strong> and <strong><code>expect(user_greeting).to_have_text(re.compile(r"Hello, \w+"))</code></strong>:</p>
<ul>
<li><code>to_have_text()</code> can also accept a Python regular expression object (compiled using <code>re.compile()</code>).</li>
<li>The regex <code>r"Hello, \w+"</code> matches the string "Hello, " followed by one or more word characters (letters, numbers, or underscore). This is useful when parts of the text are dynamic (like a username) but follow a known pattern.</li>
<li>Even when using a regex, <code>to_have_text()</code> still expects the <em>entire</em> content of the element to match the pattern. It's not a "find substring" operation when a regex is used in this context.</li>
</ul>
</li>
<li>
<p><strong><code>options_list = page.locator("#options li")</code></strong> and <strong><code>expect(options_list).to_have_text(["View Profile", "Settings", "Logout"])</code></strong>:</p>
<ul>
<li>When a locator can resolve to multiple elements (like <code>#options li</code> which matches all list items), <code>to_have_text()</code> can accept a list of strings.</li>
<li>In this mode, it asserts that the locator finds exactly that many elements, and that the text content of each element, in order, matches the corresponding string in the list.</li>
<li>If the number of <code>&lt;li&gt;</code> elements were different, or if their text content or order didn't match, the assertion would fail. This is powerful for verifying the content and order of lists, navigation menus, etc.</li>
</ul>
</li>
</ol>
<p><strong>Common Pitfalls and Considerations for <code>to_have_text()</code>:</strong></p>
<ul>
<li><strong>Whitespace Sensitivity:</strong> Always be mindful of leading/trailing spaces or multiple spaces within the text. What you see rendered in a browser might not be the exact <code>textContent</code>. Use browser developer tools to inspect the actual text content if unsure.</li>
<li><strong>Hidden Elements:</strong> <code>to_have_text()</code> generally operates on the text content of elements regardless of their visibility, though Playwright's actionability rules might prevent interaction if the element is truly non-interactive. If you need to assert text on a <em>visible</em> element, combine it with <code>to_be_visible()</code>: <code>expect(locator).to_be_visible()</code> followed by <code>expect(locator).to_have_text(...)</code>.</li>
<li><strong>Normalization:</strong> Browsers might normalize whitespace in certain contexts. <code>to_have_text()</code> compares against the element's <code>textContent</code> property, which usually reflects this normalized version.</li>
</ul>
<p><code>to_have_text()</code> is a precise tool. When you need that precision, it's invaluable. However, for situations where you only care about the presence of certain keywords or phrases within a larger block of text, its strictness can lead to brittle tests. That's where <code>to_contain_text()</code> comes in.</p>
<h3 id="1222-expectto_contain_text-verifying-partial-text-content" tabindex="-1"><a class="anchor" href="#1222-expectto_contain_text-verifying-partial-text-content" name="1222-expectto_contain_text-verifying-partial-text-content" tabindex="-1"><span class="octicon octicon-link"></span></a>12.2.2 <code>expect(...).to_contain_text()</code>: Verifying Partial Text Content</h3>
<p>The <code>to_contain_text()</code> assertion offers more flexibility than <code>to_have_text()</code>. It checks if an element's text content <em>includes</em> the specified string or strings as a substring. The entire text content does not need to match.</p>
<p><strong>Why <code>to_contain_text()</code>?</strong></p>
<p>This assertion is ideal when:</p>
<ul>
<li>You only need to verify the presence of a keyword or key phrase within a larger text block (e.g., a paragraph, an article).</li>
<li>The surrounding text might change, but a specific part should remain constant.</li>
<li>You want to make your tests less sensitive to minor changes in wording or whitespace that don't affect the core message.</li>
</ul>
<p>Let's use a slightly modified HTML:</p>
<pre class="language-html" tabindex="0"><code class="language-html"><span class="token comment">&lt;!-- THIS_CODE_SNIPPET --&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Test Page<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>description<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>This application provides robust features for all users.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>notification<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Info: Your request is being processed. Please wait.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>feature-list<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>Core Feature A<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>Essential Feature B<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>Advanced Feature C<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>And the corresponding Playwright test:</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> Page<span class="token punctuation">,</span> expect
<span class="token keyword">import</span> re

<span class="token keyword">def</span> <span class="token function">test_partial_text_content</span><span class="token punctuation">(</span>page<span class="token punctuation">:</span> Page<span class="token punctuation">)</span><span class="token punctuation">:</span>
    html_content <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
    &lt;!DOCTYPE html&gt;
    &lt;html&gt;
    &lt;head&gt;&lt;title&gt;Test Page&lt;/title&gt;&lt;/head&gt;
    &lt;body&gt;
      &lt;p id="description"&gt;This application provides robust features for all users.&lt;/p&gt;
      &lt;div id="notification"&gt;Info: Your request is being processed. Please wait.&lt;/div&gt;
      &lt;ul id="feature-list"&gt;
        &lt;li&gt;Core Feature A&lt;/li&gt;
        &lt;li&gt;Essential Feature B&lt;/li&gt;
        &lt;li&gt;Advanced Feature C&lt;/li&gt;
      &lt;/ul&gt;
    &lt;/body&gt;
    &lt;/html&gt;
    """</span>
    page<span class="token punctuation">.</span>set_content<span class="token punctuation">(</span>html_content<span class="token punctuation">)</span>

    <span class="token comment"># 1. Basic substring match</span>
    description <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#description"</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>description<span class="token punctuation">)</span><span class="token punctuation">.</span>to_contain_text<span class="token punctuation">(</span><span class="token string">"robust features"</span><span class="token punctuation">)</span>

    <span class="token comment"># 2. Substring match is case-sensitive by default</span>
    notification <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#notification"</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>notification<span class="token punctuation">)</span><span class="token punctuation">.</span>to_contain_text<span class="token punctuation">(</span><span class="token string">"request is being processed"</span><span class="token punctuation">)</span>
    <span class="token comment"># This would fail: expect(notification).to_contain_text("Request Is Being Processed")</span>

    <span class="token comment"># 3. Using ignore_case option</span>
    expect<span class="token punctuation">(</span>notification<span class="token punctuation">)</span><span class="token punctuation">.</span>to_contain_text<span class="token punctuation">(</span><span class="token string">"Request Is Being Processed"</span><span class="token punctuation">,</span> ignore_case<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token comment"># 4. Using a regular expression</span>
    <span class="token comment"># This will find "Info:" at the beginning of the text</span>
    expect<span class="token punctuation">(</span>notification<span class="token punctuation">)</span><span class="token punctuation">.</span>to_contain_text<span class="token punctuation">(</span>re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r"^Info:"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># This will find "Please wait." at the end of the text</span>
    expect<span class="token punctuation">(</span>notification<span class="token punctuation">)</span><span class="token punctuation">.</span>to_contain_text<span class="token punctuation">(</span>re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r"Please wait\.$"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


    <span class="token comment"># 5. Matching an array of substrings (any element can contain any of the substrings)</span>
    <span class="token comment"># This is different from to_have_text which expects each element to match one string in order.</span>
    <span class="token comment"># For to_contain_text with a list, it checks that the locator matches at least one element,</span>
    <span class="token comment"># and *each* of those matched elements contains *all* of the provided substrings.</span>
    <span class="token comment"># This might be less common. More typically, you'd assert on individual elements or use a loop.</span>

    <span class="token comment"># A more common scenario for lists is checking if *each* item contains *some* text,</span>
    <span class="token comment"># or if a list of elements *collectively* contains certain texts.</span>
    <span class="token comment"># Let's refine this example for clarity on how it works with multiple elements.</span>
    <span class="token comment"># If the locator matches multiple elements, each element must contain the text.</span>
    feature_items <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#feature-list li"</span><span class="token punctuation">)</span> <span class="token comment"># Matches 3 &lt;li&gt; elements</span>
    <span class="token comment"># The following asserts that *each* &lt;li&gt; contains the word "Feature"</span>
    expect<span class="token punctuation">(</span>feature_items<span class="token punctuation">)</span><span class="token punctuation">.</span>to_contain_text<span class="token punctuation">(</span><span class="token string">"Feature"</span><span class="token punctuation">)</span>

    <span class="token comment"># If you provide a list of texts to to_contain_text, e.g., expect(locator).to_contain_text(["text1", "text2"]),</span>
    <span class="token comment"># it means the element(s) matched by locator must contain "text1" AND "text2".</span>
    <span class="token comment"># For example, to check if the notification contains both "Info" and "wait":</span>
    expect<span class="token punctuation">(</span>notification<span class="token punctuation">)</span><span class="token punctuation">.</span>to_contain_text<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Info"</span><span class="token punctuation">,</span> <span class="token string">"wait"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token comment"># If you want to check that a list of elements contains a list of corresponding substrings,</span>
    <span class="token comment"># you would typically iterate or use more specific locators.</span>
    <span class="token comment"># For example, to check the first list item:</span>
    first_feature <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#feature-list li"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first
    expect<span class="token punctuation">(</span>first_feature<span class="token punctuation">)</span><span class="token punctuation">.</span>to_contain_text<span class="token punctuation">(</span><span class="token string">"Core Feature"</span><span class="token punctuation">)</span>
</code></pre>
<p>Let's break down these examples:</p>
<ol>
<li>
<p><strong><code>description = page.locator("#description")</code></strong> and <strong><code>expect(description).to_contain_text("robust features")</code></strong>:</p>
<ul>
<li>We locate the paragraph with <code>id="description"</code>.</li>
<li><code>.to_contain_text("robust features")</code> asserts that the text content of this paragraph includes the substring "robust features". The full text is "This application provides robust features for all users.", so this assertion passes.</li>
<li>This is less brittle than <code>to_have_text()</code>. If the text changed to "This amazing application provides robust features for all our users.", this assertion would still pass, while an equivalent <code>to_have_text()</code> would fail.</li>
</ul>
</li>
<li>
<p><strong><code>notification = page.locator("#notification")</code></strong> and <strong><code>expect(notification).to_contain_text("request is being processed")</code></strong>:</p>
<ul>
<li>This demonstrates that, by default, <code>to_contain_text()</code> is case-sensitive. The expected substring "request is being processed" matches a part of "Info: Your request is being processed. Please wait."</li>
</ul>
</li>
<li>
<p><strong><code>expect(notification).to_contain_text("Request Is Being Processed", ignore_case=True)</code></strong>:</p>
<ul>
<li><code>to_contain_text()</code> accepts an optional <code>ignore_case=True</code> argument. When provided, the comparison disregards case differences. So, "Request Is Being Processed" will successfully match "request is being processed" within the element's text.</li>
<li><strong>Why this option?</strong> It's useful when the casing isn't critical or might vary, allowing for more resilient tests.</li>
</ul>
</li>
<li>
<p><strong><code>expect(notification).to_contain_text(re.compile(r"^Info:"))</code></strong> and <strong><code>expect(notification).to_contain_text(re.compile(r"Please wait\.$"))</code></strong>:</p>
<ul>
<li>Like <code>to_have_text()</code>, <code>to_contain_text()</code> can also accept a regular expression.</li>
<li><code>re.compile(r"^Info:")</code> checks if the element's text content contains a match for the regex <code>^Info:</code>, which means "Info:" at the beginning of the text.</li>
<li><code>re.compile(r"Please wait\.$")</code> checks if the element's text content contains a match for <code>Please wait.</code> at the end of the text (<code>\.</code> matches a literal dot, <code>$</code> matches the end of the string/line depending on regex flags).</li>
<li>When using a regex with <code>to_contain_text()</code>, the regex only needs to find a match <em>somewhere</em> within the element's text, not match the entire text.</li>
</ul>
</li>
<li>
<p><strong><code>feature_items = page.locator("#feature-list li")</code></strong> and <strong><code>expect(feature_items).to_contain_text("Feature")</code></strong>:</p>
<ul>
<li>Here, <code>feature_items</code> is a locator that can match multiple elements (the three <code>&lt;li&gt;</code> items).</li>
<li>When <code>to_contain_text()</code> is used with a locator matching multiple elements and a single string, it asserts that <em>every element</em> matched by the locator contains that string. In this case, all three list items ("Core Feature A", "Essential Feature B", "Advanced Feature C") contain the word "Feature", so the assertion passes.</li>
</ul>
</li>
<li>
<p><strong><code>expect(notification).to_contain_text(["Info", "wait"])</code></strong>:</p>
<ul>
<li>If you pass a list of strings to <code>to_contain_text()</code> for a single element locator, it asserts that the element's text content contains <em>all</em> of those substrings. The order doesn't matter, but all must be present. So, the <code>notification</code> div must contain both "Info" and "wait".</li>
</ul>
</li>
</ol>
<p><strong><code>to_have_text()</code> vs. <code>to_contain_text()</code> - The Core Difference:</strong></p>
<ul>
<li><strong><code>to_have_text()</code></strong>: "Is this element's text <em>exactly</em> this?" (Strict equality)
<ul>
<li>Use for titles, labels, critical messages where every character matters.</li>
</ul>
</li>
<li><strong><code>to_contain_text()</code></strong>: "Does this element's text <em>include</em> this?" (Substring check)
<ul>
<li>Use for paragraphs, descriptions, or when only keywords are important, allowing for more flexibility.</li>
</ul>
</li>
</ul>
<p>Choosing the right one depends on the specific requirement of your test and how much variability you expect or can tolerate in the text. Often, <code>to_contain_text()</code> leads to more robust tests when exact phrasing isn't paramount.</p>
<h3 id="1223-expectto_have_value-checking-form-element-values" tabindex="-1"><a class="anchor" href="#1223-expectto_have_value-checking-form-element-values" name="1223-expectto_have_value-checking-form-element-values" tabindex="-1"><span class="octicon octicon-link"></span></a>12.2.3 <code>expect(...).to_have_value()</code>: Checking Form Element Values</h3>
<p>Web pages often contain form elements like <code>&lt;input&gt;</code>, <code>&lt;textarea&gt;</code>, and <code>&lt;select&gt;</code>. The <code>to_have_value()</code> assertion is specifically designed to check the current <em>value</em> of these elements. This is distinct from their text content (e.g., for a <code>&lt;select&gt;</code> option, the text displayed to the user vs. its <code>value</code> attribute).</p>
<p><strong>Why <code>to_have_value()</code>?</strong></p>
<p>This assertion is essential for:</p>
<ul>
<li>Verifying default values in form fields when a page loads.</li>
<li>Checking if a form field's value updates correctly after user input (simulated via Playwright actions like <code>.fill()</code>).</li>
<li>Ensuring that data submitted or retrieved is correctly reflected in input controls.</li>
</ul>
<p>Consider this HTML form snippet:</p>
<pre class="language-html" tabindex="0"><code class="language-html"><span class="token comment">&lt;!-- THIS_CODE_SNIPPET --&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Form Test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>initial_user<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>number<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>quantity<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bio<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>A short bio here.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>country<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Select a country<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>US<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>United States<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>CA<span class="token punctuation">"</span></span> <span class="token attr-name">selected</span><span class="token punctuation">&gt;</span></span>Canada<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>Here's how you'd test their values using Playwright:</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> Page<span class="token punctuation">,</span> expect
<span class="token keyword">import</span> re

<span class="token keyword">def</span> <span class="token function">test_form_element_values</span><span class="token punctuation">(</span>page<span class="token punctuation">:</span> Page<span class="token punctuation">)</span><span class="token punctuation">:</span>
    html_content <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
    &lt;!DOCTYPE html&gt;
    &lt;html&gt;
    &lt;head&gt;&lt;title&gt;Form Test&lt;/title&gt;&lt;/head&gt;
    &lt;body&gt;
      &lt;input type="text" id="username" value="initial_user"&gt;
      &lt;input type="number" id="quantity" value="5"&gt;
      &lt;textarea id="bio"&gt;A short bio here.&lt;/textarea&gt;
      &lt;select id="country"&gt;
        &lt;option value=""&gt;Select a country&lt;/option&gt;
        &lt;option value="US"&gt;United States&lt;/option&gt;
        &lt;option value="CA" selected&gt;Canada&lt;/option&gt;
      &lt;/select&gt;
    &lt;/body&gt;
    &lt;/html&gt;
    """</span>
    page<span class="token punctuation">.</span>set_content<span class="token punctuation">(</span>html_content<span class="token punctuation">)</span>

    <span class="token comment"># 1. Check value of a text input</span>
    username_input <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#username"</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>username_input<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_value<span class="token punctuation">(</span><span class="token string">"initial_user"</span><span class="token punctuation">)</span>

    <span class="token comment"># 2. Check value of a number input</span>
    quantity_input <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#quantity"</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>quantity_input<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_value<span class="token punctuation">(</span><span class="token string">"5"</span><span class="token punctuation">)</span> <span class="token comment"># Values are typically strings</span>

    <span class="token comment"># 3. Check value of a textarea</span>
    <span class="token comment"># For textareas, .to_have_value() checks their content.</span>
    bio_textarea <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#bio"</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>bio_textarea<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_value<span class="token punctuation">(</span><span class="token string">"A short bio here."</span><span class="token punctuation">)</span>

    <span class="token comment"># 4. Check value of a select element (the value of the selected option)</span>
    country_select <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#country"</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>country_select<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_value<span class="token punctuation">(</span><span class="token string">"CA"</span><span class="token punctuation">)</span>

    <span class="token comment"># 5. Using a regular expression with to_have_value</span>
    expect<span class="token punctuation">(</span>username_input<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_value<span class="token punctuation">(</span>re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r"initial_\w+"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># Example of changing a value and then asserting</span>
    username_input<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token string">"new_user_123"</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>username_input<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_value<span class="token punctuation">(</span><span class="token string">"new_user_123"</span><span class="token punctuation">)</span>
</code></pre>
<p>Let's analyze the code:</p>
<ol>
<li>
<p><strong><code>username_input = page.locator("#username")</code></strong> and <strong><code>expect(username_input).to_have_value("initial_user")</code></strong>:</p>
<ul>
<li>We locate the text input field with <code>id="username"</code>.</li>
<li><code>.to_have_value("initial_user")</code> asserts that the <code>value</code> attribute/property of this input element is exactly "initial_user". This matches the <code>value="initial_user"</code> in the HTML.</li>
</ul>
</li>
<li>
<p><strong><code>quantity_input = page.locator("#quantity")</code></strong> and <strong><code>expect(quantity_input).to_have_value("5")</code></strong>:</p>
<ul>
<li>This targets an <code>&lt;input type="number"&gt;</code>.</li>
<li>Even though it's a number input, the <code>value</code> property in the DOM is typically a string. So, we assert against the string <code>"5"</code>.</li>
<li><strong>Mental Model:</strong> <code>to_have_value()</code> generally compares against the string representation of the element's current value.</li>
</ul>
</li>
<li>
<p><strong><code>bio_textarea = page.locator("#bio")</code></strong> and <strong><code>expect(bio_textarea).to_have_value("A short bio here.")</code></strong>:</p>
<ul>
<li>For <code>&lt;textarea&gt;</code> elements, their "value" is the text content between their opening and closing tags.</li>
<li><code>to_have_value()</code> correctly retrieves this content and compares it.</li>
</ul>
</li>
<li>
<p><strong><code>country_select = page.locator("#country")</code></strong> and <strong><code>expect(country_select).to_have_value("CA")</code></strong>:</p>
<ul>
<li>For <code>&lt;select&gt;</code> elements, <code>to_have_value()</code> asserts against the <code>value</code> attribute of the currently <em>selected</em> <code>&lt;option&gt;</code>.</li>
<li>In our HTML, the option "Canada" has <code>value="CA"</code> and is marked <code>selected</code>, so this assertion passes. If "United States" were selected, its value "US" would be expected.</li>
</ul>
</li>
<li>
<p><strong><code>expect(username_input).to_have_value(re.compile(r"initial_\w+"))</code></strong>:</p>
<ul>
<li>Similar to text assertions, <code>to_have_value()</code> can also accept a regular expression. This checks if the entire value of the input field matches the given pattern.</li>
<li>This is useful if the value has a predictable structure but some dynamic parts.</li>
</ul>
</li>
<li>
<p><strong><code>username_input.fill("new_user_123")</code></strong> and <strong><code>expect(username_input).to_have_value("new_user_123")</code></strong>:</p>
<ul>
<li>This pair demonstrates a common testing pattern: perform an action that changes a value (here, <code>fill()</code> types into the input field), and then use <code>to_have_value()</code> to assert that the value was updated correctly. This is fundamental to testing form interactivity.</li>
</ul>
</li>
</ol>
<p><strong>Key Considerations for <code>to_have_value()</code>:</strong></p>
<ul>
<li><strong>Specificity:</strong> It's designed for elements that have a <code>value</code> property that represents their current state, primarily form controls. Using it on a <code>&lt;div&gt;</code> or <code>&lt;p&gt;</code> would generally not make sense and might lead to errors or unexpected behavior, as they don't inherently have a "value" in the same way inputs do.</li>
<li><strong>String Comparison:</strong> Remember that values are usually treated as strings, even for <code>type="number"</code> inputs, when using this assertion.</li>
</ul>
<p><code>to_have_value()</code> is indispensable for ensuring your forms behave as expected, both in their initial state and after user interactions.</p>
<h3 id="1224-expectto_have_count-counting-matched-elements" tabindex="-1"><a class="anchor" href="#1224-expectto_have_count-counting-matched-elements" name="1224-expectto_have_count-counting-matched-elements" tabindex="-1"><span class="octicon octicon-link"></span></a>12.2.4 <code>expect(...).to_have_count()</code>: Counting Matched Elements</h3>
<p>Sometimes, you don't need to check the specific content of elements, but rather how <em>many</em> of them appear on the page. The <code>to_have_count()</code> assertion is used with a locator to verify that it resolves to a specific number of elements.</p>
<p><strong>Why <code>to_have_count()</code>?</strong></p>
<p>This assertion is valuable for:</p>
<ul>
<li>Verifying the number of items in a list (e.g., search results, product listings, navigation links).</li>
<li>Ensuring that a certain number of error messages are displayed.</li>
<li>Confirming that filtering or dynamic content loading results in the correct quantity of elements.</li>
<li>Checking if an element is unique (by asserting a count of 1) or if no such elements exist (count of 0).</li>
</ul>
<p>Let's use an HTML structure with a list and some repeated elements:</p>
<pre class="language-html" tabindex="0"><code class="language-html"><span class="token comment">&lt;!-- THIS_CODE_SNIPPET --&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Count Test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>task-list<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>Task 1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>Task 2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>Task 3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>error-message<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Invalid input.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>error-message<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Field is required.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>action-button<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Submit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>action-button<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Cancel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>action-button<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Reset<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>And the Playwright test to count these elements:</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> Page<span class="token punctuation">,</span> expect

<span class="token keyword">def</span> <span class="token function">test_element_counts</span><span class="token punctuation">(</span>page<span class="token punctuation">:</span> Page<span class="token punctuation">)</span><span class="token punctuation">:</span>
    html_content <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
    &lt;!DOCTYPE html&gt;
    &lt;html&gt;
    &lt;head&gt;&lt;title&gt;Count Test&lt;/title&gt;&lt;/head&gt;
    &lt;body&gt;
      &lt;ul id="task-list"&gt;
        &lt;li&gt;Task 1&lt;/li&gt;
        &lt;li&gt;Task 2&lt;/li&gt;
        &lt;li&gt;Task 3&lt;/li&gt;
      &lt;/ul&gt;
      &lt;div class="error-message"&gt;Invalid input.&lt;/div&gt;
      &lt;div class="error-message"&gt;Field is required.&lt;/div&gt;
      &lt;button class="action-button"&gt;Submit&lt;/button&gt;
      &lt;button class="action-button"&gt;Cancel&lt;/button&gt;
      &lt;button class="action-button"&gt;Reset&lt;/button&gt;
      &lt;div id="empty-container"&gt;&lt;/div&gt;
    &lt;/body&gt;
    &lt;/html&gt;
    """</span>
    page<span class="token punctuation">.</span>set_content<span class="token punctuation">(</span>html_content<span class="token punctuation">)</span>

    <span class="token comment"># 1. Count list items</span>
    list_items <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#task-list li"</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>list_items<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_count<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>

    <span class="token comment"># 2. Count elements by class name</span>
    error_messages <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">".error-message"</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>error_messages<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_count<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

    <span class="token comment"># 3. Count buttons with a specific class</span>
    action_buttons <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"button.action-button"</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>action_buttons<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_count<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>

    <span class="token comment"># 4. Asserting that no elements match a locator</span>
    non_existent_elements <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">".non-existent-class"</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>non_existent_elements<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_count<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token comment"># 5. Asserting an element is unique (count of 1)</span>
    task_list_container <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#task-list"</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>task_list_container<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_count<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token comment"># 6. Asserting a container has no children of a certain type</span>
    empty_container_children <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#empty-container &gt; *"</span><span class="token punctuation">)</span> <span class="token comment"># Selects all direct children</span>
    expect<span class="token punctuation">(</span>empty_container_children<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_count<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre>
<p>Let's dissect this code:</p>
<ol>
<li>
<p><strong><code>list_items = page.locator("#task-list li")</code></strong> and <strong><code>expect(list_items).to_have_count(3)</code></strong>:</p>
<ul>
<li>The locator <code>"#task-list li"</code> targets all <code>&lt;li&gt;</code> elements within the <code>&lt;ul&gt;</code> having <code>id="task-list"</code>.</li>
<li><code>.to_have_count(3)</code> asserts that this locator resolves to exactly 3 elements. Our HTML has three such list items, so this passes.</li>
<li><strong>Why this is useful:</strong> Imagine a to-do list application. After adding or deleting items, you'd use <code>to_have_count()</code> to verify the list updates correctly.</li>
</ul>
</li>
<li>
<p><strong><code>error_messages = page.locator(".error-message")</code></strong> and <strong><code>expect(error_messages).to_have_count(2)</code></strong>:</p>
<ul>
<li>The locator <code>".error-message"</code> targets all elements with the class <code>error-message</code>.</li>
<li>We assert that there are 2 such elements, matching our HTML.</li>
<li><strong>Practical Application:</strong> When testing form validation, you might expect a certain number of error messages to appear if multiple fields are invalid.</li>
</ul>
</li>
<li>
<p><strong><code>action_buttons = page.locator("button.action-button")</code></strong> and <strong><code>expect(action_buttons).to_have_count(3)</code></strong>:</p>
<ul>
<li>The locator <code>"button.action-button"</code> targets <code>&lt;button&gt;</code> elements that also have the class <code>action-button</code>.</li>
<li>This confirms there are 3 such buttons.</li>
</ul>
</li>
<li>
<p><strong><code>non_existent_elements = page.locator(".non-existent-class")</code></strong> and <strong><code>expect(non_existent_elements).to_have_count(0)</code></strong>:</p>
<ul>
<li>This demonstrates how to assert that <em>no elements</em> match a given locator.</li>
<li>This is useful for verifying that, for example, error messages disappear after correct input, or that certain UI elements are not rendered under specific conditions.</li>
</ul>
</li>
<li>
<p><strong><code>task_list_container = page.locator("#task-list")</code></strong> and <strong><code>expect(task_list_container).to_have_count(1)</code></strong>:</p>
<ul>
<li>While you might use <code>expect(locator).to_be_visible()</code> to check for a single element's presence, <code>to_have_count(1)</code> can also serve to ensure an element expected to be unique (like one identified by an ID) is indeed singular. If, due to a bug, multiple elements had the same ID <code>task-list</code>, this assertion would fail, highlighting the issue.</li>
</ul>
</li>
<li>
<p><strong><code>empty_container_children = page.locator("#empty-container &gt; *")</code></strong> and <strong><code>expect(empty_container_children).to_have_count(0)</code></strong>:</p>
<ul>
<li>The locator <code>"#empty-container &gt; *"</code> uses the child combinator <code>&gt;</code> to select all direct children of the element with <code>id="empty-container"</code>.</li>
<li>Asserting a count of 0 verifies that this container is indeed empty, which can be important for testing scenarios where content is dynamically added or removed.</li>
</ul>
</li>
</ol>
<p><strong>When to Use <code>to_have_count()</code>:</strong></p>
<ul>
<li>Any time the <em>quantity</em> of elements is a significant aspect of the expected state.</li>
<li>For lists, tables, search results, pagination, error messages, or dynamically generated content.</li>
<li>It provides a clear, declarative way to express expectations about the number of elements.</li>
</ul>
<p><strong>Summary of Content Assertions</strong></p>
<p>The content assertions we've covered (<code>to_have_text</code>, <code>to_contain_text</code>, <code>to_have_value</code>, <code>to_have_count</code>) are fundamental tools in your Playwright testing toolkit.</p>
<ul>
<li>Use <strong><code>to_have_text()</code></strong> for exact string matches where precision is key.</li>
<li>Opt for <strong><code>to_contain_text()</code></strong> when partial matches are sufficient, leading to more resilient tests against minor textual changes.</li>
<li>Rely on <strong><code>to_have_value()</code></strong> to verify the state of form input elements.</li>
<li>Employ <strong><code>to_have_count()</code></strong> to ensure the correct number of elements appear on the page.</li>
</ul>
<p>By mastering these assertions, you can write tests that thoroughly validate not just the structure and visibility of your web pages, but also the critical information they present to your users, leading to higher confidence in your application's correctness. Remember that Playwright's auto-waiting is always working behind the scenes with <code>expect</code>, making these assertions robust against minor loading delays.</p>
<h3 id="123-attributecss-assertions-to_have_attribute-to_have_css" tabindex="-1"><a class="anchor" href="#123-attributecss-assertions-to_have_attribute-to_have_css" name="123-attributecss-assertions-to_have_attribute-to_have_css" tabindex="-1"><span class="octicon octicon-link"></span></a>12.3 Attribute/CSS Assertions: <code>to_have_attribute</code>, <code>to_have_css</code></h3>
<p>In our journey to thoroughly validate web page elements, we often need to look beyond just their visibility or textual content. The underlying HTML attributes and applied CSS styles play a crucial role in an element's behavior, appearance, and accessibility. Playwright provides powerful assertions, <code>to_have_attribute</code> and <code>to_have_css</code>, allowing us to inspect these finer details with precision. These assertions are indispensable when testing dynamic UI changes, ensuring accessibility standards are met, or verifying that specific styling rules, critical for user experience, are correctly applied.</p>
<h4 id="1231-verifying-html-attributes-with-to_have_attribute" tabindex="-1"><a class="anchor" href="#1231-verifying-html-attributes-with-to_have_attribute" name="1231-verifying-html-attributes-with-to_have_attribute" tabindex="-1"><span class="octicon octicon-link"></span></a>12.3.1 Verifying HTML Attributes with <code>to_have_attribute</code></h4>
<p>HTML attributes are the keywords within an opening tag that define the characteristics or behavior of an HTML element. Examples include <code>id</code>, <code>class</code>, <code>href</code> (for links), <code>src</code> (for images/scripts), <code>disabled</code> (for form elements), <code>value</code> (for inputs), and various <code>aria-*</code> attributes for accessibility. Testing these attributes ensures that elements are configured correctly for their intended purpose.</p>
<p><strong>The <code>to_have_attribute</code> Assertion</strong></p>
<p>The <code>expect(locator).to_have_attribute()</code> assertion checks if the selected element possesses a specific HTML attribute, and optionally, if that attribute has a particular value.</p>
<p><strong>Syntax:</strong>
<code>expect(locator).to_have_attribute(name: str, value: Union[str, Pattern], *, timeout: Optional[float] = None)</code></p>
<ul>
<li><code>locator</code>: The Playwright locator for the target element.</li>
<li><code>name</code>: A string representing the name of the HTML attribute you want to check (e.g., <code>"href"</code>, <code>"disabled"</code>, <code>"aria-valuenow"</code>). This is case-sensitive, matching the attribute name as it appears in the DOM.</li>
<li><code>value</code>: An optional argument.
<ul>
<li>If provided as a string, the assertion checks if the attribute's value exactly matches this string.</li>
<li>If provided as a regular expression pattern (<code>re.Pattern</code>), the assertion checks if the attribute's value matches the pattern.</li>
<li>If this <code>value</code> argument is <em>omitted entirely</em>, the assertion simply checks for the <em>presence</em> of the attribute, regardless of its value.</li>
</ul>
</li>
<li><code>timeout</code>: An optional timeout in milliseconds. If the assertion doesn't pass within this time, it will fail. This overrides the default timeout.</li>
</ul>
<p>Let's explore some practical examples.</p>
<p><strong>Example 1: Checking a link's <code>href</code> attribute</strong></p>
<p>Imagine you have a link on your page, and you want to ensure it points to the correct URL.</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token keyword">import</span> re
<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> Page<span class="token punctuation">,</span> expect

<span class="token keyword">def</span> <span class="token function">test_link_attributes</span><span class="token punctuation">(</span>page<span class="token punctuation">:</span> Page<span class="token punctuation">)</span><span class="token punctuation">:</span>
    page<span class="token punctuation">.</span>set_content<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""
        &lt;a href="/expected/path" id="my-link"&gt;Click me&lt;/a&gt;
        &lt;a id="another-link"&gt;No href here&lt;/a&gt;
        &lt;input type="text" id="my-input" value="Initial Value" disabled&gt;
        &lt;button id="my-button" aria-label="Submit Form"&gt;Submit&lt;/button&gt;
    """</span><span class="token punctuation">)</span>

    <span class="token comment"># 1. Check for specific href value</span>
    link_locator <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#my-link"</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>link_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_attribute<span class="token punctuation">(</span><span class="token string">"href"</span><span class="token punctuation">,</span> <span class="token string">"/expected/path"</span><span class="token punctuation">)</span>

    <span class="token comment"># 2. Check for the presence of an attribute (value doesn't matter)</span>
    button_locator <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#my-button"</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>button_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_attribute<span class="token punctuation">(</span><span class="token string">"aria-label"</span><span class="token punctuation">)</span> <span class="token comment"># Checks that aria-label exists</span>

    <span class="token comment"># 3. Check for an attribute with a value using a regular expression</span>
    expect<span class="token punctuation">(</span>button_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_attribute<span class="token punctuation">(</span><span class="token string">"aria-label"</span><span class="token punctuation">,</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r"Submit\s+Form"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># 4. Check if an input is disabled</span>
    input_locator <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#my-input"</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>input_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_attribute<span class="token punctuation">(</span><span class="token string">"disabled"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token comment"># For boolean attributes like 'disabled',</span>
                                                          <span class="token comment"># their presence means true. The value is often an empty string.</span>
                                                          <span class="token comment"># Alternatively, just check for presence:</span>
    expect<span class="token punctuation">(</span>input_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_attribute<span class="token punctuation">(</span><span class="token string">"disabled"</span><span class="token punctuation">)</span>

    <span class="token comment"># 5. Check that an attribute is NOT present</span>
    another_link_locator <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#another-link"</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>another_link_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>not_to_have_attribute<span class="token punctuation">(</span><span class="token string">"href"</span><span class="token punctuation">)</span>
</code></pre>
<p>Let's examine this code in detail:</p>
<ol>
<li>
<p><strong><code>page.set_content(...)</code></strong>:</p>
<ul>
<li>For these examples, we're using <code>page.set_content()</code> to create a simple HTML structure directly in the browser. This allows us to focus purely on the assertion mechanism without needing a running Django server for these specific attribute checks. In real E2E tests, you'd use <code>page.goto(live_server.url + "/your-page/")</code>.</li>
<li>We've defined a link (<code>&lt;a&gt;</code>), an input (<code>&lt;input&gt;</code>), and a button (<code>&lt;button&gt;</code>) with various attributes.</li>
</ul>
</li>
<li>
<p><strong><code>link_locator = page.locator("#my-link")</code></strong>:</p>
<ul>
<li>We first get a locator for the element we want to inspect, in this case, the <code>&lt;a&gt;</code> tag with <code>id="my-link"</code>.</li>
</ul>
</li>
<li>
<p><strong><code>expect(link_locator).to_have_attribute("href", "/expected/path")</code></strong>:</p>
<ul>
<li>This is the core assertion. We're telling Playwright to:
<ul>
<li>Find the element identified by <code>link_locator</code>.</li>
<li>Check if it has an attribute named <code>"href"</code>.</li>
<li>If it does, verify that the value of this <code>"href"</code> attribute is exactly <code>"/expected/path"</code>.</li>
</ul>
</li>
<li>This is fundamental for testing navigation links, ensuring users are directed to the correct locations.</li>
</ul>
</li>
<li>
<p><strong><code>expect(button_locator).to_have_attribute("aria-label")</code></strong>:</p>
<ul>
<li>Here, we locate the button with <code>id="my-button"</code>.</li>
<li>By calling <code>to_have_attribute</code> with only the attribute name (<code>"aria-label"</code>) and <em>omitting</em> the <code>value</code> argument, we assert that the <code>aria-label</code> attribute <em>exists</em> on the button. We are not concerned with its specific value in this assertion, only its presence, which is often crucial for accessibility.</li>
</ul>
</li>
<li>
<p><strong><code>expect(button_locator).to_have_attribute("aria-label", re.compile(r"Submit\s+Form"))</code></strong>:</p>
<ul>
<li>This demonstrates using a regular expression for the attribute value.</li>
<li><code>re.compile(r"Submit\s+Form")</code> creates a regex pattern that matches "Submit", followed by one or more whitespace characters (<code>\s+</code>), followed by "Form". This is useful if the exact spacing or casing might vary slightly but the core text is important.</li>
</ul>
</li>
<li>
<p><strong><code>expect(input_locator).to_have_attribute("disabled", "")</code> and <code>expect(input_locator).to_have_attribute("disabled")</code></strong>:</p>
<ul>
<li>Boolean attributes in HTML (like <code>disabled</code>, <code>checked</code>, <code>readonly</code>) are considered <code>true</code> if present, and <code>false</code> if absent. Their value, if specified in HTML, is often the attribute name itself (e.g., <code>&lt;input disabled="disabled"&gt;</code>) or an empty string (<code>&lt;input disabled&gt;</code>). When inspected via the DOM, the value of a present boolean attribute like <code>disabled</code> is typically an empty string.</li>
<li>So, <code>to_have_attribute("disabled", "")</code> checks that the attribute is present and its DOM value is an empty string.</li>
<li>More simply, <code>to_have_attribute("disabled")</code> just checks for the presence of the <code>disabled</code> attribute, which is usually sufficient for boolean attributes.</li>
<li>This is vital for testing form field states, ensuring users cannot interact with elements that should be inactive.</li>
</ul>
</li>
<li>
<p><strong><code>expect(another_link_locator).not_to_have_attribute("href")</code></strong>:</p>
<ul>
<li>The <code>.not</code> modifier can be chained before any assertion to check for the opposite condition.</li>
<li>Here, we assert that the element with <code>id="another-link"</code> <em>does not</em> have an <code>href</code> attribute. This is useful for verifying that certain elements lack specific attributes as per design.</li>
</ul>
</li>
</ol>
<p><strong>Why <code>to_have_attribute</code> is Important:</strong></p>
<ul>
<li><strong>Testing Dynamic States:</strong> Many web applications change attributes dynamically using JavaScript. For example, a button might become <code>disabled</code> after being clicked, or an <code>aria-expanded</code> attribute might change when a dropdown is opened. <code>to_have_attribute</code> allows you to verify these state changes.</li>
<li><strong>Accessibility (A11y):</strong> <code>aria-*</code> attributes (<code>aria-label</code>, <code>aria-hidden</code>, <code>aria-required</code>, etc.) are critical for making web applications accessible to users with disabilities using assistive technologies. Testing for their presence and correct values is a key part of A11y testing.</li>
<li><strong>Data Attributes:</strong> Custom <code>data-*</code> attributes are often used to store extra information on elements, sometimes used by JavaScript. You can verify these too.</li>
<li><strong>Validating Configuration:</strong> Ensuring elements like images (<code>src</code>), scripts (<code>src</code>), and stylesheets (<code>href</code>) point to the correct resources.</li>
</ul>
<h4 id="1232-inspecting-css-properties-with-to_have_css" tabindex="-1"><a class="anchor" href="#1232-inspecting-css-properties-with-to_have_css" name="1232-inspecting-css-properties-with-to_have_css" tabindex="-1"><span class="octicon octicon-link"></span></a>12.3.2 Inspecting CSS Properties with <code>to_have_css</code></h4>
<p>CSS (Cascading Style Sheets) properties determine the visual presentation of HTML elements – their color, size, layout, and more. While end-to-end tests primarily focus on functionality, sometimes verifying specific CSS properties is necessary, especially when those styles indicate a state or are critical to the user experience.</p>
<p><strong>The <code>to_have_css</code> Assertion</strong></p>
<p>The <code>expect(locator).to_have_css()</code> assertion checks if the selected element has a specific CSS property set to a particular value. Importantly, Playwright checks against the <em>computed style</em> of the element. The computed style is the final, aggregated style that the browser applies to an element after considering all stylesheets, inline styles, and browser defaults.</p>
<p><strong>Syntax:</strong>
<code>expect(locator).to_have_css(name: str, value: Union[str, Pattern], *, timeout: Optional[float] = None)</code></p>
<ul>
<li><code>locator</code>: The Playwright locator for the target element.</li>
<li><code>name</code>: A string representing the name of the CSS property (e.g., <code>"color"</code>, <code>"background-color"</code>, <code>"display"</code>). Property names are typically hyphenated (kebab-case).</li>
<li><code>value</code>: The expected value of the CSS property.
<ul>
<li>Can be a string for an exact match (e.g., <code>"rgb(255, 0, 0)"</code> for red color).</li>
<li>Can be a regular expression pattern (<code>re.Pattern</code>) for more flexible matching.</li>
</ul>
</li>
<li><code>timeout</code>: An optional timeout in milliseconds.</li>
</ul>
<p>Let's see it in action.</p>
<p><strong>Example 2: Checking CSS properties like color and display</strong></p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token keyword">import</span> re
<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> Page<span class="token punctuation">,</span> expect

<span class="token keyword">def</span> <span class="token function">test_element_styles</span><span class="token punctuation">(</span>page<span class="token punctuation">:</span> Page<span class="token punctuation">)</span><span class="token punctuation">:</span>
    page<span class="token punctuation">.</span>set_content<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""
        &lt;style&gt;
            .error-message {
                color: red;
                background-color: #ffcccc; /* Light red */
                padding: 10px;
            }
            .hidden-element {
                display: none;
            }
            .styled-div {
                font-size: 16px;
                border: 1px solid rgb(0, 0, 0);
            }
        &lt;/style&gt;
        &lt;div id="error" class="error-message"&gt;Invalid input!&lt;/div&gt;
        &lt;div id="secret" class="hidden-element"&gt;You can't see me.&lt;/div&gt;
        &lt;div id="normal-div" class="styled-div"&gt;Some content.&lt;/div&gt;
    """</span><span class="token punctuation">)</span>

    <span class="token comment"># 1. Check the color of an error message</span>
    error_message_locator <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#error"</span><span class="token punctuation">)</span>
    <span class="token comment"># Note: Browsers compute 'red' as 'rgb(255, 0, 0)'</span>
    expect<span class="token punctuation">(</span>error_message_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_css<span class="token punctuation">(</span><span class="token string">"color"</span><span class="token punctuation">,</span> <span class="token string">"rgb(255, 0, 0)"</span><span class="token punctuation">)</span>

    <span class="token comment"># 2. Check the background-color using a hex value (often computed as rgb/rgba)</span>
    <span class="token comment"># The computed value for #ffcccc is rgb(255, 204, 204)</span>
    expect<span class="token punctuation">(</span>error_message_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_css<span class="token punctuation">(</span><span class="token string">"background-color"</span><span class="token punctuation">,</span> <span class="token string">"rgb(255, 204, 204)"</span><span class="token punctuation">)</span>

    <span class="token comment"># 3. Check the display property of a hidden element</span>
    hidden_element_locator <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#secret"</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>hidden_element_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_css<span class="token punctuation">(</span><span class="token string">"display"</span><span class="token punctuation">,</span> <span class="token string">"none"</span><span class="token punctuation">)</span>

    <span class="token comment"># 4. Check font-size (often computed with 'px')</span>
    styled_div_locator <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#normal-div"</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>styled_div_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_css<span class="token punctuation">(</span><span class="token string">"font-size"</span><span class="token punctuation">,</span> <span class="token string">"16px"</span><span class="token punctuation">)</span>

    <span class="token comment"># 5. Check border property (can be complex, regex might be better for parts)</span>
    <span class="token comment"># The 'border' shorthand is complex. It's often better to check individual border properties</span>
    <span class="token comment"># like 'border-top-width', 'border-left-style', 'border-bottom-color'.</span>
    <span class="token comment"># For 'border: 1px solid rgb(0, 0, 0)', we can check 'border-top-width':</span>
    expect<span class="token punctuation">(</span>styled_div_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_css<span class="token punctuation">(</span><span class="token string">"border-top-width"</span><span class="token punctuation">,</span> <span class="token string">"1px"</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>styled_div_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_css<span class="token punctuation">(</span><span class="token string">"border-left-style"</span><span class="token punctuation">,</span> <span class="token string">"solid"</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>styled_div_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_css<span class="token punctuation">(</span><span class="token string">"border-bottom-color"</span><span class="token punctuation">,</span> <span class="token string">"rgb(0, 0, 0)"</span><span class="token punctuation">)</span>

    <span class="token comment"># 6. Using regex for a CSS value (e.g., padding that might have slight variations or complex values)</span>
    expect<span class="token punctuation">(</span>error_message_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_css<span class="token punctuation">(</span><span class="token string">"padding"</span><span class="token punctuation">,</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r"10px"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># Simple case</span>
    <span class="token comment"># If padding was "10px 10px 10px 10px", this would still match if you only care about one part.</span>
    <span class="token comment"># For more complex padding like "10px 5px", you'd need a more specific regex or check individual paddings</span>
    <span class="token comment"># (padding-top, padding-right, etc.)</span>
</code></pre>
<p>Let's break down this styling example:</p>
<ol>
<li>
<p><strong><code>page.set_content(...)</code> with <code>&lt;style&gt;</code> block</strong>:</p>
<ul>
<li>We define some CSS rules within a <code>&lt;style&gt;</code> tag to apply to our HTML elements. This simulates styles coming from an external CSS file or embedded styles in a real application.</li>
<li>We have classes <code>.error-message</code>, <code>.hidden-element</code>, and <code>.styled-div</code> with distinct styles.</li>
</ul>
</li>
<li>
<p><strong><code>expect(error_message_locator).to_have_css("color", "rgb(255, 0, 0)")</code></strong>:</p>
<ul>
<li>We locate the <code>div</code> with <code>id="error"</code>.</li>
<li>We assert that its <code>color</code> CSS property has a computed value of <code>"rgb(255, 0, 0)"</code>.</li>
<li><strong>Crucial Point on Computed Values:</strong> Even if you define a color as <code>red</code> in your CSS, the browser computes this to its RGB equivalent. <code>to_have_css</code> checks against this <em>computed value</em>. You can find the computed value for an element using your browser's developer tools (usually in the "Computed" or "Styles" tab when an element is inspected). This is a common source of confusion; always check against the computed value.</li>
</ul>
</li>
<li>
<p><strong><code>expect(error_message_locator).to_have_css("background-color", "rgb(255, 204, 204)")</code></strong>:</p>
<ul>
<li>Similarly, the <code>background-color</code> set as <code>#ffcccc</code> is computed to <code>rgb(255, 204, 204)</code>.</li>
<li>This highlights the importance of knowing how browsers represent CSS values when they are computed.</li>
</ul>
</li>
<li>
<p><strong><code>expect(hidden_element_locator).to_have_css("display", "none")</code></strong>:</p>
<ul>
<li>This checks if the element with <code>id="secret"</code> has <code>display: none;</code>. This is a common way to hide elements and is often more robust to test than <code>to_be_hidden()</code> if you specifically care about the <code>display</code> property being the reason for invisibility. <code>to_be_hidden()</code> checks for various conditions that make an element not visible, while <code>to_have_css("display", "none")</code> is very specific.</li>
</ul>
</li>
<li>
<p><strong><code>expect(styled_div_locator).to_have_css("font-size", "16px")</code></strong>:</p>
<ul>
<li>Here, we verify the <code>font-size</code>. Even if set with relative units like <code>em</code> or <code>rem</code> in CSS, the computed value is often (but not always) in pixels (<code>px</code>). Again, check developer tools for the computed value.</li>
</ul>
</li>
<li>
<p><strong>Checking border properties</strong>:</p>
<ul>
<li>The <code>border</code> CSS property is a shorthand for multiple individual properties (<code>border-width</code>, <code>border-style</code>, <code>border-color</code>).</li>
<li>Asserting against the shorthand <code>border</code> property can be tricky because its computed value can be very complex and browser-dependent.</li>
<li>It's generally more reliable and clearer to assert against the specific, long-form border properties you care about, such as <code>border-top-width</code>, <code>border-left-style</code>, or <code>border-bottom-color</code>, as shown in the example.</li>
</ul>
</li>
<li>
<p><strong><code>expect(error_message_locator).to_have_css("padding", re.compile(r"10px"))</code></strong>:</p>
<ul>
<li>This demonstrates using a regular expression for a CSS value. If the <code>padding</code> property was, for example, computed as <code>"10px 10px 10px 10px"</code>, the regex <code>r"10px"</code> would still match.</li>
<li>For more complex values or when you need to ensure all parts of a shorthand property (like <code>padding</code> or <code>margin</code>), you might need a more sophisticated regex or check individual properties (<code>padding-top</code>, <code>padding-right</code>, etc.).</li>
</ul>
</li>
</ol>
<p><strong>Why <code>to_have_css</code> is Useful (and When to Be Cautious):</strong></p>
<ul>
<li><strong>Verifying Critical Visual States:</strong> Useful for ensuring error messages are distinctly styled (e.g., red text), success indicators are clear, or that elements meant to be hidden are indeed styled with <code>display: none</code> or <code>visibility: hidden</code>.</li>
<li><strong>Testing Theme Changes:</strong> If your application supports theming, you can verify that theme-specific styles are applied.</li>
<li><strong>Basic Layout Checks:</strong> While not a replacement for visual regression testing, you can check for fundamental layout properties like <code>display</code> or <code>position</code> if they are critical to functionality.</li>
</ul>
<p><strong>A Note on CSS Value Specificity and Robustness:</strong></p>
<ul>
<li><strong>Computed Values are Key:</strong> Always test against the <em>computed</em> CSS values. Use your browser's developer tools to inspect an element and see its computed styles. This is the value Playwright will see.</li>
<li><strong>Color Formats:</strong> Colors can be represented in many ways (<code>red</code>, <code>#FF0000</code>, <code>#f00</code>, <code>rgb(255,0,0)</code>, <code>rgba(255,0,0,1)</code>). Browsers usually compute them to <code>rgb()</code> or <code>rgba()</code>. Be prepared for this. Regular expressions can help make these checks more flexible if needed (e.g., matching various forms of "red").</li>
<li><strong>Shorthand Properties:</strong> Be cautious with CSS shorthand properties like <code>margin</code>, <code>padding</code>, <code>font</code>, <code>background</code>, <code>border</code>. Their computed values can be verbose. It's often more reliable to test the specific long-form property you're interested in (e.g., <code>padding-left</code> instead of <code>padding</code>).</li>
<li><strong>Avoid Over-Testing Styles:</strong> End-to-end tests should primarily focus on user-observable behavior and functionality. Testing every minor CSS detail can lead to brittle tests that break with minor styling tweaks. Focus on styles that have a functional impact or are key visual indicators of state. For comprehensive visual testing, dedicated visual regression testing tools are more appropriate.</li>
</ul>
<p><strong>Connecting to Broader Concepts</strong></p>
<p>Both <code>to_have_attribute</code> and <code>to_have_css</code> empower you to perform very granular checks on the state and presentation of your web elements. When combined with Playwright's robust locators (Chapter 11) and other assertions, they form a comprehensive toolkit for verifying that your Django application's frontend behaves and appears exactly as intended. These assertions are particularly powerful when testing the <em>results</em> of user interactions (Chapter 13) or dynamic content changes (Chapter 14), ensuring that actions taken by the user or the system correctly reflect in the element's attributes and styles.</p>
<p>For instance, clicking a button might toggle an <code>aria-pressed</code> attribute from <code>"false"</code> to <code>"true"</code>, or submitting a form with invalid data might cause an error message to appear with a specific red <code>color</code>. These are perfect scenarios for using these attribute and CSS assertions.</p>
<p>By understanding how to use <code>to_have_attribute</code> and <code>to_have_css</code>, you gain deeper control over your test assertions, allowing you to write more precise, meaningful, and reliable tests for your Django applications.</p>
<h2 id="124-page-assertions-to_have_url-and-to_have_title" tabindex="-1"><a class="anchor" href="#124-page-assertions-to_have_url-and-to_have_title" name="124-page-assertions-to_have_url-and-to_have_title" tabindex="-1"><span class="octicon octicon-link"></span></a>12.4 Page Assertions: <code>to_have_url</code> and <code>to_have_title</code></h2>
<p>In the previous sections, we've focused heavily on locating specific elements on a page and asserting their states or content. These are crucial for verifying the details of your user interface. However, sometimes we need to take a step back and confirm broader, page-level characteristics. Two fundamental page-level properties are its URL and its title. Ensuring these are correct is vital for confirming navigation, user orientation, and even SEO basics.</p>
<p>Playwright, through its <code>expect</code> API, provides straightforward and powerful assertions for these: <code>to_have_url</code> and <code>to_have_title</code>. These assertions not only check the current state but also intelligently wait for the page to reach the expected state, aligning with Playwright's auto-waiting philosophy. This is particularly useful after actions that trigger navigation, like clicks or form submissions.</p>
<p>Let's delve into how to use these assertions to build more comprehensive and reliable E2E tests for your Django applications.</p>
<h3 id="verifying-the-page-url-with-expectpageto_have_url" tabindex="-1"><a class="anchor" href="#verifying-the-page-url-with-expectpageto_have_url" name="verifying-the-page-url-with-expectpageto_have_url" tabindex="-1"><span class="octicon octicon-link"></span></a>Verifying the Page URL with <code>expect(page).to_have_url()</code></h3>
<p>The URL is the unique address of a web page. After any navigation action—be it an initial page load, clicking a link, or submitting a form that redirects—verifying that the browser has landed on the <em>correct</em> URL is a fundamental check.</p>
<p><strong>Purpose and Importance:</strong></p>
<ul>
<li><strong>Confirms Navigation:</strong> It's the most direct way to ensure a link or redirect has taken the user to the intended destination.</li>
<li><strong>Validates Routing:</strong> In Django, this indirectly tests that your URL patterns (<code>urls.py</code>) are correctly configured and that the appropriate view was dispatched for the given path.</li>
<li><strong>Checks Dynamic Segments:</strong> For URLs with dynamic parts (e.g., <code>/products/&lt;id&gt;/</code>), you can verify that the ID or other parameters are correctly reflected in the URL.</li>
<li><strong>Ensures Correct Query Parameters:</strong> If your application uses query parameters for filtering or state, <code>to_have_url</code> can confirm their presence and values.</li>
</ul>
<p><strong>How It Works "Under the Hood":</strong>
When you use <code>expect(page).to_have_url(expected_url)</code>, Playwright:</p>
<ol>
<li>Retrieves the current URL of the page, similar to accessing <code>window.location.href</code> in the browser's JavaScript context.</li>
<li>Compares this current URL against the <code>expected_url</code> you provided.</li>
<li>If there's no match, Playwright doesn't fail immediately. It re-evaluates the current URL periodically, up to a configurable timeout. This auto-waiting is crucial because page navigations are asynchronous. The assertion only fails if the URL doesn't match the expectation within the timeout period.</li>
<li>The <code>expected_url</code> can be a string for an exact match or a regular expression for more flexible pattern matching.</li>
</ol>
<p>Let's look at some practical examples.</p>
<p><strong>Example 1: Exact URL Match</strong></p>
<p>Imagine you have a simple "About Us" page in your Django application, served at the <code>/about/</code> URL.</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># tests/e2e/test_navigation.py</span>

<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> Page<span class="token punctuation">,</span> expect

<span class="token keyword">def</span> <span class="token function">test_about_page_url</span><span class="token punctuation">(</span>page<span class="token punctuation">:</span> Page<span class="token punctuation">,</span> live_server<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Arrange: Construct the full URL using live_server</span>
    about_url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>live_server<span class="token punctuation">.</span>url<span class="token punctuation">}</span></span><span class="token string">/about/"</span></span>
    
    <span class="token comment"># Act: Navigate to the about page</span>
    page<span class="token punctuation">.</span>goto<span class="token punctuation">(</span>about_url<span class="token punctuation">)</span>
    
    <span class="token comment"># Assert: Verify the URL is exactly as expected</span>
    expect<span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_url<span class="token punctuation">(</span>about_url<span class="token punctuation">)</span>
</code></pre>
<p>Let's examine this code in detail:</p>
<ol>
<li><code>from playwright.sync_api import Page, expect</code>: We import the necessary <code>Page</code> type hint and the <code>expect</code> function for assertions.</li>
<li><code>def test_about_page_url(page: Page, live_server):</code>: This defines our test function, accepting the Playwright <code>page</code> fixture and our <code>live_server</code> fixture (which provides the base URL of our running Django application).</li>
<li><code>about_url = f"{live_server.url}/about/"</code>:
<ul>
<li>This line constructs the absolute URL for the "/about/" page.</li>
<li>Using <code>live_server.url</code> is crucial because the port number for the test server is dynamically assigned. Hardcoding <code>http://localhost:8000/about/</code> would lead to failures.</li>
</ul>
</li>
<li><code>page.goto(about_url)</code>:
<ul>
<li>This is the action step. We instruct the Playwright-controlled browser to navigate to the constructed <code>about_url</code>.</li>
</ul>
</li>
<li><code>expect(page).to_have_url(about_url)</code>:
<ul>
<li>This is our core assertion.</li>
<li><code>expect(page)</code> targets the page object itself for page-level assertions.</li>
<li><code>.to_have_url(about_url)</code> asserts that the current URL of the page matches the <code>about_url</code> string exactly.</li>
<li>If <code>page.goto()</code> resulted in a different URL (e.g., due to a misconfiguration or an unexpected redirect), this assertion would fail after the timeout.</li>
</ul>
</li>
</ol>
<p>This pattern demonstrates a fundamental check: after navigating, confirm you've arrived where you intended.</p>
<p><strong>Example 2: URL Match with a Regular Expression</strong></p>
<p>Sometimes, URLs have dynamic parts, or you might only care about a specific pattern within the URL. Regular expressions offer the flexibility needed for such cases. Consider a product detail page in an e-commerce application, where the URL might be <code>/products/&lt;product_id&gt;/</code>.</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># tests/e2e/test_products.py</span>

<span class="token keyword">import</span> re
<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> Page<span class="token punctuation">,</span> expect

<span class="token comment"># Assume you have a way to create a product and get its ID,</span>
<span class="token comment"># or you know an ID that should exist. For this example, let's assume product ID 42.</span>

<span class="token keyword">def</span> <span class="token function">test_product_detail_page_url_pattern</span><span class="token punctuation">(</span>page<span class="token punctuation">:</span> Page<span class="token punctuation">,</span> live_server<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Arrange: Construct the URL for a specific product</span>
    product_id <span class="token operator">=</span> <span class="token number">42</span>
    product_detail_url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>live_server<span class="token punctuation">.</span>url<span class="token punctuation">}</span></span><span class="token string">/products/</span><span class="token interpolation"><span class="token punctuation">{</span>product_id<span class="token punctuation">}</span></span><span class="token string">/"</span></span>
    
    <span class="token comment"># Act: Navigate to the product detail page</span>
    page<span class="token punctuation">.</span>goto<span class="token punctuation">(</span>product_detail_url<span class="token punctuation">)</span>
    
    <span class="token comment"># Assert: Verify the URL matches a regular expression pattern</span>
    <span class="token comment"># This pattern checks for "/products/", followed by one or more digits, then a trailing slash.</span>
    expected_url_pattern <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r"/products/\d+/"</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_url<span class="token punctuation">(</span>expected_url_pattern<span class="token punctuation">)</span>

    <span class="token comment"># For more specificity, you could include the live_server.url in the regex:</span>
    <span class="token comment"># specific_url_pattern = re.compile(rf"{re.escape(live_server.url)}/products/{product_id}/")</span>
    <span class="token comment"># expect(page).to_have_url(specific_url_pattern)</span>
</code></pre>
<p>Let's break down this example:</p>
<ol>
<li><code>import re</code>: We import Python's built-in regular expression module.</li>
<li><code>product_id = 42</code>: We define a hypothetical product ID. In a real test, this might come from a fixture that creates a product in the test database.</li>
<li><code>product_detail_url = f"{live_server.url}/products/{product_id}/"</code>: We navigate to a specific product's URL.</li>
<li><code>page.goto(product_detail_url)</code>: The navigation action.</li>
<li><code>expected_url_pattern = re.compile(r"/products/\d+/")</code>:
<ul>
<li>Here, we define our regular expression.</li>
<li><code>r"/products/\d+/"</code>: This raw string defines the pattern:
<ul>
<li><code>/products/</code>: Matches the literal string "/products/".</li>
<li><code>\d+</code>: Matches one or more digits (representing the product ID).</li>
<li><code>/</code>: Matches the trailing slash.</li>
</ul>
</li>
<li><code>re.compile()</code>: Compiling the regex pattern can be slightly more efficient if used multiple times, though for a single use like this, passing the string directly to <code>to_have_url</code> also works: <code>expect(page).to_have_url(r"/products/\d+/")</code>.</li>
</ul>
</li>
<li><code>expect(page).to_have_url(expected_url_pattern)</code>:
<ul>
<li>This assertion now checks if the page's current URL matches the compiled regular expression <code>expected_url_pattern</code>.</li>
<li>It's important to note that when a regex is provided, <code>to_have_url</code> performs a <em>search</em> (like <code>re.search</code>), not necessarily a full match from start to end of the URL string, unless your regex pattern includes anchors like <code>^</code> (start) and <code>$</code> (end). For instance, <code>r".*/products/\d+/$"</code> would ensure the pattern matches the end of the URL.</li>
<li>The commented-out lines show how you could create a more specific regex that includes the <code>live_server.url</code> and the exact <code>product_id</code> if needed, using <code>re.escape()</code> to handle any special characters in <code>live_server.url</code>.</li>
</ul>
</li>
</ol>
<p><strong>Why use regex?</strong>
Using a regex like <code>r"/products/\d+/"</code> is more robust if you only care that you're on <em>some</em> product page, not necessarily product <code>42</code>. If you navigate to <code>/products/42/</code> and assert <code>expect(page).to_have_url(r"/products/\d+/")</code>, it will pass. If you navigated to <code>/products/some-slug/</code> (and your regex was specific to digits), it would fail. Choose the specificity that matches your test's intent.</p>
<p><strong>Example 3: Testing URL After a Redirect</strong></p>
<p>A common scenario in web applications is redirection after an action. For example, after successfully submitting a login form, a user is typically redirected to their dashboard.</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># tests/e2e/test_auth.py</span>

<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> Page<span class="token punctuation">,</span> expect
<span class="token comment"># Assume User model and necessary setup for creating a user</span>
<span class="token comment"># from django.contrib.auth.models import User</span>
<span class="token comment"># import pytest</span>

<span class="token comment"># @pytest.mark.django_db # If creating users</span>
<span class="token keyword">def</span> <span class="token function">test_login_redirects_to_dashboard</span><span class="token punctuation">(</span>page<span class="token punctuation">:</span> Page<span class="token punctuation">,</span> live_server <span class="token comment">#, regular_user_data</span>
                                     <span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Arrange</span>
    login_url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>live_server<span class="token punctuation">.</span>url<span class="token punctuation">}</span></span><span class="token string">/accounts/login/"</span></span>
    dashboard_url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>live_server<span class="token punctuation">.</span>url<span class="token punctuation">}</span></span><span class="token string">/dashboard/"</span></span> 
    
    <span class="token comment"># In a real test, you'd create a user and use their credentials</span>
    <span class="token comment"># User.objects.create_user(username="testuser", password="password123")</span>

    page<span class="token punctuation">.</span>goto<span class="token punctuation">(</span>login_url<span class="token punctuation">)</span>
    
    <span class="token comment"># Act: Fill and submit the login form</span>
    page<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token string">"input[name='username']"</span><span class="token punctuation">,</span> <span class="token string">"testuser"</span><span class="token punctuation">)</span> <span class="token comment"># Replace with actual user</span>
    page<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token string">"input[name='password']"</span><span class="token punctuation">,</span> <span class="token string">"password123"</span><span class="token punctuation">)</span> <span class="token comment"># Replace with actual password</span>
    page<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token string">"button[type='submit']"</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Assert: Verify the URL is the dashboard URL after redirection</span>
    <span class="token comment"># Playwright's expect().to_have_url() will wait for the navigation to complete.</span>
    expect<span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_url<span class="token punctuation">(</span>dashboard_url<span class="token punctuation">)</span>
</code></pre>
<p>Let's analyze this login redirect test:</p>
<ol>
<li><code>login_url = f"{live_server.url}/accounts/login/"</code>: Defines the login page URL.</li>
<li><code>dashboard_url = f"{live_server.url}/dashboard/"</code>: Defines the expected destination URL after a successful login.</li>
<li><code>page.goto(login_url)</code>: Navigates to the login page.</li>
<li><code>page.fill(...)</code>, <code>page.click(...)</code>: These lines simulate user interaction: filling the username and password fields and clicking the submit button. (Note: In a real test, you'd use more robust locators and ensure a user "testuser" exists in the test database).</li>
<li><code>expect(page).to_have_url(dashboard_url)</code>:
<ul>
<li>This is the key assertion. After the <code>page.click()</code> action, which presumably triggers a form submission and a server-side redirect, Playwright waits.</li>
<li>The <code>to_have_url</code> assertion will poll the page's current URL until it matches <code>dashboard_url</code> or the timeout is reached. This handles the asynchronous nature of the redirect gracefully.</li>
<li>This implicitly tests that the login was successful (or at least that the application <em>thinks</em> it was) and that the redirect logic in your Django view is working correctly.</li>
</ul>
</li>
</ol>
<p><strong>Common Pitfalls and Considerations for <code>to_have_url</code>:</strong></p>
<ul>
<li><strong>Trailing Slashes:</strong> Django's <code>APPEND_SLASH</code> setting can automatically add a trailing slash if a URL is requested without one and a pattern with a slash exists. Be consistent in your expected URLs. If <code>APPEND_SLASH</code> is True (default), <code>http://server/path</code> might become <code>http://server/path/</code>. Your assertion should match the final URL.</li>
<li><strong>Full vs. Partial URLs:</strong> <code>to_have_url</code> by default expects the full URL if you pass a string. If you only want to check the path, you can use a regex like <code>expect(page).to_have_url(re.compile(r"/expected/path/$"))</code>.</li>
<li><strong>Query Parameters:</strong> If the order of query parameters is not guaranteed but their presence and values are, a regex is more robust than a string match. For example, <code>/search?q=django&amp;type=books</code> is different from <code>/search?type=books&amp;q=django</code> as a string, but a regex could match both.</li>
<li><strong>Base URL:</strong> Always use <code>live_server.url</code> to construct the base of your expected URLs in tests to avoid issues with dynamic port allocation.</li>
</ul>
<h3 id="verifying-the-page-title-with-expectpageto_have_title" tabindex="-1"><a class="anchor" href="#verifying-the-page-title-with-expectpageto_have_title" name="verifying-the-page-title-with-expectpageto_have_title" tabindex="-1"><span class="octicon octicon-link"></span></a>Verifying the Page Title with <code>expect(page).to_have_title()</code></h3>
<p>The page title (the content of the <code>&lt;title&gt;</code> HTML tag) is displayed in the browser tab or window title bar. It's important for user orientation, accessibility (screen readers announce it), and SEO.</p>
<p><strong>Purpose and Importance:</strong></p>
<ul>
<li><strong>User Experience:</strong> Helps users understand the content or purpose of the current page.</li>
<li><strong>Accessibility:</strong> Crucial for users relying on assistive technologies.</li>
<li><strong>Sanity Check:</strong> Confirms that the correct page content (and thus, likely the correct Django template and view logic) has been loaded.</li>
<li><strong>Branding/Consistency:</strong> Ensures titles follow a consistent pattern across your site.</li>
</ul>
<p><strong>How It Works "Under the Hood":</strong>
Similar to <code>to_have_url</code>, when you use <code>expect(page).to_have_title(expected_title)</code>:</p>
<ol>
<li>Playwright retrieves the current document title, equivalent to <code>document.title</code> in browser JavaScript.</li>
<li>It compares this current title with the <code>expected_title</code>.</li>
<li>It auto-waits, retrying the check until the title matches or a timeout occurs. This is useful if the title is set or modified by JavaScript after the initial page load.</li>
<li>The <code>expected_title</code> can be a string for an exact match or a regular expression.</li>
</ol>
<p><strong>Example 4: Exact Title Match</strong></p>
<p>Let's say your homepage should have the title "Welcome to My Awesome Site".</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># tests/e2e/test_homepage.py</span>

<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> Page<span class="token punctuation">,</span> expect

<span class="token keyword">def</span> <span class="token function">test_homepage_title</span><span class="token punctuation">(</span>page<span class="token punctuation">:</span> Page<span class="token punctuation">,</span> live_server<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Arrange</span>
    homepage_url <span class="token operator">=</span> live_server<span class="token punctuation">.</span>url <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token comment"># Or just live_server.url</span>
    expected_title <span class="token operator">=</span> <span class="token string">"Welcome to My Awesome Site"</span>
    
    <span class="token comment"># Act</span>
    page<span class="token punctuation">.</span>goto<span class="token punctuation">(</span>homepage_url<span class="token punctuation">)</span>
    
    <span class="token comment"># Assert</span>
    expect<span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_title<span class="token punctuation">(</span>expected_title<span class="token punctuation">)</span>
</code></pre>
<p>Explanation:</p>
<ol>
<li><code>homepage_url = live_server.url + "/"</code>: Defines the URL for the homepage.</li>
<li><code>expected_title = "Welcome to My Awesome Site"</code>: The exact title string we expect.</li>
<li><code>page.goto(homepage_url)</code>: Navigates to the homepage.</li>
<li><code>expect(page).to_have_title(expected_title)</code>:
<ul>
<li>Asserts that the <code>document.title</code> of the loaded page is exactly "Welcome to My Awesome Site".</li>
<li>If your Django template for the homepage doesn't set this title correctly in its <code>&lt;title&gt;</code> tag, this assertion will fail.</li>
</ul>
</li>
</ol>
<p><strong>Example 5: Title Match with a Regular Expression</strong></p>
<p>Product detail pages often include the product name in the title, like "Product X - My Awesome Site". Since "Product X" is dynamic, a regular expression is suitable.</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># tests/e2e/test_products.py</span>

<span class="token keyword">import</span> re
<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> Page<span class="token punctuation">,</span> expect

<span class="token keyword">def</span> <span class="token function">test_product_detail_page_title_pattern</span><span class="token punctuation">(</span>page<span class="token punctuation">:</span> Page<span class="token punctuation">,</span> live_server<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Arrange: Assume product ID 77 leads to a product named "Super Widget"</span>
    product_id <span class="token operator">=</span> <span class="token number">77</span>
    product_url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>live_server<span class="token punctuation">.</span>url<span class="token punctuation">}</span></span><span class="token string">/products/</span><span class="token interpolation"><span class="token punctuation">{</span>product_id<span class="token punctuation">}</span></span><span class="token string">/"</span></span> 
    
    <span class="token comment"># This would typically come from the product data itself</span>
    <span class="token comment"># For this example, let's assume the product name is "Super Widget"</span>
    <span class="token comment"># and the title format is "&lt;Product Name&gt; | My Awesome Site"</span>
    
    <span class="token comment"># Act</span>
    page<span class="token punctuation">.</span>goto<span class="token punctuation">(</span>product_url<span class="token punctuation">)</span>
    
    <span class="token comment"># Assert</span>
    <span class="token comment"># We expect a title like "Super Widget | My Awesome Site"</span>
    <span class="token comment"># The regex matches any characters followed by " | My Awesome Site"</span>
    expected_title_pattern <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r".+ \| My Awesome Site"</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_title<span class="token punctuation">(</span>expected_title_pattern<span class="token punctuation">)</span>
</code></pre>
<p>Breakdown:</p>
<ol>
<li><code>product_url = f"{live_server.url}/products/{product_id}/"</code>: URL for a specific product.</li>
<li><code>page.goto(product_url)</code>: Navigation.</li>
<li><code>expected_title_pattern = re.compile(r".+ \| My Awesome Site")</code>:
<ul>
<li>This regular expression is designed to match titles that end with " | My Awesome Site".</li>
<li><code>.+</code>: Matches one or more of any character (except newline). This accounts for the dynamic product name.</li>
<li><code>\s\|\s</code>: Matches a space, a literal pipe symbol (escaped with <code>\</code>), and another space.</li>
<li><code>My Awesome Site</code>: Matches the literal site name suffix.</li>
</ul>
</li>
<li><code>expect(page).to_have_title(expected_title_pattern)</code>:
<ul>
<li>Asserts that the page title matches this pattern. This is more flexible than an exact string match when parts of the title are dynamic.</li>
</ul>
</li>
</ol>
<p><strong>Common Pitfalls and Considerations for <code>to_have_title</code>:</strong></p>
<ul>
<li><strong>Dynamic Content:</strong> If JavaScript heavily modifies the title after page load, ensure Playwright's auto-wait is sufficient. If not, you might need more specific waits before this assertion.</li>
<li><strong>Special Characters:</strong> Titles can contain special characters. Exact string matches must be precise. Regex can help manage variations or escape special characters if needed (e.g., <code>re.escape("Title with (Parentheses)")</code>).</li>
<li><strong>Template Accuracy:</strong> This assertion directly tests the <code>&lt;title&gt;</code> tag in your rendered Django template. A failure often points to an issue in the template.</li>
</ul>
<h3 id="connecting-to-django-a-practical-example" tabindex="-1"><a class="anchor" href="#connecting-to-django-a-practical-example" name="connecting-to-django-a-practical-example" tabindex="-1"><span class="octicon octicon-link"></span></a>Connecting to Django: A Practical Example</h3>
<p>Let's tie these assertions together with a simple Django view and template to see how they confirm the behavior of our Django application.</p>
<p><strong>1. Django Setup (Illustrative)</strong></p>
<p>Suppose you have the following in your Django project:</p>
<p><code>myapp/views.py</code>:</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># myapp/views.py (Illustrative Django view)</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render
<span class="token keyword">from</span> django<span class="token punctuation">.</span>http <span class="token keyword">import</span> HttpResponseRedirect
<span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> reverse

<span class="token keyword">def</span> <span class="token function">contact_form_view</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>
        <span class="token comment"># Process form data (omitted for brevity)</span>
        <span class="token comment"># ...</span>
        <span class="token comment"># Redirect to a thank you page upon successful submission</span>
        <span class="token keyword">return</span> HttpResponseRedirect<span class="token punctuation">(</span>reverse<span class="token punctuation">(</span><span class="token string">'thank_you'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'myapp/contact_form.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'Contact Us'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">thank_you_view</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'myapp/thank_you.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'Thank You!'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p><code>myapp/urls.py</code>:</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># myapp/urls.py (Illustrative Django URLs)</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path
<span class="token keyword">from</span> <span class="token punctuation">.</span> <span class="token keyword">import</span> views

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    path<span class="token punctuation">(</span><span class="token string">'contact/'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>contact_form_view<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'contact_form'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    path<span class="token punctuation">(</span><span class="token string">'thank-you/'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>thank_you_view<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'thank_you'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre>
<p><code>myapp/templates/myapp/contact_form.html</code>:</p>
<pre class="language-html" tabindex="0"><code class="language-html"><span class="token comment">&lt;!-- THIS_CODE_SNIPPET --&gt;</span>
<span class="token comment">&lt;!-- myapp/templates/myapp/contact_form.html (Illustrative Django Template) --&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>{{ title }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Contact Us<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        {% csrf_token %}
        <span class="token comment">&lt;!-- Form fields would go here --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>message<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Message:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>message<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>message<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Send<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p><code>myapp/templates/myapp/thank_you.html</code>:</p>
<pre class="language-html" tabindex="0"><code class="language-html"><span class="token comment">&lt;!-- THIS_CODE_SNIPPET --&gt;</span>
<span class="token comment">&lt;!-- myapp/templates/myapp/thank_you.html (Illustrative Django Template) --&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>{{ title }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Thank You!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Your message has been received.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p><strong>2. The Playwright Test</strong></p>
<p>Now, let's write a test to verify the form submission, redirect, and the URL/title of the "Thank You" page.</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token comment"># tests/e2e/test_contact_form.py</span>

<span class="token keyword">import</span> re
<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> Page<span class="token punctuation">,</span> expect
<span class="token keyword">import</span> pytest

<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>mark<span class="token punctuation">.</span>django_db</span> <span class="token comment"># Not strictly needed if not interacting with DB for this simple form</span>
<span class="token keyword">def</span> <span class="token function">test_contact_form_submission_redirect_and_page_properties</span><span class="token punctuation">(</span>page<span class="token punctuation">:</span> Page<span class="token punctuation">,</span> live_server<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Arrange</span>
    contact_url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>live_server<span class="token punctuation">.</span>url<span class="token punctuation">}</span></span><span class="token string">/contact/"</span></span> <span class="token comment"># Assuming 'contact/' is mapped in root urls.py</span>
    
    <span class="token comment"># Act: Navigate to contact form</span>
    page<span class="token punctuation">.</span>goto<span class="token punctuation">(</span>contact_url<span class="token punctuation">)</span>
    
    <span class="token comment"># Assert initial page title (optional, but good practice)</span>
    expect<span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_title<span class="token punctuation">(</span><span class="token string">"Contact Us"</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Act: Fill and submit the form</span>
    page<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token string">"textarea[name='message']"</span><span class="token punctuation">,</span> <span class="token string">"This is a test message."</span><span class="token punctuation">)</span>
    page<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token string">"button[type='submit']"</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Assert: Check URL and Title of the "Thank You" page</span>
    <span class="token comment"># The click action triggers a POST and then a redirect.</span>
    <span class="token comment"># Playwright's assertions will wait for the navigation to complete.</span>
    
    <span class="token comment"># 1. Assert the URL</span>
    <span class="token comment"># We expect to be redirected to a URL ending with '/thank-you/'</span>
    <span class="token comment"># Using a regex to be flexible about the base URL part if not constructing full URL</span>
    thank_you_url_pattern <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r"/thank-you/$"</span><span class="token punctuation">)</span> 
    expect<span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_url<span class="token punctuation">(</span>thank_you_url_pattern<span class="token punctuation">)</span>
    
    <span class="token comment"># Alternatively, for an exact match if you construct the full URL:</span>
    <span class="token comment"># expected_thank_you_url = f"{live_server.url}/thank-you/"</span>
    <span class="token comment"># expect(page).to_have_url(expected_thank_you_url)</span>

    <span class="token comment"># 2. Assert the Title</span>
    expect<span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">.</span>to_have_title<span class="token punctuation">(</span><span class="token string">"Thank You!"</span><span class="token punctuation">)</span>
</code></pre>
<p>Let's dissect this integrated test:</p>
<ol>
<li><code>contact_url = f"{live_server.url}/contact/"</code>: We define the initial URL. (Ensure your project's root <code>urls.py</code> includes <code>myapp.urls</code> under a path like <code>path('', include('myapp.urls'))</code> or <code>path('app/', include('myapp.urls'))</code> and adjust <code>contact_url</code> accordingly).</li>
<li><code>page.goto(contact_url)</code>: Navigate to the contact form.</li>
<li><code>expect(page).to_have_title("Contact Us")</code>: An initial assertion. This confirms we've landed on the correct starting page and its title is as expected from the <code>contact_form_view</code> context.</li>
<li><code>page.fill(...)</code> and <code>page.click(...)</code>: Simulate filling out the message field and submitting the form.</li>
<li><code>thank_you_url_pattern = re.compile(r"/thank-you/$")</code>: We define a regex to match the path of the "Thank You" page. This is robust as it doesn't depend on the <code>live_server.url</code> prefix if we only care about the path.</li>
<li><code>expect(page).to_have_url(thank_you_url_pattern)</code>:
<ul>
<li>After the click, a redirect should occur. This assertion waits for the new URL to match <code>/thank-you/</code>.</li>
<li>This verifies that our Django view's <code>HttpResponseRedirect(reverse('thank_you'))</code> logic worked and routed to the correct URL name.</li>
</ul>
</li>
<li><code>expect(page).to_have_title("Thank You!")</code>:
<ul>
<li>This assertion then checks the title of the newly loaded "Thank You" page.</li>
<li>It confirms that the <code>thank_you_view</code> was called and rendered its template with the correct title in the context.</li>
</ul>
</li>
</ol>
<p>This single test case effectively validates a small but complete user flow, including navigation, form submission, server-side redirection, and the final state of the page in terms of its URL and title. These page-level assertions act as crucial checkpoints in your E2E tests.</p>
<p><strong>Summary and Best Practices:</strong></p>
<ul>
<li><strong>Always Verify Navigation:</strong> After any action that should result in a page change (clicks on links, form submissions, <code>page.goto()</code>), use <code>expect(page).to_have_url()</code> to confirm you've landed on the correct page.</li>
<li><strong>Check Titles for Key Pages:</strong> For important pages in your application (homepage, landing pages, confirmation pages), assert the title using <code>expect(page).to_have_title()</code>. This ensures user orientation and that the correct content context is loaded.</li>
<li><strong>Use Regular Expressions for Flexibility:</strong> When URLs or titles have dynamic parts (IDs, slugs, counts, names), use regular expressions to create more robust and less brittle assertions. Match only the parts that are constant and define the pattern for the variable parts.</li>
<li><strong>Combine with Element Assertions:</strong> Page assertions complement element assertions. First, ensure you're on the right page (URL, title), then proceed to check for specific elements and their content on that page.</li>
<li><strong>Clarity in Intent:</strong> Your choice between an exact string match and a regex should reflect your testing intent. If the <em>entire</em> URL or title must be exact, use a string. If only a pattern matters, use a regex.</li>
</ul>
<p>By incorporating <code>to_have_url</code> and <code>to_have_title</code> into your E2E testing toolkit, you add another layer of validation that ensures your Django application is not only rendering elements correctly but is also navigating and identifying its pages as intended. This contributes significantly to the overall reliability and correctness of your web application from a user's perspective.</p>
<h2 id="125-case-study-fixing-your-responsive-visibility-assertions" tabindex="-1"><a class="anchor" href="#125-case-study-fixing-your-responsive-visibility-assertions" name="125-case-study-fixing-your-responsive-visibility-assertions" tabindex="-1"><span class="octicon octicon-link"></span></a>12.5 Case Study: Fixing Your Responsive Visibility Assertions</h2>
<p>One of the common pain points in web testing, which we briefly touched upon in Chapter 1 as "Responsive Woes," is ensuring your application looks and functions correctly across various screen sizes. Modern web design heavily relies on responsive techniques, where elements might appear, disappear, or change their layout based on the viewport width. If your tests don't account for this, you can end up with assertions that pass on one screen size (perhaps your development machine's default) but fail on another, leading to flaky and unreliable tests.</p>
<p>This case study will walk you through a typical scenario where responsive design affects element visibility and demonstrate how to use Playwright's <code>expect</code> assertions in conjunction with viewport manipulation to create robust tests that accurately reflect user experience on different devices.</p>
<p><strong>The Scenario: A Responsive Navigation Header</strong></p>
<p>Imagine a common UI pattern:</p>
<ul>
<li>On <strong>desktop</strong> screens, a full navigation menu is visible.</li>
<li>On <strong>mobile</strong> screens, the full navigation menu is hidden, and a hamburger icon is shown instead, which would typically toggle a mobile menu.</li>
</ul>
<p>If we write a test that simply asserts the desktop navigation is visible, it might pass when run with a wide browser window but fail if the test runner (or a CI environment) uses a narrower default viewport. Conversely, a test looking for the hamburger icon might fail on a desktop view.</p>
<p>Let's set up a simple Django page that exhibits this behavior.</p>
<p><strong>1. The Django View and Template</strong></p>
<p>First, we need a simple Django view that renders our responsive HTML page.</p>
<p>Assume you have a Django app named <code>responsive_app</code>.</p>
<p>In your <code>responsive_app/views.py</code>:</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render

<span class="token keyword">def</span> <span class="token function">responsive_test_page</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Renders a simple page with elements that change visibility
    based on screen width.
    """</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'responsive_app/responsive_page.html'</span><span class="token punctuation">)</span>
</code></pre>
<p>Let's examine this code in detail:</p>
<ol>
<li><code>from django.shortcuts import render</code>: This line imports the <code>render</code> function, a standard Django shortcut used to combine a template with a context dictionary and return an <code>HttpResponse</code> object with that rendered text.
<ul>
<li>This is the typical way to serve HTML pages in Django.</li>
</ul>
</li>
<li><code>def responsive_test_page(request):</code>: This defines a simple Django view function.
<ul>
<li>It takes one argument, <code>request</code>, which is an <code>HttpRequest</code> object representing the current web request.</li>
<li>This function will be mapped to a URL in <code>urls.py</code>.</li>
</ul>
</li>
<li><code>return render(request, 'responsive_app/responsive_page.html')</code>: This line does the main work.
<ul>
<li>It calls <code>render</code> to generate the HTML response.</li>
<li>The first argument is the <code>request</code> object.</li>
<li>The second argument, <code>'responsive_app/responsive_page.html'</code>, is the path to the template file that Django should use. Django's template loaders will find this file within your app's <code>templates</code> directory (e.g., <code>responsive_app/templates/responsive_app/responsive_page.html</code>).</li>
<li>We are not passing any context dictionary here, as our HTML is static for this example, but in a real application, you might pass data to be displayed in the template.</li>
</ul>
</li>
</ol>
<p>Next, create the template file <code>responsive_app/templates/responsive_app/responsive_page.html</code>:</p>
<pre class="language-html" tabindex="0"><code class="language-html"><span class="token comment">&lt;!-- THIS_CODE_SNIPPET --&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Responsive Test Page<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
        <span class="token selector">body</span> <span class="token punctuation">{</span> <span class="token property">font-family</span><span class="token punctuation">:</span> sans-serif<span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token selector">.desktop-nav-content</span> <span class="token punctuation">{</span>
            <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span> <span class="token comment">/* Hidden by default (mobile-first) */</span>
            <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
            <span class="token property">background-color</span><span class="token punctuation">:</span> lightblue<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">.mobile-hamburger-icon</span> <span class="token punctuation">{</span>
            <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token comment">/* Visible by default (mobile-first) */</span>
            <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
            <span class="token property">background-color</span><span class="token punctuation">:</span> lightgreen<span class="token punctuation">;</span>
            <span class="token property">width</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span> <span class="token comment">/* For visual clarity */</span>
            <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/* Medium devices (tablets, 768px and up) */</span>
        <span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span><span class="token property">min-width</span><span class="token punctuation">:</span> 768px<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
            <span class="token selector">.desktop-nav-content</span> <span class="token punctuation">{</span>
                <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token comment">/* Show on desktop */</span>
            <span class="token punctuation">}</span>
            <span class="token selector">.mobile-hamburger-icon</span> <span class="token punctuation">{</span>
                <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span> <span class="token comment">/* Hide on desktop */</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Our Responsive Page<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">data-testid</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>desktop-nav<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>desktop-nav-content<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        Desktop Navigation Links
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">data-testid</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mobile-hamburger<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mobile-hamburger-icon<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        ☰
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>Let's break down this HTML and CSS:</p>
<ol>
<li><strong>Basic HTML Structure</strong>: Standard <code>&lt;!DOCTYPE html&gt;</code>, <code>&lt;html&gt;</code>, <code>&lt;head&gt;</code>, and <code>&lt;body&gt;</code> tags.
<ul>
<li>The <code>&lt;meta name="viewport" ...&gt;</code> tag is crucial for responsive design, ensuring the page scales correctly on different devices.</li>
</ul>
</li>
<li><strong>CSS Styles (<code>&lt;style&gt;</code> block)</strong>:
<ul>
<li><code>.desktop-nav-content { display: none; ... }</code>: This CSS class, intended for our desktop navigation, is set to <code>display: none</code> by default. This is a common "mobile-first" approach where styles for smaller screens are the default.</li>
<li><code>.mobile-hamburger-icon { display: block; ... }</code>: This class, for our mobile hamburger icon, is set to <code>display: block</code> by default, making it visible on smaller screens.</li>
<li><code>@media (min-width: 768px) { ... }</code>: This is a CSS media query. The styles inside this block will only apply when the browser window's width is 768 pixels or greater.
<ul>
<li><code>.desktop-nav-content { display: block; }</code>: Inside the media query, we change the desktop navigation to <code>display: block</code>, making it visible on screens 768px wide or wider.</li>
<li><code>.mobile-hamburger-icon { display: none; }</code>: Simultaneously, we hide the mobile hamburger icon (<code>display: none</code>) on these wider screens.</li>
</ul>
</li>
<li>The <code>background-color</code> and other minor styles are just for visual distinction if you were to open this page in a browser.</li>
</ul>
</li>
<li><strong>HTML Body Content</strong>:
<ul>
<li><code>&lt;div data-testid="desktop-nav" class="desktop-nav-content"&gt;...&lt;/div&gt;</code>: This <code>div</code> contains our "desktop navigation." It has the <code>desktop-nav-content</code> class, making its visibility dependent on the CSS rules we just discussed. We've also added <code>data-testid="desktop-nav"</code>, which is a best practice for creating stable test locators.</li>
<li><code>&lt;div data-testid="mobile-hamburger" class="mobile-hamburger-icon"&gt;...&lt;/div&gt;</code>: This <code>div</code> represents our "mobile hamburger icon." It has the <code>mobile-hamburger-icon</code> class and a <code>data-testid="mobile-hamburger"</code> attribute.</li>
</ul>
</li>
</ol>
<p><strong>The Core Problem:</strong> If Playwright loads this page with a default viewport that is, say, 1280px wide, the <code>desktop-nav</code> will be visible, and <code>mobile-hamburger</code> will be hidden. If it loads with a 400px wide viewport, the opposite will be true. A test that doesn't control the viewport might make incorrect assumptions.</p>
<p><strong>2. The Test: Asserting Visibility Across Viewports</strong></p>
<p>Now, let's write a <code>pytest-playwright</code> test that correctly handles this responsive behavior. We'll need to use the <code>page</code> fixture to interact with the browser and the <code>live_server</code> fixture to serve our Django page. We'll also use <code>page.set_viewport_size()</code> to simulate different screen sizes.</p>
<p>Create a test file, for example, <code>tests/test_responsive_views.py</code>:</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># THIS_CODE_SNIPPET</span>
<span class="token keyword">import</span> pytest
<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> Page<span class="token punctuation">,</span> expect

<span class="token comment"># Assume your view is mapped to '/responsive-page/' in urls.py</span>
<span class="token comment"># from django.urls import path</span>
<span class="token comment"># from responsive_app.views import responsive_test_page</span>
<span class="token comment"># urlpatterns = [path('responsive-page/', responsive_test_page, name='responsive_page')]</span>

DESKTOP_WIDTH <span class="token operator">=</span> <span class="token number">1280</span>
DESKTOP_HEIGHT <span class="token operator">=</span> <span class="token number">720</span>
MOBILE_WIDTH <span class="token operator">=</span> <span class="token number">375</span>
MOBILE_HEIGHT <span class="token operator">=</span> <span class="token number">667</span>

<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>mark<span class="token punctuation">.</span>django_db</span> <span class="token comment"># Not strictly needed for this view, but good practice</span>
<span class="token keyword">def</span> <span class="token function">test_responsive_navigation_visibility</span><span class="token punctuation">(</span>page<span class="token punctuation">:</span> Page<span class="token punctuation">,</span> live_server<span class="token punctuation">)</span><span class="token punctuation">:</span>
    page<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>live_server<span class="token punctuation">.</span>url<span class="token punctuation">}</span></span><span class="token string">/responsive-page/"</span></span><span class="token punctuation">)</span>

    desktop_nav_locator <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"[data-testid='desktop-nav']"</span><span class="token punctuation">)</span>
    mobile_hamburger_locator <span class="token operator">=</span> page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"[data-testid='mobile-hamburger']"</span><span class="token punctuation">)</span>

    <span class="token comment"># --- Test Desktop View ---</span>
    page<span class="token punctuation">.</span>set_viewport_size<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"width"</span><span class="token punctuation">:</span> DESKTOP_WIDTH<span class="token punctuation">,</span> <span class="token string">"height"</span><span class="token punctuation">:</span> DESKTOP_HEIGHT<span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    <span class="token comment"># On desktop, desktop-nav should be visible, mobile-hamburger should be hidden</span>
    expect<span class="token punctuation">(</span>desktop_nav_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_visible<span class="token punctuation">(</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>mobile_hamburger_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_hidden<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Optional: Take a screenshot for verification</span>
    <span class="token comment"># page.screenshot(path="screenshot_desktop.png")</span>

    <span class="token comment"># --- Test Mobile View ---</span>
    page<span class="token punctuation">.</span>set_viewport_size<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"width"</span><span class="token punctuation">:</span> MOBILE_WIDTH<span class="token punctuation">,</span> <span class="token string">"height"</span><span class="token punctuation">:</span> MOBILE_HEIGHT<span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment"># On mobile, desktop-nav should be hidden, mobile-hamburger should be visible</span>
    expect<span class="token punctuation">(</span>desktop_nav_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_hidden<span class="token punctuation">(</span><span class="token punctuation">)</span>
    expect<span class="token punctuation">(</span>mobile_hamburger_locator<span class="token punctuation">)</span><span class="token punctuation">.</span>to_be_visible<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># Optional: Take a screenshot for verification</span>
    <span class="token comment"># page.screenshot(path="screenshot_mobile.png")</span>
</code></pre>
<p>Let's dissect this test meticulously:</p>
<ol>
<li><code>import pytest</code>: Imports the <code>pytest</code> library.</li>
<li><code>from playwright.sync_api import Page, expect</code>: Imports the <code>Page</code> type hint and the <code>expect</code> assertion function from Playwright.</li>
<li><code>DESKTOP_WIDTH, DESKTOP_HEIGHT, MOBILE_WIDTH, MOBILE_HEIGHT</code>: We define constants for our viewport dimensions. This improves readability and makes it easier to adjust these values if needed.
<ul>
<li>Using constants helps avoid "magic numbers" scattered throughout the test.</li>
</ul>
</li>
<li><code>@pytest.mark.django_db</code>: While our current view doesn't interact with the database, it's often good practice to include this if your page <em>might</em> in the future, or if other elements on the page (like user status) depend on the DB. For this specific static page, it's not strictly necessary.</li>
<li><code>def test_responsive_navigation_visibility(page: Page, live_server):</code>: Defines our test function.
<ul>
<li>It takes <code>page: Page</code> (the Playwright page fixture) and <code>live_server</code> (the <code>pytest-django</code> fixture that runs a live Django server with your test database) as arguments. Pytest automatically provides these.</li>
</ul>
</li>
<li><code>page.goto(f"{live_server.url}/responsive-page/")</code>: Navigates the Playwright-controlled browser to our test page.
<ul>
<li><code>live_server.url</code> provides the base URL of the running test server (e.g., <code>http://localhost:8081</code>).</li>
<li>We append <code>/responsive-page/</code>, assuming you've set up a URL pattern in your Django project's <code>urls.py</code> that maps this path to the <code>responsive_test_page</code> view.</li>
</ul>
</li>
<li><code>desktop_nav_locator = page.locator("[data-testid='desktop-nav']")</code>: We create a locator for the desktop navigation element.
<ul>
<li>Using <code>page.locator()</code> is Playwright's recommended way to define how to find an element. It doesn't find the element immediately but creates an object that knows <em>how</em> to find it when an action or assertion is performed.</li>
<li><code>"[data-testid='desktop-nav']"</code> is a CSS selector targeting the element with the <code>data-testid</code> attribute set to <code>desktop-nav</code>. This is a robust way to select elements for testing, as <code>data-testid</code> attributes are less likely to change due to styling or structural redesigns compared to class names or complex CSS paths.</li>
</ul>
</li>
<li><code>mobile_hamburger_locator = page.locator("[data-testid='mobile-hamburger']")</code>: Similarly, we create a locator for the mobile hamburger icon.</li>
<li><code># --- Test Desktop View ---</code>: A comment indicating the start of our desktop-specific assertions.</li>
<li><code>page.set_viewport_size({"width": DESKTOP_WIDTH, "height": DESKTOP_HEIGHT})</code>: This is a <strong>critical step</strong>.
<ul>
<li><code>page.set_viewport_size()</code> resizes the browser's viewport to the specified dimensions.</li>
<li>We pass a dictionary with <code>width</code> and <code>height</code>.</li>
<li>After this call, the browser will re-render the page as if it were on a 1280x720 screen. The CSS media queries in our template will apply accordingly.</li>
</ul>
</li>
<li><code>expect(desktop_nav_locator).to_be_visible()</code>: This is a Playwright assertion.
<ul>
<li><code>expect(locator)</code> takes a locator object.</li>
<li><code>.to_be_visible()</code> asserts that the element identified by <code>desktop_nav_locator</code> is currently visible on the page. "Visible" means it's in the DOM, has non-zero dimensions, and is not styled with <code>display: none</code> or <code>visibility: hidden</code>.</li>
<li>Because we set the viewport to desktop dimensions, our CSS rules should make the desktop navigation visible. This assertion should pass.</li>
</ul>
</li>
<li><code>expect(mobile_hamburger_locator).to_be_hidden()</code>: This assertion checks the opposite.
<ul>
<li><code>.to_be_hidden()</code> asserts that the element is not visible (e.g., <code>display: none</code>, <code>visibility: hidden</code>, or not in the DOM).</li>
<li>On a desktop viewport, our CSS hides the mobile hamburger icon. This assertion should also pass.</li>
</ul>
</li>
<li><code>page.screenshot(path="screenshot_desktop.png")</code> (commented out): This line, if uncommented, would take a screenshot of the page at this point. Screenshots are invaluable for debugging E2E tests, allowing you to see what the browser sees.</li>
<li><code># --- Test Mobile View ---</code>: A comment indicating the start of our mobile-specific assertions.</li>
<li><code>page.set_viewport_size({"width": MOBILE_WIDTH, "height": MOBILE_HEIGHT})</code>: We now resize the viewport to mobile dimensions (375x667).
<ul>
<li>The browser re-renders, and our CSS media queries will now apply the mobile styles.</li>
</ul>
</li>
<li><code>expect(desktop_nav_locator).to_be_hidden()</code>: Now, on a mobile viewport, we expect the desktop navigation to be hidden.
<ul>
<li>Our CSS rules for screens narrower than 768px dictate <code>display: none</code> for <code>.desktop-nav-content</code>.</li>
</ul>
</li>
<li><code>expect(mobile_hamburger_locator).to_be_visible()</code>: Conversely, we expect the mobile hamburger icon to be visible on the mobile viewport.
<ul>
<li>Our CSS rules make <code>.mobile-hamburger-icon</code> <code>display: block</code> by default and don't hide it in the mobile-sized media query.</li>
</ul>
</li>
<li><code>page.screenshot(path="screenshot_mobile.png")</code> (commented out): Another optional screenshot for the mobile view.</li>
</ol>
<p><strong>3. Why This Approach Works: Understanding the "Rendered" Page</strong></p>
<p>Playwright interacts with the web page just like a user's browser does. It doesn't just look at the raw HTML source; it considers the <strong>rendered Document Object Model (DOM)</strong>, which includes the effects of applied CSS and executed JavaScript.</p>
<ul>
<li>When <code>page.set_viewport_size()</code> is called, the browser engine effectively reflows and repaints the page based on the new dimensions.</li>
<li>CSS media queries are evaluated against this new viewport size.</li>
<li>Elements that have <code>display: none</code> (or other visibility-affecting styles) applied due to these media queries are considered hidden by Playwright's visibility checks.</li>
</ul>
<p>By explicitly controlling the viewport size before making visibility assertions, we ensure our test is validating the UI under specific, controlled conditions that mimic different user devices. This transforms potentially flaky tests into reliable checks of our responsive design.</p>
<p><strong>Key Takeaways from this Case Study:</strong></p>
<ul>
<li><strong>Acknowledge Responsiveness:</strong> Always consider how your UI changes across different screen sizes when writing E2E tests.</li>
<li><strong>Control the Viewport:</strong> Use <code>page.set_viewport_size()</code> to simulate various device dimensions before making assertions about element visibility or layout.</li>
<li><strong>Targeted Assertions:</strong> Assert that elements <em>expected</em> to be visible are indeed visible, and elements <em>expected</em> to be hidden are hidden for each specific viewport.</li>
<li><strong>Use Robust Locators:</strong> Employ <code>data-testid</code> or other stable locators to minimize test brittleness when UI structure or styles change.</li>
<li><strong>Leverage <code>expect</code>:</strong> Playwright's <code>expect</code> assertions (<code>to_be_visible()</code>, <code>to_be_hidden()</code>) are designed to understand an element's rendered state, including the impact of CSS.</li>
<li><strong>Screenshots for Debugging:</strong> Don't hesitate to use <code>page.screenshot()</code> during test development or when debugging failures to see exactly what Playwright is seeing.</li>
</ul>
<p>This case study demonstrates a fundamental technique for testing responsive web applications. By combining viewport manipulation with precise assertions, you can confidently verify that your Django application delivers the correct user experience across the spectrum of devices your users might employ, effectively addressing the "Responsive Woes" and building a more robust test suite. As you'll see in Chapter 15 ("Testing Responsive Design"), you can further enhance this by parameterizing tests to run across multiple predefined breakpoints.</p>
</div></div><script>
document.addEventListener('DOMContentLoaded', function() {
  const preTags = document.querySelectorAll('pre');
  
  preTags.forEach(function(pre) {
    const existingContainer = pre.closest('.pre-container');
    if (existingContainer) {
      // If pre is already in a container (e.g. script ran multiple times or manual structure)
      // Ensure button is there or add it. For simplicity, we assume if container exists, button might too.
      // A more robust check would be to see if a .copy-btn already exists for this pre.
      // For now, let's prevent adding duplicate buttons if script re-runs on dynamic content.
      if (existingContainer.querySelector('.copy-btn')) {
          return; // Skip if button already there
      }
    }

    const container = document.createElement('div');
    container.className = 'pre-container';
    
    const copyBtn = document.createElement('button');
    copyBtn.textContent = 'Copy';
    copyBtn.className = 'copy-btn';
    
    copyBtn.addEventListener('click', function() {
      const textToCopy = pre.innerText || pre.textContent; // .innerText is often better for user-visible text
      navigator.clipboard.writeText(textToCopy).then(
        function() {
          const originalText = copyBtn.textContent;
          copyBtn.textContent = 'Copied!';
          copyBtn.classList.add('copied');
          copyBtn.classList.remove('failed');
          
          setTimeout(function() {
            copyBtn.textContent = originalText;
            copyBtn.classList.remove('copied');
          }, 2000);
        },
        function() {
          const originalText = copyBtn.textContent;
          copyBtn.textContent = 'Failed!';
          copyBtn.classList.add('failed');
          copyBtn.classList.remove('copied');
          
          setTimeout(function() {
            copyBtn.textContent = originalText;
            copyBtn.classList.remove('failed');
          }, 2000);
        }
      );
    });
    
    // Structure: parent -> container -> pre & button
    if (pre.parentNode) {
        pre.parentNode.insertBefore(container, pre);
    }
    container.appendChild(pre); // Move pre into container
    container.appendChild(copyBtn); // Add button to container
  });
});
</script></body></html>